<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Favicons pour diffÃ©rents appareils -->
	<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
	<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <title>Voyage avec Martin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #000;
            color: #fff;
            overflow: hidden;
        }

        #container {
            display: flex;
            width: 100vw;
            height: 100vh;
        }

		#sidebar {
		    position: fixed;
		    left: -380px;
		    top: 0;
		    width: 380px;
		    height: 100vh;
		    background: rgba(20, 20, 20, 0.95);
		    border-right: 2px solid #333;
		    overflow-y: auto;
		    padding: 20px;
		    z-index: 100;
		    transition: left 0.3s ease;
		}

		#sidebar.open {
		    left: 0;
		}

        #header {
            text-align: center;
            margin-bottom: 20px;
        }

		#logo {
		    width: 300px;
		    height: 300px;
		    margin: 0 auto 10px;
		    display: block;
		    object-fit: contain;
		}
        #title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        #search-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #444;
            border-radius: 5px;
            background: #1a1a1a;
            color: #fff;
            font-size: 14px;
        }

        #stats {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        #stats h3 {
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .continent-section {
            margin-bottom: 15px;
        }

        .continent-header {
            background: rgba(50, 50, 50, 0.8);
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
        }

        .continent-header:hover {
            background: rgba(70, 70, 70, 0.9);
        }

        .continent-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .continent-stats {
            font-size: 12px;
            color: #4CAF50;
        }

        .continent-countries {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .continent-countries.open {
            max-height: 2000px;
        }

        .country-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            margin-left: 15px;
            background: rgba(40, 40, 40, 0.5);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .country-item:hover {
            background: rgba(60, 60, 60, 0.8);
        }

        .country-item.visited {
            background: rgba(76, 175, 80, 0.3);
            border-left: 4px solid #4CAF50;
        }

        .country-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .country-name {
            flex: 1;
            font-size: 14px;
        }

        .country-rating {
            font-size: 12px;
            color: #FFD700;
        }

        #globe-container {
            flex: 1;
            position: relative;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .control-btn {
            padding: 10px 15px;
            background: #4CAF50;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .control-btn:hover {
            background: #45a049;
        }

        #modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 20, 0.98);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #4CAF50;
            min-width: 450px;
            max-width: 600px;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
			max-height: 90vh;
			    overflow-y: auto;
        }

        #modal.active {
            display: block;
        }

        #modal h2 {
            margin-bottom: 20px;
            color: #4CAF50;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #ccc;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #4a4a4a;
            background: #1a1a1a;
            color: #fff;
            font-family: 'Segoe UI', Arial;
            resize: vertical;
            min-height: 100px;
            font-size: 14px;
        }

        .rating {
            display: flex;
            gap: 8px;
            font-size: 35px;
        }

        .star {
            cursor: pointer;
            color: #4a4a4a;
            transition: color 0.2s;
        }

        .star:hover,
        .star.active {
            color: #FFD700;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-neutral {
            background: #555;
            color: white;
        }

        .btn-neutral:hover {
            background: #666;
        }
		
		#close-stats-btn,
		#close-bucket-btn {
		    position: absolute;
		    top: 15px;
		    right: 15px;
		    width: 35px;
		    height: 35px;
		    min-width: 35px;
		    min-height: 35px;
		    background: #f44336;
		    border: none;
		    border-radius: 50%;
		    color: white;
		    cursor: pointer;
		    font-size: 20px;
		    font-weight: bold;
		    line-height: 35px;
		    text-align: center;
		    padding: 0;
		    transition: background 0.3s, transform 0.3s;
		}

		#close-stats-btn:hover,
		#close-bucket-btn:hover {
		    background: #d32f2f;
		    transform: scale(1.1);
		}

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        #overlay.active {
            display: block;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #45a049;
        }

        .arrow {
            transition: transform 0.3s;
        }

        .arrow.open {
            transform: rotate(90deg);
        }
		
		@keyframes pulse {
		    0%, 100% {
		        transform: scale(1);
		        opacity: 1;
		    }
		    50% {
		        transform: scale(1.5);
		        opacity: 0.7;
		    }
		}

		@keyframes glow {
		    0%, 100% {
		        box-shadow: 0 0 20px #FFD700, 0 0 40px #FFD700;
		    }
		    50% {
		        box-shadow: 0 0 30px #FFD700, 0 0 60px #FFD700, 0 0 80px #FFD700;
		    }
		}
		
		@keyframes popIn {
		    0% {
		        transform: translate(-50%, -50%) scale(0.5);
		        opacity: 0;
		    }
		    100% {
		        transform: translate(-50%, -50%) scale(1);
		        opacity: 1;
		    }
			
			@keyframes slideInDown {
			    from {
			        transform: translate(-50%, -100%);
			        opacity: 0;
			    }
			    to {
			        transform: translate(-50%, 0);
			        opacity: 1;
			    }
			}

			@keyframes slideOutUp {
			    from {
			        transform: translate(-50%, 0);
			        opacity: 1;
			    }
			    to {
			        transform: translate(-50%, -100%);
			        opacity: 0;
			    }
			}
			@keyframes slideInRight {
			    from {
			        transform: translateX(100%);
			        opacity: 0;
			    }
			    to {
			        transform: translateX(0);
			        opacity: 1;
			    }
			}

			@keyframes slideOutRight {
			    from {
			        transform: translateX(0);
			        opacity: 1;
			    }
			    to {
			        transform: translateX(100%);
			        opacity: 0;
			    }
				
			}
		}
		
    </style>
	<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase-client.js"></script>
<script src="js/auth.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="container">
		<button id="toggle-sidebar" style="position: fixed; top: 20px; left: 20px; z-index: 101; padding: 10px 15px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 20px;">â˜°</button>
        <div id="sidebar">
            <div id="header">
<img id="logo" src="images/logo_vam.png" alt="Logo">
                <div id="title">ğŸŒ Voyage avec Martin</div>
            </div>
			
			<div id="auth-section" style="margin-bottom: 20px; padding: 15px; background: rgba(76, 175, 80, 0.2); border-radius: 8px; text-align: center;">
			    <div id="logged-out" style="display: block;">
			        <p style="color: #4CAF50; margin-bottom: 10px;">ğŸ’¾ Sauvegarde tes voyages</p>
			        <button onclick="showAuthModal('login')" style="width: 100%; padding: 10px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; margin-bottom: 5px;">
			            ğŸ”‘ Connexion
			        </button>
			        <button onclick="showAuthModal('signup')" style="width: 100%; padding: 10px; background: #2196F3; border: none; border-radius: 5px; color: white; cursor: pointer;">
			            âœ¨ CrÃ©er un compte
			        </button>
			    </div>
    
			    <div id="logged-in" style="display: none;">
			        <p style="color: #4CAF50; margin-bottom: 10px;">ğŸ‘¤ <span id="user-email"></span></p>
			        <button onclick="signOut()" style="width: 100%; padding: 10px; background: #f44336; border: none; border-radius: 5px; color: white; cursor: pointer;">
			            ğŸšª DÃ©connexion
			        </button>
			    </div>
			</div>

<div id="stats">
    <h3>Statistiques</h3>
    <p><span id="visited-count">0</span> / <span id="total-count">0</span> pays visitÃ©s</p>
    <p>Note moyenne : <span id="avg-rating">-</span> â­</p>
    <p>Dernier voyage : <span id="last-country">-</span></p>
</div>

<button id="personal-stats-btn" style="width: 100%; padding: 12px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; margin-bottom: 20px; font-weight: bold;">
    ğŸ“Š Mes Statistiques DÃ©taillÃ©es
</button>
<button id="bucket-list-btn" style="width: 100%; padding: 12px; background: #FF9800; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; margin-bottom: 20px; font-weight: bold;">
    ğŸ¯ Ma Bucket List
</button>
<button id="search-general-flights-btn" style="width: 100%; padding: 12px; background: #2196F3; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; margin-bottom: 20px; font-weight: bold;">
    âœˆï¸ Chercher des vols
</button>
<button id="itinerary-btn" style="width: 100%; padding: 12px; background: #E91E63; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; margin-bottom: 20px; font-weight: bold;">
    ğŸ—ºï¸ Mes itinÃ©raires
</button>
<button id="games-btn" style="width: 100%; padding: 12px; background: #9C27B0; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; margin-bottom: 20px; font-weight: bold;">
    ğŸ® Jeux
</button>

            <input type="text" id="search-box" placeholder="ğŸ” Rechercher un pays...">
			<select id="rating-filter" style="width: 100%; padding: 10px; margin-bottom: 20px; background: #1a1a1a; color: #fff; border: 1px solid #444; border-radius: 5px; font-size: 14px;">
			    <option value="all">Toutes les notes</option>
			    <option value="5">â­â­â­â­â­ uniquement</option>
			    <option value="4">â­â­â­â­ et plus</option>
			    <option value="3">â­â­â­ et plus</option>
			    <option value="2">â­â­ et plus</option>
			    <option value="1">â­ et plus</option>
			    <option value="0">Pays visitÃ©s sans note</option>
			</select>

            <div id="continents-list"></div>
        </div>

        <div id="globe-container"></div>
        
<div id="controls">
    <button class="control-btn" onclick="resetView()">ğŸ”„ RÃ©initialiser</button>
    <button class="control-btn" onclick="toggleRotation()">ğŸ”„ Rotation</button>	
</div>

        <div id="overlay"></div>
        
        <div id="modal">
			<button id="close-modal-btn" onclick="closeModal()" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; min-width: 35px; min-height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 18px; font-weight: bold; padding: 0; display: flex; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);" onmouseover="this.style.background='#d32f2f'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='#f44336'; this.style.transform='scale(1)'">âœ•</button>
            <h2 id="modal-title">Pays</h2>
            <div class="form-group">
                <label>ğŸ“ Notes sur votre voyage :</label>
                <textarea id="notes-input" placeholder="Ce que vous avez aimÃ©, vos souvenirs, conseils..."></textarea>
            </div>
            <div class="form-group">
                <label>â­ Votre note :</label>
                <div class="rating" id="rating-stars">
                    <span class="star" data-rating="1">â˜…</span>
                    <span class="star" data-rating="2">â˜…</span>
                    <span class="star" data-rating="3">â˜…</span>
                    <span class="star" data-rating="4">â˜…</span>
                    <span class="star" data-rating="5">â˜…</span>
                </div>
    
				    <!-- Photos -->
				    <div class="form-group">
				        <label>ğŸ“¸ Photos de voyage (max 5) :</label>
				        <input type="file" id="photos-input" accept="image/*" multiple style="width: 100%; padding: 10px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff;">
				        <div id="photos-preview" style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;"></div>
				    </div>

				    <!-- Budget -->
				    <div class="form-group">
				        <label>ğŸ’° Budget dÃ©pensÃ© (â‚¬) :</label>
				        <input type="number" id="budget-input" placeholder="Ex: 1500" style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
				    </div>

				    <!-- ActivitÃ©s -->
				    <div class="form-group">
				        <label>ğŸ¯ ActivitÃ©s favorites :</label>
				        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="plage"> ğŸ–ï¸ Plage
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="montagne"> ğŸ”ï¸ Montagne
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="musees"> ğŸ›ï¸ MusÃ©es
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="gastronomie"> ğŸ½ï¸ Gastronomie
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="nightlife"> ğŸ‰ Vie nocturne
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="shopping"> ğŸ›ï¸ Shopping
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="nature"> ğŸŒ¿ Nature
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="aventure"> ğŸ§— Aventure
				            </label>
				        </div>
				    </div>

				    <!-- Compagnons -->
				    <div class="form-group">
				        <label>ğŸ‘¥ Avec qui avez-vous voyagÃ© ?</label>
				        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="companion-checkbox" data-companion="Solo"> ğŸ§³ Solo
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="companion-checkbox" data-companion="Couple"> ğŸ’‘ Couple
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="companion-checkbox" data-companion="Famille"> ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Famille
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="companion-checkbox" data-companion="Amis"> ğŸ‘¯ Amis
				            </label>
				        </div>
				    </div>

				    <div class="button-group">
				        <button class="btn-primary" id="save-btn">ğŸ’¾ Sauvegarder</button>
				        <button class="btn-primary" id="export-pdf-btn" style="background: #2196F3;">ğŸ“„ Export PDF</button>
						<button class="btn-primary" id="search-flights-btn" style="background: #2196F3;">
						    âœˆï¸ Rechercher des vols
						</button>
				        <button class="btn-bucket" id="add-bucket-btn" style="background: #FF9800; color: white; flex: 1;">ğŸ¯ Ajouter Ã  ma Bucket List</button>
				        <button class="btn-neutral" id="cancel-btn">âŒ Annuler</button>
				    </div>
				</div>
            </div>
        </div>
</div>
    
    <div id="flights-results"></div>
</div>

<!-- Modal ItinÃ©raire -->
<div id="itinerary-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #E91E63; width: 90%; max-width: 1000px; max-height: 90vh; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);">
    
<button id="close-itinerary-btn" onclick="closeItineraryModal()" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; min-width: 35px; min-height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 18px; font-weight: bold; padding: 0; display: flex; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);" onmouseover="this.style.background='#d32f2f'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='#f44336'; this.style.transform='scale(1)'">âœ•</button>    
    <h2 style="color: #E91E63; margin-bottom: 30px; text-align: center;">ğŸ—ºï¸ Mes ItinÃ©raires</h2>
    
    <!-- Liste des itinÃ©raires sauvegardÃ©s -->
    <div id="saved-itineraries" style="margin-bottom: 30px;">
        <h3 style="color: #E91E63; margin-bottom: 15px;">ğŸ“‹ ItinÃ©raires enregistrÃ©s</h3>
        <div id="itineraries-list"></div>
    </div>
    
    <!-- CrÃ©ation d'un nouvel itinÃ©raire -->
    <div style="background: rgba(233, 30, 99, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #E91E63;">
        <h3 style="color: #E91E63; margin-bottom: 15px;">â• CrÃ©er un nouvel itinÃ©raire</h3>
        
        <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; color: #ccc; font-weight: bold;">Nom de l'itinÃ©raire :</label>
            <input type="text" id="itinerary-name" placeholder="Ex: Road Trip Europe" style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
        </div>
        
        <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; color: #ccc; font-weight: bold;">Ajouter une Ã©tape :</label>
            <input type="text" id="itinerary-step" placeholder="Rechercher un pays..." style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
            <div id="itinerary-step-results" style="margin-top: 10px;"></div>
        </div>
        
        <div id="current-steps" style="margin-bottom: 15px;">
            <h4 style="color: #ccc; margin-bottom: 10px;">Ã‰tapes de votre itinÃ©raire :</h4>
            <div id="steps-list" style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; min-height: 60px;">
                <p style="color: #888; font-style: italic;">Aucune Ã©tape ajoutÃ©e</p>
            </div>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button id="save-itinerary-btn" style="flex: 1; padding: 15px; background: #4CAF50; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                ğŸ’¾ Enregistrer l'itinÃ©raire
            </button>
            <button id="visualize-itinerary-btn" style="flex: 1; padding: 15px; background: #E91E63; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                ğŸ‘ï¸ Visualiser sur le globe
            </button>
            <button id="clear-itinerary-btn" style="padding: 15px 20px; background: #f44336; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                ğŸ—‘ï¸ Effacer
            </button>
        </div>
    </div>
</div>
<div id="stats-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #4CAF50; width: 80%; max-width: 800px; max-height: 80vh; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);">
    <button id="close-stats-btn" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 20px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: background 0.3s;">âœ•</button>
    
    <h2 style="color: #4CAF50; margin-bottom: 30px; text-align: center;">ğŸ“Š Mes Statistiques de Voyage</h2>
    
    <div id="world-completion" style="margin-bottom: 30px; padding: 20px; background: rgba(76, 175, 80, 0.2); border-radius: 8px;">
        <h3 style="color: #4CAF50; margin-bottom: 15px;">ğŸŒ Monde</h3>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="flex: 1; background: #1a1a1a; height: 30px; border-radius: 15px; overflow: hidden;">
                <div id="world-progress-bar" style="height: 100%; background: linear-gradient(90deg, #4CAF50, #45a049); transition: width 0.3s; width: 0%;"></div>
            </div>
            <span id="world-percentage" style="font-size: 24px; font-weight: bold; color: #4CAF50; min-width: 70px;">0%</span>
        </div>
    </div>
    
    <div id="continents-completion"></div>
</div>
        
		
<div id="bucket-list-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #FF9800; width: 85%; max-width: 900px; max-height: 85vh; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);">
    <button id="close-bucket-btn" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 20px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: background 0.3s;">âœ•</button>
    
    <h2 style="color: #FF9800; margin-bottom: 30px; text-align: center;">ğŸ¯ Ma Bucket List</h2>
    
    <div style="display: flex; gap: 20px; margin-bottom: 30px;">
        <input type="text" id="bucket-search" placeholder="ğŸ” Rechercher un pays Ã  ajouter..." style="flex: 1; padding: 12px; background: #1a1a1a; color: #fff; border: 1px solid #444; border-radius: 5px; font-size: 14px;">
        <button id="suggestions-btn" style="padding: 12px 20px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; white-space: nowrap;">
            âœ¨ Suggestions
        </button>
    </div>
    
    <div id="bucket-search-results" style="margin-bottom: 20px;"></div>
    
    <div id="bucket-suggestions" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(76, 175, 80, 0.2); border-radius: 8px; border-left: 4px solid #4CAF50;">
        <h3 style="color: #4CAF50; margin-bottom: 15px;">ğŸ’¡ Suggestions basÃ©es sur vos voyages</h3>
        <div id="suggestions-content"></div>
    </div>
    
    <div id="bucket-list-content">
        <h3 style="color: #FF9800; margin-bottom: 20px;">ğŸ“‹ Vos destinations de rÃªve (<span id="bucket-count">0</span>)</h3>
        <div id="bucket-items"></div>
        <div id="bucket-empty" style="text-align: center; padding: 40px; color: #888;">
            <p style="font-size: 48px; margin-bottom: 10px;">ğŸ—ºï¸</p>
            <p>Votre bucket list est vide</p>
            <p style="font-size: 14px; margin-top: 10px;">Recherchez des pays ci-dessus ou cliquez sur "Suggestions"</p>
        </div>
    </div>
    
    <div id="itinerary-section" style="display: none; margin-top: 30px; padding: 20px; background: rgba(255, 152, 0, 0.2); border-radius: 8px; border-left: 4px solid #FF9800;">
        <h3 style="color: #FF9800; margin-bottom: 15px;">ğŸ—ºï¸ ItinÃ©raires suggÃ©rÃ©s</h3>
        <div id="itinerary-content"></div>
    </div>
</div>

<div id="games-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #9C27B0; width: 85%; max-width: 900px; max-height: 85vh; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);">

    <button id="close-games-btn" onclick="closeGamesModal()" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; min-width: 35px; min-height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 18px; font-weight: bold; padding: 0; display: flex; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);" onmouseover="this.style.background='#d32f2f'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='#f44336'; this.style.transform='scale(1)'">âœ•</button>
    
    <h2 style="color: #9C27B0; margin-bottom: 30px; text-align: center;">ğŸ® Mini-Jeux</h2>
    
    <!-- Menu des jeux -->
<div id="games-menu" style="display: block;">
    <h3 style="color: #9C27B0; margin-bottom: 20px; text-align: center;">Choisis ton jeu</h3>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <!-- Jeu Quiz -->
        <button onclick="showQuizLevels()" style="padding: 25px 20px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 12px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s; text-align: center;">
            <div style="font-size: 35px; margin-bottom: 8px;">ğŸŒ</div>
            <div style="font-size: 18px; margin-bottom: 6px;">Quiz GÃ©ographie</div>
            <div style="font-size: 13px; font-weight: normal; opacity: 0.9;">Devine le pays Ã  partir d'indices</div>
        </button>
        
        <!-- Jeu Higher or Lower -->
        <button onclick="showHigherLowerLevels()" style="padding: 25px 20px; background: linear-gradient(135deg, #f093fb, #f5576c); border: none; border-radius: 12px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s; text-align: center;">
            <div style="font-size: 35px; margin-bottom: 8px;">ğŸ“Š</div>
            <div style="font-size: 18px; margin-bottom: 6px;">Higher or Lower</div>
            <div style="font-size: 13px; font-weight: normal; opacity: 0.9;">Devine quel pays a le plus !</div>
        </button>
        
        <!-- Jeu Hold my beer -->
        <button onclick="showBeerLevels()" style="padding: 25px 20px; background: linear-gradient(135deg, #FFA500, #FF6347); border: none; border-radius: 12px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s; text-align: center;">
            <div style="font-size: 35px; margin-bottom: 8px;">ğŸº</div>
            <div style="font-size: 18px; margin-bottom: 6px;">Hold my Beer</div>
            <div style="font-size: 13px; font-weight: normal; opacity: 0.9;">Retrouve l'origine des biÃ¨res</div>
        </button>
        
        <!-- Jeu Interpol : Chasse Ã  l'homme -->
        <button onclick="showInterpolLevels()" style="padding: 25px 20px; background: linear-gradient(135deg, #DC143C, #8B0000); border: none; border-radius: 12px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s; text-align: center;">
            <div style="font-size: 35px; margin-bottom: 8px;">ğŸ•µï¸</div>
            <div style="font-size: 18px; margin-bottom: 6px;">Interpol : Chasse Ã  l'homme</div>
            <div style="font-size: 13px; font-weight: normal; opacity: 0.9;">Retrouve le fugitif avec des indices</div>
        </button>
        
        <!-- Placeholder jeux futurs - Prend toute la largeur -->
        <div style="grid-column: 1 / -1; padding: 25px; background: rgba(100, 100, 100, 0.3); border: 2px dashed #666; border-radius: 12px; text-align: center; color: #888;">
            <div style="font-size: 35px; margin-bottom: 8px;">ğŸ“œ</div>
            <div style="font-weight: bold; font-size: 16px;">Plus de jeux bientÃ´t...</div>
            <div style="font-size: 13px; margin-top: 5px;">Drapeaux, Capitales, et plus encore !</div>
        </div>
    </div>
</div>

<div id="itinerary-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #E91E63; width: 90%; max-width: 1000px; max-height: 90vh; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);">
    
<button id="close-itinerary-btn" onclick="closeItineraryModal()" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; min-width: 35px; min-height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 18px; font-weight: bold; padding: 0; display: flex; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);" onmouseover="this.style.background='#d32f2f'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='#f44336'; this.style.transform='scale(1)'">âœ•</button>
    
    <h2 style="color: #E91E63; margin-bottom: 30px; text-align: center;">ğŸ—ºï¸ Mes ItinÃ©raires</h2>
    
    <!-- Liste des itinÃ©raires sauvegardÃ©s -->
    <div id="saved-itineraries" style="margin-bottom: 30px;">
        <h3 style="color: #E91E63; margin-bottom: 15px;">ğŸ“‹ ItinÃ©raires enregistrÃ©s</h3>
        <div id="itineraries-list"></div>
    </div>
    
    <!-- CrÃ©ation d'un nouvel itinÃ©raire -->
    <div style="background: rgba(233, 30, 99, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #E91E63;">
        <h3 style="color: #E91E63; margin-bottom: 15px;">â• CrÃ©er un nouvel itinÃ©raire</h3>
        
        <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; color: #ccc; font-weight: bold;">Nom de l'itinÃ©raire :</label>
            <input type="text" id="itinerary-name" placeholder="Ex: Road Trip Europe" style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
        </div>
        
        <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; color: #ccc; font-weight: bold;">Ajouter une Ã©tape :</label>
            <input type="text" id="itinerary-step" placeholder="Rechercher une ville ou un pays..." style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
            <div id="itinerary-step-results" style="margin-top: 10px;"></div>
        </div>
        
        <div id="current-steps" style="margin-bottom: 15px;">
            <h4 style="color: #ccc; margin-bottom: 10px;">Ã‰tapes de votre itinÃ©raire :</h4>
            <div id="steps-list" style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; min-height: 60px;">
                <p style="color: #888; font-style: italic;">Aucune Ã©tape ajoutÃ©e</p>
            </div>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button id="save-itinerary-btn" style="flex: 1; padding: 15px; background: #4CAF50; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                ğŸ’¾ Enregistrer l'itinÃ©raire
            </button>
            <button id="visualize-itinerary-btn" style="flex: 1; padding: 15px; background: #E91E63; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                ğŸ‘ï¸ Visualiser sur le globe
            </button>
            <button id="clear-itinerary-btn" style="padding: 15px 20px; background: #f44336; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                ğŸ—‘ï¸ Effacer
            </button>
        </div>
    </div>
</div>

<!-- Menu de sÃ©lection des niveaux -->
<div id="quiz-levels-menu" style="display: none;">
    <button onclick="backToGamesMenu()" style="margin-bottom: 20px; padding: 10px 20px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer;">
        â† Retour aux jeux
    </button>
    
    <h3 style="color: #9C27B0; margin-bottom: 20px; text-align: center;">ğŸŒ Quiz GÃ©ographie</h3>
    <p style="text-align: center; color: #ccc; margin-bottom: 25px; font-size: 14px;">Choisis ton niveau de difficultÃ©</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <button onclick="startQuizGame(1)" style="padding: 25px; background: linear-gradient(135deg, #4CAF50, #45a049); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s;">
            ğŸŸ¢ FACILE
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">Un niveau accessible Ã  tout Ã¢ge</div>
        </button>
        
        <button onclick="startQuizGame(2)" style="padding: 25px; background: linear-gradient(135deg, #FF9800, #F57C00); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s;">
            ğŸŸ¡ MOYEN
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">Pas si simple</div>
        </button>
        
        <button onclick="startQuizGame(3)" style="padding: 25px; background: linear-gradient(135deg, #f44336, #d32f2f); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s;">
            ğŸ”´ DIFFICILE
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">Pour les experts</div>
        </button>
        
        <button onclick="startQuizGame('mix')" style="padding: 25px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s;">
            ğŸ¯ MIX
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">Tous les niveaux</div>
        </button>
    </div>
</div>

<!-- Menu Higher or Lower -->
<div id="higher-lower-menu" style="display: none;">
    <button onclick="backToGamesMenu()" style="margin-bottom: 20px; padding: 10px 20px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer;">
        â† Retour aux jeux
    </button>
    
    <h3 style="color: #f093fb; margin-bottom: 20px; text-align: center;">ğŸ“Š Higher or Lower</h3>
    <p style="text-align: center; color: #ccc; margin-bottom: 25px; font-size: 14px;">Choisis une catÃ©gorie</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <button onclick="startHigherLower('population')" style="padding: 25px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ‘¥ POPULATION
            <div style="font-size: 12px; margin-top: 8px;">Nombre d'habitants</div>
        </button>
        
        <button onclick="startHigherLower('surface')" style="padding: 25px; background: linear-gradient(135deg, #4CAF50, #45a049); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ—ºï¸ SUPERFICIE
            <div style="font-size: 12px; margin-top: 8px;">Taille en kmÂ²</div>
        </button>
        
        <button onclick="startHigherLower('pib')" style="padding: 25px; background: linear-gradient(135deg, #FF9800, #F57C00); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ’° PIB
            <div style="font-size: 12px; margin-top: 8px;">Richesse Ã©conomique</div>
        </button>
        
        <button onclick="startHigherLower('medaillesJO')" style="padding: 25px; background: linear-gradient(135deg, #FFD700, #FFA500); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ¥‡ MÃ‰DAILLES JO
            <div style="font-size: 12px; margin-top: 8px;">Cumul historique</div>
        </button>
        
        <button onclick="startHigherLower('batailles')" style="padding: 25px; background: linear-gradient(135deg, #f44336, #d32f2f); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            âš”ï¸ BATAILLES
            <div style="font-size: 12px; margin-top: 8px;">Victoires historiques</div>
        </button>
		
		<button onclick="startHigherLower('unesco')" style="padding: 25px; background: linear-gradient(135deg, #2196F3, #1976D2); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
		    ğŸ›ï¸ UNESCO
		    <div style="font-size: 12px; margin-top: 8px;">Sites classÃ©s</div>
		</button>

		<button onclick="startHigherLower('tourisme')" style="padding: 25px; background: linear-gradient(135deg, #00BCD4, #0097A7); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
		    âœˆï¸ TOURISME
		    <div style="font-size: 12px; margin-top: 8px;">Visiteurs annuels</div>
		</button>
		
        <button onclick="startHigherLower('random')" style="padding: 25px; background: linear-gradient(135deg, #9C27B0, #E91E63); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ² ALÃ‰ATOIRE
            <div style="font-size: 12px; margin-top: 8px;">Toutes les catÃ©gories mÃ©langÃ©es !</div>
        </button>
    </div>
</div>

<!-- Zone de jeu Higher or Lower -->
<div id="higher-lower-game" style="display: none;">
    <div style="text-align: center; margin-bottom: 20px;">
        <div style="display: inline-block; padding: 10px 20px; background: rgba(240, 147, 251, 0.3); border-radius: 20px;">
            <span style="font-size: 18px; font-weight: bold; color: #f093fb;">Streak: <span id="hl-streak">0</span></span>
            <span style="margin: 0 15px; color: #666;">|</span>
            <span style="font-size: 18px; font-weight: bold; color: #4CAF50;">Record: <span id="hl-record">0</span></span>
        </div>
    </div>
    
    <div id="hl-category" style="text-align: center; font-size: 24px; font-weight: bold; color: #f093fb; margin-bottom: 20px;"></div>
    
    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center;">
        <!-- Pays de gauche -->
        <div id="hl-left-card" style="background: rgba(100, 100, 100, 0.3); border-radius: 15px; padding: 30px; text-align: center; border: 3px solid #666;">
            <div id="hl-left-country" style="font-size: 32px; font-weight: bold; margin-bottom: 20px;"></div>
            <div id="hl-left-value" style="font-size: 48px; font-weight: bold; color: #4CAF50;"></div>
        </div>
        
        <!-- VS -->
        <div style="font-size: 48px; font-weight: bold; color: #f093fb;">VS</div>
        
        <!-- Pays de droite -->
        <div id="hl-right-card" style="background: rgba(100, 100, 100, 0.3); border-radius: 15px; padding: 30px; text-align: center; border: 3px solid #666;">
            <div id="hl-right-country" style="font-size: 32px; font-weight: bold; margin-bottom: 20px;"></div>
            <div id="hl-right-value" style="font-size: 48px; font-weight: bold; color: transparent; text-shadow: 0 0 20px rgba(255,255,255,0.3);">???</div>
            
            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button id="hl-btn-higher" onclick="guessHigherLower('higher')" style="flex: 1; padding: 20px; background: #4CAF50; border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 18px;">
                    â¬†ï¸ PLUS
                </button>
                <button id="hl-btn-lower" onclick="guessHigherLower('lower')" style="flex: 1; padding: 20px; background: #f44336; border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 18px;">
                    â¬‡ï¸ MOINS
                </button>
            </div>
        </div>
    </div>
    
    <div id="hl-feedback" style="display: none; padding: 20px; border-radius: 10px; text-align: center; font-size: 18px; font-weight: bold; margin-top: 20px;"></div>
    
    <div style="text-align: center; margin-top: 20px;">
        <button onclick="backToGamesMenu()" style="padding: 10px 25px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer;">
            â† Retour au menu
        </button>
    </div>
</div>

<!-- Ã‰cran Game Over -->
<!-- Ã‰cran Game Over -->
<div id="higher-lower-end" style="display: none; text-align: center;">
    <div style="font-size: 60px; margin-bottom: 20px;">ğŸ’”</div>
    <h3 style="color: #f44336; font-size: 32px; margin-bottom: 20px;">Game Over !</h3>
    
    <div style="font-size: 24px; margin-bottom: 20px;">
        Streak final: <span id="hl-final-streak" style="color: #f093fb; font-weight: bold;">0</span>
    </div>
    
    <div id="hl-end-message" style="font-size: 18px; color: #ccc; margin-bottom: 20px;"></div>
    
    <!-- ğŸ†• NOUVEAU : Zone du leaderboard -->
    <div id="hl-leaderboard" style="max-width: 400px; margin: 0 auto 30px;"></div>
    
    <div style="display: flex; gap: 15px; justify-content: center;">
        <button onclick="restartHigherLower()" style="padding: 15px 30px; background: #4CAF50; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ”„ Rejouer
        </button>
        <button onclick="backToGamesMenu()" style="padding: 15px 30px; background: #555; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            â† Menu
        </button>
    </div>
</div>

<!-- Menu Beer Game -->
<div id="beer-levels-menu" style="display: none;">
    <button onclick="backToGamesMenu()" style="margin-bottom: 20px; padding: 10px 20px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer;">
        â† Retour aux jeux
    </button>
    
    <h3 style="color: #FFA500; margin-bottom: 20px; text-align: center;">ğŸº Hold my Beer</h3>
    <p style="text-align: center; color: #ccc; margin-bottom: 25px; font-size: 14px;">Choisis ton mode de jeu</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <button onclick="startBeerGame('mixologue')" style="padding: 25px; background: linear-gradient(135deg, #4CAF50, #45a049); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ—ºï¸ LE MIXOLOGUE
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">Clique sur le pays d'origine de cette marque de biÃ¨re !</div>
        </button>
        
        <button onclick="startBeerGame('tour')" style="padding: 25px; background: linear-gradient(135deg, #FF9800, #F57C00); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            âœˆï¸ TOUR DU MONDE
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">Devine la biÃ¨re locale selon le pays dans lequel se trouve Martin !</div>
        </button>
    </div>
</div>

<!-- Zone de jeu Mixologue -->
<div id="beer-mixologue-game" style="display: none;">
    <div style="text-align: center; margin-bottom: 20px;">
        <span style="font-size: 18px; font-weight: bold; color: #FFA500;">Score: <span id="beer-score">0</span>/10</span>
    </div>
    
    <div style="text-align: center; margin-bottom: 30px;">
        <div style="font-size: 24px; font-weight: bold; color: #fff; margin-bottom: 10px;">De quel pays vient cette biÃ¨re ?</div>
        <div id="beer-brand" style="font-size: 48px; font-weight: bold; color: #FFA500; margin: 20px 0;">ğŸº ---</div>
        <div style="font-size: 14px; color: #888;">Clique sur un pays de la liste</div>
    </div>
    
    <div id="beer-countries-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-height: 300px; overflow-y: auto;"></div>
    
    <div id="beer-feedback" style="display: none; padding: 20px; border-radius: 10px; text-align: center; font-size: 18px; font-weight: bold; margin-top: 20px;"></div>
    
    <button onclick="backToGamesMenu()" style="margin-top: 20px; padding: 10px 25px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer; display: block; margin-left: auto; margin-right: auto;">
        â† Retour au menu
    </button>
</div>

<!-- Zone de jeu Tour du Monde -->
<div id="beer-tour-game" style="display: none;">
    <div style="text-align: center; margin-bottom: 20px;">
        <span style="font-size: 18px; font-weight: bold; color: #FFA500;">Score: <span id="beer-tour-score">0</span>/10</span>
    </div>
    
    <div style="text-align: center; margin-bottom: 30px;">
        <div style="font-size: 20px; color: #fff; margin-bottom: 15px;">Martin est en voyage...</div>
        <div id="beer-tour-country" style="font-size: 36px; font-weight: bold; color: #FFA500; margin: 20px 0;">ğŸŒ ---</div>
        <div style="font-size: 18px; color: #ccc;">Quelle biÃ¨re va-t-on lui servir ?</div>
    </div>
    
    <div id="beer-tour-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;"></div>
    
    <div id="beer-tour-feedback" style="display: none; padding: 20px; border-radius: 10px; text-align: center; font-size: 16px; margin-top: 20px;"></div>
    
    <button onclick="backToGamesMenu()" style="margin-top: 20px; padding: 10px 25px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer; display: block; margin-left: auto; margin-right: auto;">
        â† Retour au menu
    </button>
</div>

<!-- Ã‰cran de fin Beer Game -->
<div id="beer-end" style="display: none; text-align: center;">
    <div style="font-size: 60px; margin-bottom: 20px;">ğŸ»</div>
    <h3 style="color: #FFA500; font-size: 32px; margin-bottom: 20px;">Partie terminÃ©e !</h3>
    <div style="font-size: 24px; margin-bottom: 30px;">
        Score final: <span id="beer-final-score" style="color: #FFA500; font-weight: bold;">0</span>/10
    </div>
    <div id="beer-end-message" style="font-size: 18px; color: #ccc; margin-bottom: 30px;"></div>
    <div style="display: flex; gap: 15px; justify-content: center;">
        <button onclick="restartBeerGame()" style="padding: 15px 30px; background: #4CAF50; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ”„ Rejouer
        </button>
        <button onclick="backToGamesMenu()" style="padding: 15px 30px; background: #555; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            â† Menu
        </button>
    </div>
</div>

<!-- Menu Interpol -->
<div id="interpol-levels-menu" style="display: none;">
    <button onclick="backToGamesMenu()" style="margin-bottom: 20px; padding: 10px 20px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer;">
        â† Retour aux jeux
    </button>
    
    <h3 style="color: #DC143C; margin-bottom: 20px; text-align: center;">ğŸ•µï¸ Interpol : Chasse Ã  l'homme</h3>
    <p style="text-align: center; color: #ccc; margin-bottom: 25px; font-size: 14px;">Choisis ton niveau de difficultÃ©</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <button onclick="startInterpolGame('easy')" style="padding: 25px; background: linear-gradient(135deg, #4CAF50, #45a049); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸŸ¢ FACILE
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">5 indices, 10 tentatives</div>
        </button>
        
        <button onclick="startInterpolGame('medium')" style="padding: 25px; background: linear-gradient(135deg, #FF9800, #F57C00); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸŸ¡ MOYEN
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">4 indices, 8 tentatives</div>
        </button>
        
        <button onclick="startInterpolGame('hard')" style="padding: 25px; background: linear-gradient(135deg, #f44336, #d32f2f); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ”´ DIFFICILE
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">3 indices, 5 tentatives</div>
        </button>
        
        <button onclick="startInterpolGame('expert')" style="padding: 25px; background: linear-gradient(135deg, #9C27B0, #7B1FA2); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            âš« EXPERT
            <div style="font-size: 12px; font-weight: normal; margin-top: 8px; opacity: 0.9;">2 indices, 3 tentatives</div>
        </button>
    </div>
</div>

<!-- Zone de jeu Interpol -->
<div id="interpol-game" style="display: none;">
    <div style="display: flex; flex-direction: column; height: 100%; gap: 20px;">
        
        <!-- Header avec mission -->
        <div style="display: flex; gap: 20px; align-items: center;">
            <div style="padding: 15px 25px; background: rgba(220, 20, 60, 0.3); border-radius: 20px;">
                <span style="font-size: 20px; font-weight: bold; color: #DC143C;">
                    ğŸ¯ Tentatives: <span id="interpol-attempts">0</span>/<span id="interpol-max-attempts">10</span>
                </span>
            </div>
            
            <div style="flex: 1; background: rgba(220, 20, 60, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #DC143C;">
                <h3 style="color: #DC143C; margin-bottom: 10px; font-size: 18px;">ğŸš¨ Mission Interpol</h3>
                <p id="interpol-mission" style="color: #fff; font-size: 14px; line-height: 1.6;"></p>
            </div>
        </div>
        
        <!-- Zone principale : Indices + Recherche -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; flex: 1;">
            
            <!-- Colonne gauche : Indices -->
            <div style="background: rgba(100, 100, 100, 0.3); padding: 20px; border-radius: 10px; overflow-y: auto; border: 2px solid #FFD700;">
                <h3 style="color: #FFD700; margin-bottom: 15px; font-size: 20px;">ğŸ” Dossier confidentiel</h3>
                <div id="interpol-clues" style="color: #fff;"></div>
                
                <button id="interpol-next-clue-btn" onclick="revealNextClue()" style="width: 100%; margin-top: 20px; padding: 15px; background: #FFD700; border: none; border-radius: 8px; color: #000; cursor: pointer; font-weight: bold; font-size: 16px;">
                    ğŸ’¡ RÃ©vÃ©ler un nouvel indice
                </button>
            </div>
            
            <!-- Colonne droite : Recherche de pays -->
            <div style="background: rgba(220, 20, 60, 0.15); padding: 20px; border-radius: 10px; border: 2px solid #DC143C; display: flex; flex-direction: column;">
                <h3 style="color: #DC143C; margin-bottom: 15px; font-size: 20px;">ğŸŒ OÃ¹ se cache le fugitif ?</h3>
                
                <input type="text" id="interpol-search" placeholder="ğŸ” Tapez un pays pour l'arrÃªter..." style="width: 100%; padding: 15px; font-size: 16px; border: 2px solid #DC143C; border-radius: 8px; background: #1a1a1a; color: #fff; margin-bottom: 15px;">
                
                <div id="interpol-countries-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-height: 400px; overflow-y: auto;">
                    <!-- Les pays seront gÃ©nÃ©rÃ©s ici -->
                </div>
            </div>
        </div>
                
        <div style="text-align: center;">
            <button onclick="backToGamesMenu(); destroyInterpolMap();" style="padding: 12px 30px; background: #555; border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px;">
                â† Retour au menu
            </button>
        </div>
    </div>
</div>

<!-- Ã‰cran de fin Interpol -->
<div id="interpol-end" style="display: none; text-align: center;">
    <div id="interpol-end-icon" style="font-size: 60px; margin-bottom: 20px;"></div>
    <h3 id="interpol-end-title" style="font-size: 32px; margin-bottom: 20px;"></h3>
    <div id="interpol-end-message" style="font-size: 18px; color: #ccc; margin-bottom: 30px;"></div>
    <div style="display: flex; gap: 15px; justify-content: center;">
        <button onclick="restartInterpolGame()" style="padding: 15px 30px; background: #4CAF50; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            ğŸ”„ Rejouer
        </button>
        <button onclick="backToGamesMenu()" style="padding: 15px 30px; background: #555; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
            â† Menu
        </button>
    </div>
</div>
    
    <!-- Zone de jeu du Quiz -->
    <div id="quiz-game" style="display: none;">
        <div style="text-align: center; margin-bottom: 20px;">
            <div style="display: inline-block; padding: 10px 20px; background: rgba(156, 39, 176, 0.3); border-radius: 20px;">
                <span style="font-size: 18px; font-weight: bold; color: #9C27B0;">Score: <span id="quiz-score">0</span>/10</span>
                <span style="margin: 0 15px; color: #666;">|</span>
                <span style="font-size: 18px; font-weight: bold; color: #4CAF50;">âœ“ <span id="quiz-correct">0</span></span>
                <span style="margin: 0 10px; color: #666;">|</span>
                <span style="font-size: 18px; font-weight: bold; color: #f44336;">âœ— <span id="quiz-wrong">0</span></span>
            </div>
        </div>
        
        <div id="quiz-question-container" style="margin-bottom: 25px;">
            <div id="quiz-question" style="font-size: 20px; font-weight: bold; color: #fff; text-align: center; margin-bottom: 20px;"></div>
            <div id="quiz-image-container" style="text-align: center; margin-bottom: 20px;"></div>
            <div id="quiz-hint" style="text-align: center; color: #FFD700; font-size: 14px; margin-bottom: 20px;"></div>
        </div>
        
        <div id="quiz-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;"></div>
        
        <div id="quiz-feedback" style="display: none; padding: 20px; border-radius: 10px; text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 20px;"></div>
        
        <div style="text-align: center;">
            <button id="quiz-next-btn" onclick="nextQuizQuestion()" style="display: none; padding: 15px 40px; background: #4CAF50; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                Question suivante â†’
            </button>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="backToGamesMenu()" style="padding: 10px 25px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer;">
                â† Retour au menu
            </button>
        </div>
    </div>
    
    <!-- Ã‰cran de fin -->
    <div id="quiz-end" style="display: none; text-align: center;">
        <div style="font-size: 60px; margin-bottom: 20px;">ğŸ†</div>
        <h3 style="color: #FFD700; font-size: 32px; margin-bottom: 20px;">Quiz terminÃ© !</h3>
        <div style="font-size: 24px; margin-bottom: 30px;">
            Score final: <span id="final-score" style="color: #4CAF50; font-weight: bold;">0</span>/10
        </div>
        <div id="quiz-message" style="font-size: 18px; color: #ccc; margin-bottom: 30px;"></div>
        <div style="display: flex; gap: 15px; justify-content: center;">
            <button onclick="startQuizGame(currentDifficulty)" style="padding: 15px 30px; background: #4CAF50; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                ğŸ”„ Rejouer
            </button>
            <button onclick="backToGamesMenu()" style="padding: 15px 30px; background: #555; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px;">
                â† Menu
            </button>
        </div>
    </div>
</div>

<div id="auth-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #4CAF50; min-width: 400px; max-width: 500px; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);">
    
    <button onclick="closeAuthModal()" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 18px; font-weight: bold; transition: all 0.3s;">âœ•</button>
    
    <h2 id="auth-title" style="color: #4CAF50; margin-bottom: 20px; text-align: center;">Connexion</h2>
    
    <input type="text" id="auth-username" placeholder="Pseudo" 
           style="display: none; width: 100%; padding: 12px; margin-bottom: 15px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
    
    <input type="email" id="auth-email" placeholder="Email" 
           style="width: 100%; padding: 12px; margin-bottom: 15px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
    
    <input type="password" id="auth-password" placeholder="Mot de passe (min. 6 caractÃ¨res)" 
           style="width: 100%; padding: 12px; margin-bottom: 20px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
    
    <button id="auth-submit" style="width: 100%; padding: 15px; background: #4CAF50; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; transition: all 0.3s;" onmouseover="this.style.background='#45a049'" onmouseout="this.style.background='#4CAF50'">
        Se connecter
    </button>
</div>

    <!-- Three.js et Globe.GL -->
    <script src="https://unpkg.com/three"></script>
    <script src="https://unpkg.com/globe.gl"></script>
	<script src="js/config/countries.js"></script>
	<script src="js/config/continents.js"></script>
	<script src="js/config/countryCoordinates.js"></script>
	<script src="js/config/countriesData.js"></script>
	<script src="js/config/beerData.js"></script>
	<script src="js/features/games/quiz.js"></script>
	<script src="js/features/games/higherLower.js"></script>
	<script src="js/features/games/beerGame.js"></script>
	<script src="js/features/games/interpolGame.js"></script>
	

    <script>
        let visitedCountries = {};
        let currentRating = 0;
        let selectedCountry = null;
        let myGlobe;
        let countriesGeoJson;
		
		async function loadData() {
		    await initStorageMode();
		    const user = await getCurrentUser();
    
		    if (user) {
		        // Mode cloud : charger depuis Supabase
		        const { data, error } = await supabaseClient
		            .from('visited_countries')
		            .select('*')
		            .eq('user_id', user.id);
        
		        if (data) {
		            visitedCountries = {};
		            data.forEach(row => {
		                visitedCountries[row.country_name] = {
		                    visited: true,
		                    notes: row.notes,
		                    rating: row.rating,
		                    date: row.visit_date,
		                    budget: row.budget,
		                    photos: row.photos || [],
		                    activities: row.activities || {},
		                    companions: row.companions || []
		                };
		            });
		        }
        
		        // Afficher email utilisateur
				// Afficher le pseudo de l'utilisateur
				document.getElementById('logged-in').style.display = 'block';
				document.getElementById('logged-out').style.display = 'none';

				// RÃ©cupÃ©rer le profil pour avoir le username
				const profile = await getUserProfile();
				if (profile && profile.username) {
				    document.getElementById('user-email').textContent = profile.username;
				} else {
				    // Fallback sur l'email si pas de pseudo
				    document.getElementById('user-email').textContent = user.email;
				}
		    } else {
		        // Mode local : charger depuis localStorage
		        const saved = localStorage.getItem('travelData');
		        if (saved) {
		            visitedCountries = JSON.parse(saved);
		        }
		    }
		}

		async function saveData() {
		    const user = await getCurrentUser();
    
		    if (user) {
		        // Sauvegarder dans Supabase
		        // (le code de sauvegarde sera dans saveCountryDetails)
		    } else {
		        // Sauvegarder en local
		        localStorage.setItem('travelData', JSON.stringify(visitedCountries));
		    }
		}

        function initContinentsList() {
            const container = document.getElementById('continents-list');
            
            Object.keys(continents).forEach(continentName => {
                const continent = continents[continentName];
                const section = document.createElement('div');
                section.className = 'continent-section';
                
                const header = document.createElement('div');
                header.className = 'continent-header';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'continent-name';
                nameDiv.innerHTML = `<span class="arrow">â–¶</span> ${continent.emoji} ${continentName}`;
                
                const stats = document.createElement('div');
                stats.className = 'continent-stats';
                const visited = continent.countries.filter(c => visitedCountries[c]).length;
                const total = continent.countries.length;
                stats.textContent = `${visited}/${total}`;
                
                header.appendChild(nameDiv);
                header.appendChild(stats);
                
                const countriesDiv = document.createElement('div');
                countriesDiv.className = 'continent-countries';
                
                const sortedCountries = continent.countries.sort();
                sortedCountries.forEach(countryName => {
                    const item = createCountryItem(countryName);
                    countriesDiv.appendChild(item);
                });
                
                header.addEventListener('click', () => {
                    countriesDiv.classList.toggle('open');
                    header.querySelector('.arrow').classList.toggle('open');
                });
                
                section.appendChild(header);
                section.appendChild(countriesDiv);
                container.appendChild(section);
            });
            
            updateStats();
        }

        function createCountryItem(countryName) {
            const item = document.createElement('div');
            item.className = 'country-item';
            if (visitedCountries[countryName]) {
                item.classList.add('visited');
            }
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'country-checkbox';
            checkbox.checked = !!visitedCountries[countryName];
            checkbox.addEventListener('change', (e) => {
                e.stopPropagation();
                toggleCountry(countryName, e.target.checked);
            });
            
            const name = document.createElement('span');
            name.className = 'country-name';
            name.textContent = countryName;
            
            const rating = document.createElement('span');
            rating.className = 'country-rating';
            if (visitedCountries[countryName] && visitedCountries[countryName].rating) {
                rating.textContent = 'â­'.repeat(visitedCountries[countryName].rating);
            }
            
            item.appendChild(checkbox);
            item.appendChild(name);
            item.appendChild(rating);
            
            item.addEventListener('click', (e) => {
                if (e.target !== checkbox) {
                    openModal(countryName);
                }
            });
            
            return item;
        }

		document.addEventListener('DOMContentLoaded', () => {
		    const searchBox = document.getElementById('search-box');
		    searchBox.addEventListener('input', (e) => {
		        const search = e.target.value.toLowerCase();
		        const items = document.querySelectorAll('.country-item');
		        const sections = document.querySelectorAll('.continent-section');
        
		        if (search === '') {
		            items.forEach(item => item.style.display = 'flex');
		            sections.forEach(section => section.style.display = 'block');
		            return;
		        }
        
		        items.forEach(item => {
		            const countryName = item.querySelector('.country-name').textContent.toLowerCase();
		            if (countryName.includes(search)) {
		                item.style.display = 'flex';
		                item.parentElement.classList.add('open');
		                item.closest('.continent-section').style.display = 'block';
		            } else {
		                item.style.display = 'none';
		            }
		        });
        
		        sections.forEach(section => {
		            const visibleItems = section.querySelectorAll('.country-item[style="display: flex;"]');
		            if (visibleItems.length === 0) {
		                section.style.display = 'none';
		            }
		        });
		    });

		    const ratingFilter = document.getElementById('rating-filter');
		    ratingFilter.addEventListener('change', (e) => {
		        const filterValue = e.target.value;
		        const items = document.querySelectorAll('.country-item');
		        const sections = document.querySelectorAll('.continent-section');
        
		        items.forEach(item => {
		            const countryName = item.querySelector('.country-name').textContent;
		            const countryData = visitedCountries[countryName];
            
		            if (filterValue === 'all') {
		                item.style.display = 'flex';
		            } else if (filterValue === '0') {
		                if (countryData && countryData.rating === 0) {
		                    item.style.display = 'flex';
		                } else {
		                    item.style.display = 'none';
		                }
		            } else {
		                const minRating = parseInt(filterValue);
		                if (countryData && countryData.rating >= minRating) {
		                    item.style.display = 'flex';
		                    item.parentElement.classList.add('open');
		                } else {
		                    item.style.display = 'none';
		                }
		            }
		        });
        
		        sections.forEach(section => {
		            const visibleItems = section.querySelectorAll('.country-item[style="display: flex;"]');
		            if (visibleItems.length === 0) {
		                section.style.display = 'none';
		            } else {
		                section.style.display = 'block';
		            }
		        });
		    });
		});

        function toggleCountry(countryName, isVisited) {
            if (isVisited) {
                if (!visitedCountries[countryName]) {
                    visitedCountries[countryName] = {
                        visited: true,
                        notes: '',
                        rating: 0,
                        date: new Date().toISOString(),
					    photos: [], // URLs des photos (max 5)
					    budget: 0,
					    activities: {
					        plage: false,
					        montagne: false,
					        musees: false,
					        gastronomie: false,
					        nightlife: false,
					        shopping: false,
					        nature: false,
					        aventure: false
					    },
					    companions: [] // ["Solo", "Famille", "Amis", "Couple"]
					};
                }
            } else {
                delete visitedCountries[countryName];
            }
            
            saveData();
            updateGlobeColors();
            updateCountryItem(countryName);
            updateAllContinentStats();
            updateStats();
        }

        function updateCountryItem(countryName) {
            const items = document.querySelectorAll('.country-item');
            items.forEach(item => {
                const name = item.querySelector('.country-name').textContent;
                if (name === countryName) {
                    const checkbox = item.querySelector('.country-checkbox');
                    const rating = item.querySelector('.country-rating');
                    
                    if (visitedCountries[countryName]) {
                        item.classList.add('visited');
                        checkbox.checked = true;
                        if (visitedCountries[countryName].rating) {
                            rating.textContent = 'â­'.repeat(visitedCountries[countryName].rating);
                        } else {
                            rating.textContent = '';
                        }
                    } else {
                        item.classList.remove('visited');
                        checkbox.checked = false;
                        rating.textContent = '';
                    }
                }
            });
        }

        function updateAllContinentStats() {
            const headers = document.querySelectorAll('.continent-header');
            headers.forEach((header, index) => {
                const continentName = Object.keys(continents)[index];
                const continent = continents[continentName];
                const visited = continent.countries.filter(c => visitedCountries[c]).length;
                const total = continent.countries.length;
                header.querySelector('.continent-stats').textContent = `${visited}/${total}`;
            });
        }

		function updateStats() {
		    let visitedCount = 0;
		    let totalCount = 0;
		    let totalRating = 0;
		    let ratedCount = 0;
		    let lastVisit = null;
		    let lastCountry = null;
    
		    Object.values(continents).forEach(continent => {
		        totalCount += continent.countries.length;
		        continent.countries.forEach(country => {
		            if (visitedCountries[country]) {
		                visitedCount++;
		                if (visitedCountries[country].rating > 0) {
		                    totalRating += visitedCountries[country].rating;
		                    ratedCount++;
		                }
		                const visitDate = new Date(visitedCountries[country].date);
		                if (!lastVisit || visitDate > lastVisit) {
		                    lastVisit = visitDate;
		                    lastCountry = country;
		                }
		            }
		        });
		    });
    
		    document.getElementById('visited-count').textContent = visitedCount;
		    document.getElementById('total-count').textContent = totalCount;
    
		    if (ratedCount > 0) {
		        const avgRating = (totalRating / ratedCount).toFixed(1);
		        document.getElementById('avg-rating').textContent = avgRating;
		    } else {
		        document.getElementById('avg-rating').textContent = '-';
		    }
    
		    if (lastCountry) {
		        document.getElementById('last-country').textContent = lastCountry;
		    } else {
		        document.getElementById('last-country').textContent = '-';
		    }
		}
		
		function openStatsModal() {
		    calculateDetailedStats();
		    document.getElementById('stats-modal').style.display = 'block';
		    document.getElementById('overlay').classList.add('active');
		}

		function closeStatsModal() {
		    document.getElementById('stats-modal').style.display = 'none';
		    document.getElementById('overlay').classList.remove('active');
		}

		function calculateDetailedStats() {
		    let totalCountries = 0;
		    let totalVisited = 0;
    
		    // Stats mondiales
		    Object.values(continents).forEach(continent => {
		        totalCountries += continent.countries.length;
		        continent.countries.forEach(country => {
		            if (visitedCountries[country]) {
		                totalVisited++;
		            }
		        });
		    });
    
		    const worldPercentage = ((totalVisited / totalCountries) * 100).toFixed(1);
		    document.getElementById('world-percentage').textContent = worldPercentage + '%';
		    document.getElementById('world-progress-bar').style.width = worldPercentage + '%';
    
		    // Stats par continent
		    const continentsContainer = document.getElementById('continents-completion');
		    continentsContainer.innerHTML = '';
    
		    Object.keys(continents).forEach(continentName => {
		        const continent = continents[continentName];
		        const visited = continent.countries.filter(c => visitedCountries[c]).length;
		        const total = continent.countries.length;
		        const percentage = ((visited / total) * 100).toFixed(1);
        
		        const continentDiv = document.createElement('div');
		        continentDiv.style.cssText = 'margin-bottom: 25px; padding: 20px; background: rgba(40, 40, 40, 0.5); border-radius: 8px;';
        
		        continentDiv.innerHTML = `
		            <h3 style="color: #fff; margin-bottom: 15px;">${continent.emoji} ${continentName}</h3>
		            <div style="margin-bottom: 10px;">
		                <span style="color: #ccc;">${visited} / ${total} pays visitÃ©s</span>
		            </div>
		            <div style="display: flex; align-items: center; gap: 15px;">
		                <div style="flex: 1; background: #1a1a1a; height: 25px; border-radius: 12px; overflow: hidden;">
		                    <div style="width: ${percentage}%; height: 100%; background: linear-gradient(90deg, #4CAF50, #45a049); transition: width 0.3s;"></div>
		                </div>
		                <span style="font-size: 20px; font-weight: bold; color: #4CAF50; min-width: 60px;">${percentage}%</span>
		            </div>
		        `;
        
		        continentsContainer.appendChild(continentDiv);
		    });
		}

        // Initialiser le globe
        async function initGlobe() {
            // Charger les donnÃ©es GeoJSON des pays
            const response = await fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson');
            countriesGeoJson = await response.json();

		myGlobe = Globe()
		    (document.getElementById('globe-container'))
		    .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
		    .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
		    .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
		    .polygonsData(countriesGeoJson.features)
		    .polygonAltitude(0.01)
		    .polygonCapColor(feat => {
		        const countryName = getCountryNameFromGeoJson(feat.properties.NAME);
		        if (visitedCountries[countryName]) {
		            return '#00ff00';
		        } else if (bucketList[countryName]) {
		            return '#FF9800';
		        }
		        return 'rgba(100, 100, 100, 0.3)';
		    })
		    .polygonSideColor(() => 'rgba(0, 0, 0, 0.1)')
		    .polygonStrokeColor(() => '#111')
		    .polygonLabel(feat => {
		        const countryName = getCountryNameFromGeoJson(feat.properties.NAME);
		        return `<b>${countryName}</b>`;
		    })
		    .onPolygonClick((polygon) => {
		        const countryName = getCountryNameFromGeoJson(polygon.properties.NAME);
		        if (countryName) {
		            openModal(countryName);
		        }
		    })
		    // Initialiser les arcs et points
		    .arcsData([])
		    .pointsData([]);

		// Auto-rotation
		myGlobe.controls().autoRotate = false;
	            myGlobe.controls().autoRotateSpeed = 0.3;
	        }

	        function getCountryNameFromGeoJson(geoJsonName) {
	            // Trouver le nom franÃ§ais correspondant
	            for (const [frenchName, englishName] of Object.entries(countryNameMapping)) {
	                if (englishName === geoJsonName) {
	                    return frenchName;
	                }
	            }
	            return geoJsonName;
	        }

	        function updateGlobeColors() {
	            if (myGlobe && countriesGeoJson) {
	                myGlobe.polygonsData(countriesGeoJson.features);
	            }
	        }

	        function resetView() {
	            if (myGlobe) {
	                myGlobe.pointOfView({ lat: 0, lng: 0, altitude: 2.5 }, 1000);
	            }
	        }
			function toggleRotation() {
			    myGlobe.controls().autoRotate = !myGlobe.controls().autoRotate;
			}

			function openModal(countryName) {
			    selectedCountry = countryName;
			    document.getElementById('modal-title').textContent = countryName;
    
			    const addBucketBtn = document.getElementById('add-bucket-btn');
			    const saveBtn = document.getElementById('save-btn');
			    const exportPdfBtn = document.getElementById('export-pdf-btn');
    
			    if (visitedCountries[countryName]) {
			        // Charger les donnÃ©es existantes
			        const data = visitedCountries[countryName];
        
			        document.getElementById('notes-input').value = data.notes || '';
			        document.getElementById('budget-input').value = data.budget || '';
			        currentRating = data.rating || 0;
        
			        // Charger les activitÃ©s
			        document.querySelectorAll('.activity-checkbox').forEach(checkbox => {
			            const activity = checkbox.dataset.activity;
			            checkbox.checked = data.activities && data.activities[activity];
			        });
        
			        // Charger les compagnons
			        document.querySelectorAll('.companion-checkbox').forEach(checkbox => {
			            const companion = checkbox.dataset.companion;
			            checkbox.checked = data.companions && data.companions.includes(companion);
			        });
        
			        // Afficher les photos
			        displayPhotos(data.photos || []);
        
			        addBucketBtn.style.display = 'none';
			        saveBtn.style.display = 'block';
			        exportPdfBtn.style.display = 'block';
			    } else if (bucketList[countryName]) {
			        // RÃ©initialiser le formulaire
			        resetModalForm();
			        addBucketBtn.textContent = 'âœ… DÃ©jÃ  dans la Bucket List';
			        addBucketBtn.style.background = '#888';
			        addBucketBtn.disabled = true;
			        saveBtn.style.display = 'block';
			        exportPdfBtn.style.display = 'none';
			    } else {
			        // RÃ©initialiser le formulaire
			        resetModalForm();
			        addBucketBtn.style.display = 'block';
			        addBucketBtn.textContent = 'ğŸ¯ Ajouter Ã  ma Bucket List';
			        addBucketBtn.style.background = '#FF9800';
			        addBucketBtn.disabled = false;
			        saveBtn.style.display = 'block';
			        exportPdfBtn.style.display = 'none';
			    }
    
			    updateStars();
			    document.getElementById('modal').classList.add('active');
			    document.getElementById('overlay').classList.add('active');
			}

			function resetModalForm() {
			    document.getElementById('notes-input').value = '';
			    document.getElementById('budget-input').value = '';
			    currentRating = 0;
			    document.querySelectorAll('.activity-checkbox').forEach(cb => cb.checked = false);
			    document.querySelectorAll('.companion-checkbox').forEach(cb => cb.checked = false);
			    document.getElementById('photos-preview').innerHTML = '';
			}

	        function closeModal() {
	            document.getElementById('modal').classList.remove('active');
	            document.getElementById('overlay').classList.remove('active');
	            selectedCountry = null;
	        }

			async function saveCountryDetails() {
			    const notes = document.getElementById('notes-input').value;
			    const budget = parseFloat(document.getElementById('budget-input').value) || 0;
    
			    const activities = {};
			    document.querySelectorAll('.activity-checkbox').forEach(checkbox => {
			        activities[checkbox.dataset.activity] = checkbox.checked;
			    });
    
			    const companions = [];
			    document.querySelectorAll('.companion-checkbox').forEach(checkbox => {
			        if (checkbox.checked) {
			            companions.push(checkbox.dataset.companion);
			        }
			    });
    
			    const photos = [];
			    document.querySelectorAll('#photos-preview img').forEach(img => {
			        photos.push(img.src);
			    });
    
			    visitedCountries[selectedCountry] = {
			        visited: true,
			        notes: notes,
			        rating: currentRating,
			        date: new Date().toISOString(),
			        budget: budget,
			        activities: activities,
			        companions: companions,
			        photos: photos
			    };
    
			    // Sauvegarder
			    const user = await getCurrentUser();
			    if (user) {
			        // Supabase
			        await supabaseClient.from('visited_countries').upsert({
			            user_id: user.id,
			            country_name: selectedCountry,
			            notes: notes,
			            rating: currentRating,
			            budget: budget,
			            visit_date: new Date().toISOString(),
			            photos: photos,
			            activities: activities,
			            companions: companions
			        });
			    } else {
			        // localStorage
			        localStorage.setItem('travelData', JSON.stringify(visitedCountries));
			    }
    
			    updateGlobeColors();
			    updateCountryItem(selectedCountry);
			    updateAllContinentStats();
			    updateStats();
			    closeModal();
			}

	        function updateStars() {
	            document.querySelectorAll('.star').forEach(star => {
	                const rating = parseInt(star.dataset.rating);
	                if (rating <= currentRating) {
	                    star.classList.add('active');
	                } else {
	                    star.classList.remove('active');
	                }
	            });
	        }
			
			let bucketList = {};

			async function loadBucketList() {
			    const user = await getCurrentUser();
			    if (!user) {
			        const saved = localStorage.getItem('bucketList');
			        if (saved) bucketList = JSON.parse(saved);
			        return;
			    }

			    const { data, error } = await supabaseClient
			        .from('bucket_list')
			        .select('*')
			        .eq('user_id', user.id);

			    if (data) {
			        bucketList = {};
			        data.forEach(item => {
			            bucketList[item.country_name] = {
			                addedDate: item.added_date,
			                reason: item.reason,
			                priority: item.priority
			            };
			        });
			    }
			} 
 

					async function saveBucketList() {
					    const user = await getCurrentUser();
					    if (!user) {
					        localStorage.setItem('bucketList', JSON.stringify(bucketList));
					        return;
					    }

					    // Sauvegarder dans Supabase
					    for (const [country, data] of Object.entries(bucketList)) {
					        await supabaseClient.from('bucket_list').upsert({
					            user_id: user.id,
					            country_name: country,
					            added_date: data.addedDate,
					            reason: data.reason,
					            priority: data.priority
					        });
					    }
					}

			function openBucketListModal() {
			    renderBucketList();
			    document.getElementById('bucket-list-modal').style.display = 'block';
			    document.getElementById('overlay').classList.add('active');
			}

			function closeBucketListModal() {
			    document.getElementById('bucket-list-modal').style.display = 'none';
			    document.getElementById('overlay').classList.remove('active');
			    document.getElementById('bucket-search').value = '';
			    document.getElementById('bucket-search-results').innerHTML = '';
			    document.getElementById('bucket-suggestions').style.display = 'none';
			}

			function addToBucketList(countryName, reason = '') {
			    if (!visitedCountries[countryName] && !bucketList[countryName]) {
			        bucketList[countryName] = {
			            addedDate: new Date().toISOString(),
			            reason: reason,
			            priority: 'medium'
			        };
			        saveBucketList();
			        renderBucketList();
			        updateGlobeColorsForBucket();
        
			        // âœ… Notification stylÃ©e
			        showNotification(`${countryName} a Ã©tÃ© ajoutÃ© Ã  ta bucket list`, 'success', 'ğŸ¯ Destination ajoutÃ©e');
			    }
			}

			function removeFromBucketList(countryName) {
			    delete bucketList[countryName];
			    saveBucketList();
			    renderBucketList();
			    updateGlobeColorsForBucket();
			}

			function renderBucketList() {
			    const container = document.getElementById('bucket-items');
			    const emptyState = document.getElementById('bucket-empty');
			    const countSpan = document.getElementById('bucket-count');
    
			    const bucketCountries = Object.keys(bucketList);
			    countSpan.textContent = bucketCountries.length;
    
			    if (bucketCountries.length === 0) {
			        container.innerHTML = '';
			        emptyState.style.display = 'block';
			        document.getElementById('itinerary-section').style.display = 'none';
			        return;
			    }
    
			    emptyState.style.display = 'none';
			    container.innerHTML = '';
    
			    // Grouper par continent
			    const byContinent = {};
			    Object.keys(continents).forEach(continentName => {
			        byContinent[continentName] = [];
			    });
    
			    bucketCountries.forEach(country => {
			        for (const [continentName, continent] of Object.entries(continents)) {
			            if (continent.countries.includes(country)) {
			                byContinent[continentName].push(country);
			                break;
			            }
			        }
			    });
    
			    // Afficher par continent
			    Object.keys(byContinent).forEach(continentName => {
			        if (byContinent[continentName].length === 0) return;
        
			        const continentSection = document.createElement('div');
			        continentSection.style.cssText = 'margin-bottom: 20px;';
        
			        const continentHeader = document.createElement('h4');
			        continentHeader.style.cssText = 'color: #FF9800; margin-bottom: 10px; font-size: 16px;';
			        continentHeader.textContent = `${continents[continentName].emoji} ${continentName} (${byContinent[continentName].length})`;
			        continentSection.appendChild(continentHeader);
        
			        byContinent[continentName].forEach(country => {
			            const item = document.createElement('div');
			            item.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 12px; margin: 5px 0; background: rgba(255, 152, 0, 0.2); border-radius: 5px; border-left: 4px solid #FF9800;';
            
			            const leftPart = document.createElement('div');
			            leftPart.style.cssText = 'flex: 1;';
            
			            const countryNameEl = document.createElement('div');
			            countryNameEl.style.cssText = 'font-weight: bold; margin-bottom: 5px;';
			            countryNameEl.textContent = country;
            
			            const reasonEl = document.createElement('div');
			            reasonEl.style.cssText = 'font-size: 12px; color: #ccc;';
			            reasonEl.textContent = bucketList[country].reason || 'Destination de rÃªve';
            
			            leftPart.appendChild(countryNameEl);
			            leftPart.appendChild(reasonEl);
            
			            const removeBtn = document.createElement('button');
			            removeBtn.textContent = 'âœ“ VisitÃ©';
			            removeBtn.style.cssText = 'padding: 8px 15px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px; margin-right: 10px;';
			            removeBtn.onclick = () => {
			                removeFromBucketList(country);
			                openModal(country);
			            };
            
			            const deleteBtn = document.createElement('button');
			            deleteBtn.textContent = 'ğŸ—‘ï¸';
			            deleteBtn.style.cssText = 'padding: 8px 12px; background: #f44336; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px;';
			            deleteBtn.onclick = () => removeFromBucketList(country);
            
			            item.appendChild(leftPart);
			            item.appendChild(removeBtn);
			            item.appendChild(deleteBtn);
			            continentSection.appendChild(item);
			        });
        
			        container.appendChild(continentSection);
			    });
    
			    // GÃ©nÃ©rer les itinÃ©raires
			    generateItineraries();
			}

			function generateItineraries() {
			    const bucketCountries = Object.keys(bucketList);
    
			    if (bucketCountries.length < 2) {
			        document.getElementById('itinerary-section').style.display = 'none';
			        return;
			    }
    
			    document.getElementById('itinerary-section').style.display = 'block';
			    const container = document.getElementById('itinerary-content');
			    container.innerHTML = '';
    
			    // Grouper par continent
			    const byContinent = {};
			    bucketCountries.forEach(country => {
			        for (const [continentName, continent] of Object.entries(continents)) {
			            if (continent.countries.includes(country)) {
			                if (!byContinent[continentName]) byContinent[continentName] = [];
			                byContinent[continentName].push(country);
			                break;
			            }
			        }
			    });
    
			    // CrÃ©er des itinÃ©raires par continent
			    let hasItinerary = false;
			    Object.keys(byContinent).forEach(continentName => {
			        if (byContinent[continentName].length >= 2) {
			            hasItinerary = true;
			            const itinerary = document.createElement('div');
			            itinerary.style.cssText = 'margin-bottom: 15px; padding: 15px; background: rgba(40, 40, 40, 0.5); border-radius: 8px;';
            
			            itinerary.innerHTML = `
			                <div style="font-weight: bold; margin-bottom: 10px; color: #FF9800;">
			                    ${continents[continentName].emoji} Tour ${continentName}
			                </div>
			                <div style="font-size: 14px; color: #ccc; margin-bottom: 10px;">
			                    ${byContinent[continentName].join(' â†’ ')}
			                </div>
			                <div style="font-size: 12px; color: #888;">
			                    ${byContinent[continentName].length} pays Ã  visiter dans la mÃªme rÃ©gion
			                </div>
			            `;
            
			            container.appendChild(itinerary);
			        }
			    });
    
			    if (!hasItinerary) {
			        container.innerHTML = '<p style="color: #888; font-size: 14px;">Ajoutez au moins 2 pays d\'une mÃªme rÃ©gion pour voir des suggestions d\'itinÃ©raires.</p>';
			    }
			}

			function generateSuggestions() {
			    const suggestionsDiv = document.getElementById('bucket-suggestions');
			    const contentDiv = document.getElementById('suggestions-content');
    
			    suggestionsDiv.style.display = 'block';
			    contentDiv.innerHTML = '';
    
			    // Analyser les pays visitÃ©s
			    const visitedByContinent = {};
			    const ratingsByContinent = {};
    
			    Object.keys(visitedCountries).forEach(country => {
			        for (const [continentName, continent] of Object.entries(continents)) {
			            if (continent.countries.includes(country)) {
			                if (!visitedByContinent[continentName]) {
			                    visitedByContinent[continentName] = [];
			                    ratingsByContinent[continentName] = [];
			                }
			                visitedByContinent[continentName].push(country);
			                if (visitedCountries[country].rating) {
			                    ratingsByContinent[continentName].push(visitedCountries[country].rating);
			                }
			                break;
			            }
			        }
			    });
    
			    const suggestions = [];
    
			    // Suggestion 1: Pays voisins de ceux bien notÃ©s
			    Object.keys(visitedCountries).forEach(country => {
			        if (visitedCountries[country].rating >= 4) {
			            for (const [continentName, continent] of Object.entries(continents)) {
			                if (continent.countries.includes(country)) {
			                    // SuggÃ©rer d'autres pays du mÃªme continent
			                    const neighbors = continent.countries.filter(c => 
			                        !visitedCountries[c] && 
			                        !bucketList[c] && 
			                        c !== country
			                    );
                    
			                    neighbors.slice(0, 2).forEach(neighbor => {
			                        suggestions.push({
			                            country: neighbor,
			                            reason: `Proche de ${country} que vous avez adorÃ© ${'â­'.repeat(visitedCountries[country].rating)}`
			                        });
			                    });
			                    break;
			                }
			            }
			        }
			    });
    
			    // Suggestion 2: Continents prÃ©fÃ©rÃ©s
			    let favContinent = null;
			    let maxAvg = 0;
    
			    Object.keys(ratingsByContinent).forEach(continentName => {
			        const ratings = ratingsByContinent[continentName];
			        if (ratings.length >= 2) {
			            const avg = ratings.reduce((a, b) => a + b, 0) / ratings.length;
			            if (avg > maxAvg) {
			                maxAvg = avg;
			                favContinent = continentName;
			            }
			        }
			    });
    
			    if (favContinent) {
			        const unvisited = continents[favContinent].countries.filter(c => 
			            !visitedCountries[c] && !bucketList[c]
			        );
        
			        unvisited.slice(0, 3).forEach(country => {
			            suggestions.push({
			                country: country,
			                reason: `${favContinent} semble Ãªtre votre continent prÃ©fÃ©rÃ© (note moyenne: ${maxAvg.toFixed(1)}â­)`
			            });
			        });
			    }
    
			    // Suggestion 3: ComplÃ©ter un continent
			    Object.keys(continents).forEach(continentName => {
			        const continent = continents[continentName];
			        const visited = continent.countries.filter(c => visitedCountries[c]).length;
			        const percentage = (visited / continent.countries.length) * 100;
        
			        if (percentage >= 50 && percentage < 100) {
			            const remaining = continent.countries.filter(c => 
			                !visitedCountries[c] && !bucketList[c]
			            );
            
			            remaining.slice(0, 2).forEach(country => {
			                suggestions.push({
			                    country: country,
			                    reason: `ComplÃ©tez ${continentName} ! Vous avez dÃ©jÃ  visitÃ© ${percentage.toFixed(0)}% du continent`
			                });
			            });
			        }
			    });
    
			    // Limiter et dÃ©dupliquer
			    const uniqueSuggestions = [];
			    const seenCountries = new Set();
    
			    suggestions.forEach(sug => {
			        if (!seenCountries.has(sug.country) && uniqueSuggestions.length < 6) {
			            seenCountries.add(sug.country);
			            uniqueSuggestions.push(sug);
			        }
			    });
    
			    if (uniqueSuggestions.length === 0) {
			        contentDiv.innerHTML = '<p style="color: #ccc; font-size: 14px;">Visitez plus de pays et ajoutez des notes pour recevoir des suggestions personnalisÃ©es !</p>';
			        return;
			    }
    
			    uniqueSuggestions.forEach(sug => {
			        const item = document.createElement('div');
			        item.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 12px; margin: 8px 0; background: rgba(76, 175, 80, 0.3); border-radius: 5px;';
        
			        const leftPart = document.createElement('div');
			        leftPart.style.flex = '1';
        
			        const countryName = document.createElement('div');
			        countryName.style.cssText = 'font-weight: bold; margin-bottom: 5px;';
			        countryName.textContent = sug.country;
        
			        const reason = document.createElement('div');
			        reason.style.cssText = 'font-size: 12px; color: #ddd;';
			        reason.textContent = sug.reason;
        
			        leftPart.appendChild(countryName);
			        leftPart.appendChild(reason);
        
			        const addBtn = document.createElement('button');
			        addBtn.textContent = '+ Ajouter';
			        addBtn.style.cssText = 'padding: 8px 15px; background: #FF9800; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px; font-weight: bold;';
			        addBtn.onclick = () => {
			            addToBucketList(sug.country, sug.reason);
			            item.remove();
			        };
        
			        item.appendChild(leftPart);
			        item.appendChild(addBtn);
			        contentDiv.appendChild(item);
			    });
			}

			function updateGlobeColorsForBucket() {
			    if (myGlobe && countriesGeoJson) {
			        myGlobe.polygonsData(countriesGeoJson.features);
			    }
			}
			// Initialiser la recherche de la bucket list
			function initBucketSearch() {
			    const bucketSearch = document.getElementById('bucket-search');
    
			    bucketSearch.addEventListener('input', (e) => {
			        const search = e.target.value.toLowerCase();
			        const resultsDiv = document.getElementById('bucket-search-results');
        
			        if (search.length < 1) {
			            resultsDiv.innerHTML = '';
			            return;
			        }
        
			        const allCountries = [];
			        Object.values(continents).forEach(continent => {
			            continent.countries.forEach(country => {
			                if (!visitedCountries[country] && !bucketList[country]) {
			                    allCountries.push(country);
			                }
			            });
			        });
        
			        const matches = allCountries.filter(c => c.toLowerCase().includes(search)).slice(0, 8);
        
			        if (matches.length === 0) {
			            resultsDiv.innerHTML = '<p style="color: #888; padding: 10px; font-size: 14px;">Aucun pays trouvÃ©</p>';
			            return;
			        }
        
			        resultsDiv.innerHTML = '';
			        matches.forEach(country => {
			            const item = document.createElement('div');
			            item.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 12px; margin: 5px 0; background: rgba(40, 40, 40, 0.5); border-radius: 5px; cursor: pointer; transition: background 0.2s;';
			            item.onmouseenter = () => item.style.background = 'rgba(60, 60, 60, 0.7)';
			            item.onmouseleave = () => item.style.background = 'rgba(40, 40, 40, 0.5)';
            
			            const countryNameSpan = document.createElement('span');
			            countryNameSpan.textContent = country;
			            countryNameSpan.style.flex = '1';
            
			            const addBtn = document.createElement('button');
			            addBtn.textContent = '+ Ajouter';
			            addBtn.style.cssText = 'padding: 8px 16px; background: #FF9800; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 13px; font-weight: bold;';
			            addBtn.onclick = (e) => {
			                e.stopPropagation();
			                addToBucketList(country);
			                bucketSearch.value = '';
			                resultsDiv.innerHTML = '';
			            };
            
			            item.appendChild(countryNameSpan);
			            item.appendChild(addBtn);
            
			            item.onclick = () => {
			                addToBucketList(country);
			                bucketSearch.value = '';
			                resultsDiv.innerHTML = '';
			            };
            
			            resultsDiv.appendChild(item);
			        });
			    });
			}
			// Ajouter aprÃ¨s initBucketSearch()
			function handlePhotoUpload() {
			    const photosInput = document.getElementById('photos-input');
    
			    photosInput.addEventListener('change', (e) => {
			        const files = Array.from(e.target.files).slice(0, 5); // Max 5 photos
			        const preview = document.getElementById('photos-preview');
			        preview.innerHTML = '';
        
			        files.forEach((file, index) => {
			            const reader = new FileReader();
			            reader.onload = (e) => {
			                const img = document.createElement('div');
			                img.style.cssText = 'position: relative; width: 100px; height: 100px; border-radius: 8px; overflow: hidden; border: 2px solid #4CAF50;';
			                img.innerHTML = `
			                    <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">
			                    <button onclick="removePhoto(${index})" style="position: absolute; top: 5px; right: 5px; background: #f44336; border: none; border-radius: 50%; width: 25px; height: 25px; color: white; cursor: pointer; font-size: 14px;">Ã—</button>
			                `;
			                preview.appendChild(img);
			            };
			            reader.readAsDataURL(file);
			        });
			    });
			}

			function displayPhotos(photos) {
			    const preview = document.getElementById('photos-preview');
			    preview.innerHTML = '';
    
			    photos.forEach((photoUrl, index) => {
			        const img = document.createElement('div');
			        img.style.cssText = 'position: relative; width: 100px; height: 100px; border-radius: 8px; overflow: hidden; border: 2px solid #4CAF50;';
			        img.innerHTML = `
			            <img src="${photoUrl}" style="width: 100%; height: 100%; object-fit: cover;">
			            <button onclick="removePhoto(${index})" style="position: absolute; top: 5px; right: 5px; background: #f44336; border: none; border-radius: 50%; width: 25px; height: 25px; color: white; cursor: pointer; font-size: 14px;">Ã—</button>
			        `;
			        preview.appendChild(img);
			    });
			}

			let currentPhotos = [];
			function removePhoto(index) {
			    currentPhotos.splice(index, 1);
			    displayPhotos(currentPhotos);
			}

	        // Event listeners
	        document.getElementById('save-btn').addEventListener('click', saveCountryDetails);
	        document.getElementById('cancel-btn').addEventListener('click', closeModal);
	        document.getElementById('overlay').addEventListener('click', closeModal);
        
	        document.querySelectorAll('.star').forEach(star => {
	            star.addEventListener('click', function() {
	                currentRating = parseInt(this.dataset.rating);
	                updateStars();
	            });
	        });
			document.getElementById('toggle-sidebar').addEventListener('click', () => {
			    document.getElementById('sidebar').classList.toggle('open');
			});
			document.getElementById('personal-stats-btn').addEventListener('click', openStatsModal);
			document.getElementById('close-stats-btn').addEventListener('click', closeStatsModal);
			document.getElementById('bucket-list-btn').addEventListener('click', openBucketListModal);
			document.getElementById('close-bucket-btn').addEventListener('click', closeBucketListModal);
			document.getElementById('suggestions-btn').addEventListener('click', generateSuggestions);
			document.getElementById('add-bucket-btn').addEventListener('click', () => {
			    if (!bucketList[selectedCountry]) {
			        addToBucketList(selectedCountry, 'AjoutÃ© depuis le globe');
			        alert(`${selectedCountry} a Ã©tÃ© ajoutÃ© Ã  votre Bucket List ! ğŸ¯`);
			        closeModal();
			    }
			});
			document.getElementById('search-general-flights-btn').addEventListener('click', () => {
			    selectedCountry = 'Destination'; // Texte par dÃ©faut
			    openFlightsModal();
			});
			function exportToPDF() {
			    if (!visitedCountries[selectedCountry]) return;
    
			    const { jsPDF } = window.jspdf;
			    const doc = new jsPDF();
			    const data = visitedCountries[selectedCountry];
    
			    // Titre
			    doc.setFontSize(20);
			    doc.setTextColor(76, 175, 80);
			    doc.text(selectedCountry, 20, 20);
    
			    // Date
			    doc.setFontSize(12);
			    doc.setTextColor(100, 100, 100);
			    doc.text(`Visite le: ${new Date(data.date).toLocaleDateString('fr-FR')}`, 20, 30);
    
			    // Note
			    doc.setTextColor(0, 0, 0);
			    doc.text(`Note: ${'â˜…'.repeat(data.rating)}${'â˜†'.repeat(5 - data.rating)}`, 20, 40);
    
			    // Budget
			    if (data.budget) {
			        doc.text(`Budget: ${data.budget}â‚¬`, 20, 50);
			    }
    
			    // ActivitÃ©s
			    let y = 60;
			    doc.text('Activites:', 20, y);
			    y += 7;
			    Object.keys(data.activities).forEach(activity => {
			        if (data.activities[activity]) {
			            doc.text(`- ${activity}`, 25, y);
			            y += 7;
			        }
			    });
    
			    // Compagnons
			    if (data.companions.length > 0) {
			        y += 5;
			        doc.text(`Voyage avec: ${data.companions.join(', ')}`, 20, y);
			        y += 10;
			    }
    
			    // Notes
			    if (data.notes) {
			        y += 5;
			        doc.text('Notes:', 20, y);
			        y += 7;
			        const splitNotes = doc.splitTextToSize(data.notes, 170);
			        doc.text(splitNotes, 20, y);
			    }
    
			    // Sauvegarder
			    doc.save(`${selectedCountry}_carnet.pdf`);
			}

			// Event listener pour le bouton export
			document.getElementById('export-pdf-btn').addEventListener('click', exportToPDF);

	        // Initialisation
	        loadData();
			loadBucketList();
	        initContinentsList();
	        initGlobe();
			initBucketSearch();
			handlePhotoUpload();
			
			
			function setupAutocomplete(inputId) {
			    const input = document.getElementById(inputId);
			    const resultsId = inputId + '-results';
    
			    // CrÃ©er le conteneur des rÃ©sultats s'il n'existe pas
			    let resultsDiv = document.getElementById(resultsId);
			    if (!resultsDiv) {
			        resultsDiv = document.createElement('div');
			        resultsDiv.id = resultsId;
			        resultsDiv.style.cssText = 'position: absolute; background: #2a2a2a; border: 1px solid #4CAF50; border-radius: 5px; max-height: 200px; overflow-y: auto; z-index: 1003; width: calc(100% - 24px); margin-top: 2px; display: none;';
			        input.parentElement.style.position = 'relative';
			        input.parentElement.appendChild(resultsDiv);
			    }
    
			    input.addEventListener('input', (e) => {
			        const search = e.target.value.toLowerCase();
        
			        if (search.length < 2) {
			            resultsDiv.style.display = 'none';
			            return;
			        }
        
			        const matches = airportsList.filter(airport => 
			            airport.code.toLowerCase().includes(search) ||
			            airport.city.toLowerCase().includes(search) ||
			            airport.country.toLowerCase().includes(search)
			        ).slice(0, 8);
        
			        if (matches.length === 0) {
			            resultsDiv.style.display = 'none';
			            return;
			        }
        
			        resultsDiv.innerHTML = '';
			        matches.forEach(airport => {
			            const item = document.createElement('div');
			            item.style.cssText = 'padding: 10px; cursor: pointer; border-bottom: 1px solid #333; transition: background 0.2s;';
			            item.innerHTML = `
			                <div style="font-weight: bold; color: #4CAF50;">${airport.code} - ${airport.city}</div>
			                <div style="font-size: 12px; color: #999;">${airport.country}</div>
			            `;
            
			            item.onmouseenter = () => item.style.background = 'rgba(76, 175, 80, 0.2)';
			            item.onmouseleave = () => item.style.background = 'transparent';
            
			            item.onclick = () => {
			                input.value = airport.code;
			                resultsDiv.style.display = 'none';
			            };
            
			            resultsDiv.appendChild(item);
			        });
        
			        resultsDiv.style.display = 'block';
			    });
    
			    // Fermer au clic ailleurs
			    document.addEventListener('click', (e) => {
			        if (e.target !== input) {
			            resultsDiv.style.display = 'none';
			        }
			    });
			}

			// Ouvrir le modal de recherche de vols
			// Nouvelle fonction simplifiÃ©e
			function openFlightsModal() {
			    const destination = countryAirportCodes[selectedCountry] || '';
    
			    // Ne pas afficher d'alerte si c'est une recherche gÃ©nÃ©rale
				if (!destination && selectedCountry !== 'Destination') {
				    showNotification(`DÃ©solÃ©, nous n'avons pas de code aÃ©roport pour ${selectedCountry}`, 'warning', 'AÃ©roport introuvable');
				    return;
				}
    
			    const modal = document.createElement('div');
			    modal.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #2196F3; z-index: 1002; min-width: 500px; max-width: 600px;';
    
			    // Date par dÃ©faut dans 1 mois
			    const defaultDate = new Date();
			    defaultDate.setMonth(defaultDate.getMonth() + 1);
			    const dateString = defaultDate.toISOString().split('T')[0];
    
			    modal.innerHTML = `
<button onclick="closeFlightsModalSimple()" 
        style="position: absolute; top: 15px; right: 15px; min-width: 35px; min-height: 35px; width: 35px; height: 35px; padding: 0; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 18px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);" 
        onmouseover="this.style.background='#d32f2f'; this.style.transform='scale(1.1)'" 
        onmouseout="this.style.background='#f44336'; this.style.transform='scale(1)'">âœ•</button>
        
			        <h3 style="color: #2196F3; margin-bottom: 10px; text-align: center;">âœˆï¸ Rechercher des vols</h3>
			        <p style="color: #888; text-align: center; margin-bottom: 20px; font-size: 14px;">Destination : ${selectedCountry}</p>
        
			        <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4CAF50;">
			            <p style="color: #4CAF50; font-weight: bold; margin-bottom: 5px;">ğŸ’¡ Comment Ã§a marche ?</p>
			            <p style="color: #ccc; font-size: 13px;">
			                Remplissez vos critÃ¨res ci-dessous, puis cliquez sur le bouton pour ouvrir 
			                <strong>Google Flights, Skyscanner et Kayak</strong> en mÃªme temps. 
			                Vous pourrez comparer les prix instantanÃ©ment !
			            </p>
			        </div>
        
			        <div style="margin-bottom: 15px;">
			            <label style="display: block; margin-bottom: 5px; color: #ccc; font-weight: bold;">ğŸ  D'oÃ¹ partez-vous ?</label>
			            <input type="text" id="multi-origin" value="CDG" placeholder="Ex: CDG (Paris), NCE (Nice), LYS (Lyon)" 
			                   style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
			        </div>
        
			        <div style="margin-bottom: 15px;">
			            <label style="display: block; margin-bottom: 5px; color: #ccc; font-weight: bold;">ğŸ¯ Ville/AÃ©roport de destination</label>
<input type="text" id="multi-destination" value="${destination}" placeholder="${destination ? 'Ex: JFK (New York)' : 'Ex: ATH (AthÃ¨nes), JFK (New York)'}"			                   style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
			            <p style="color: #888; font-size: 12px; margin-top: 5px;">ğŸ’¡ Vous pouvez changer la ville si ${selectedCountry} a plusieurs aÃ©roports</p>
			        </div>
        
			        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
			            <div style="flex: 1;">
			                <label style="display: block; margin-bottom: 5px; color: #ccc; font-weight: bold;">ğŸ“… Date de dÃ©part</label>
			                <input type="date" id="multi-date" value="${dateString}"
			                       style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
			            </div>
			            <div style="flex: 1;">
			                <label style="display: block; margin-bottom: 5px; color: #ccc; font-weight: bold;">ğŸ‘¥ Passagers</label>
			                <input type="number" id="multi-adults" value="1" min="1" max="9"
			                       style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
			            </div>
			        </div>
        
			        <button onclick="compareAllPlatforms()" 
			                style="width: 100%; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; margin-bottom: 10px; transition: transform 0.2s;">
			            ğŸš€ Comparer sur toutes les plateformes
			        </button>
        
			        <div style="display: flex; gap: 10px;">
			            <button onclick="openSinglePlatform('google')" 
			                    style="flex: 1; padding: 12px; background: #4285F4; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px;">
			                Google
			            </button>
			            <button onclick="openSinglePlatform('skyscanner')" 
			                    style="flex: 1; padding: 12px; background: #00B2D6; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px;">
			                Skyscanner
			            </button>
			            <button onclick="openSinglePlatform('kayak')" 
			                    style="flex: 1; padding: 12px; background: #FF6E1D; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px;">
			                Kayak
			            </button>
			        </div>
        
			        <button onclick="closeFlightsModalSimple()" 
			                style="width: 100%; padding: 12px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer; margin-top: 15px;">
			            Annuler
			        </button>
			    `;
    
			    const overlay = document.createElement('div');
			    overlay.id = 'multi-overlay';
			    overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1001;';
			    overlay.onclick = closeFlightsModalSimple;
    
			    document.body.appendChild(overlay);
				// Initialiser l'autocomplÃ©tion
				setTimeout(() => {
				    setupAutocomplete('multi-origin');
				    setupAutocomplete('multi-destination');
				}, 100);
			    document.body.appendChild(modal);
			}

			function closeFlightsModalSimple() {
			    const modal = document.querySelector('[style*="z-index: 1002"]');
			    const overlay = document.getElementById('multi-overlay');
			    if (modal) modal.remove();
			    if (overlay) overlay.remove();
			}

			// Fonction pour ouvrir TOUTES les plateformes en mÃªme temps
			window.compareAllPlatforms = function() {
			    const origin = document.getElementById('multi-origin').value.toUpperCase();
			    const destination = document.getElementById('multi-destination').value.toUpperCase();
			    const date = document.getElementById('multi-date').value;
			    const adults = document.getElementById('multi-adults').value;
    
			    if (!origin || !destination || !date) {
			        alert('âš ï¸ Veuillez remplir tous les champs');
			        return;
			    }
    
			    // Ouvrir Google Flights
			    window.open(getGoogleFlightsUrl(origin, destination, date, adults), '_blank');
    
			    // Attendre 500ms puis ouvrir Skyscanner
			    setTimeout(() => {
			        window.open(getSkyscannerUrl(origin, destination, date, adults), '_blank');
			    }, 500);
    
			    // Attendre 1000ms puis ouvrir Kayak
			    setTimeout(() => {
			        window.open(getKayakUrl(origin, destination, date, adults), '_blank');
			    }, 1000);
    
			    // Message de confirmation
			    const confirmDiv = document.createElement('div');
			    confirmDiv.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #4CAF50; color: white; padding: 15px 30px; border-radius: 8px; z-index: 2000; font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.3);';
			    confirmDiv.textContent = 'âœ… 3 onglets ouverts ! Comparez les prix';
			    document.body.appendChild(confirmDiv);
    
			    setTimeout(() => confirmDiv.remove(), 3000);
    
			    closeFlightsModalSimple();
			}

			// Fonction pour ouvrir une seule plateforme
			window.openSinglePlatform = function(platform) {
			    const origin = document.getElementById('multi-origin').value.toUpperCase();
			    const destination = document.getElementById('multi-destination').value.toUpperCase();
			    const date = document.getElementById('multi-date').value;
			    const adults = document.getElementById('multi-adults').value;
    
			    if (!origin || !destination || !date) {
			        alert('âš ï¸ Veuillez remplir tous les champs');
			        return;
			    }
    
			    let url;
			    switch(platform) {
			        case 'google':
			            url = getGoogleFlightsUrl(origin, destination, date, adults);
			            break;
			        case 'skyscanner':
			            url = getSkyscannerUrl(origin, destination, date, adults);
			            break;
			        case 'kayak':
			            url = getKayakUrl(origin, destination, date, adults);
			            break;
			    }
    
			    window.open(url, '_blank');
			}

			// Fermer le modal de vols
			function closeFlightsModal() {
			    document.getElementById('flights-modal').style.display = 'none';
			}

			// Fonction de rÃ©servation avec choix de plateforme
			function bookFlight(origin, destination, date, adults, airline) {
			    const modal = document.createElement('div');
			    modal.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #FF9800; z-index: 1002; min-width: 400px;';
    
			    modal.innerHTML = `
			        <h3 style="color: #FF9800; margin-bottom: 20px; text-align: center;">ğŸ« RÃ©server votre vol</h3>
			        <p style="color: #ccc; margin-bottom: 20px; text-align: center; font-size: 14px;">
			            ${origin} â†’ ${destination} â€¢ ${new Date(date).toLocaleDateString('fr-FR')}
			        </p>
        
			        <div style="display: flex; flex-direction: column; gap: 10px;">
			            <button onclick="window.open('${getGoogleFlightsUrl(origin, destination, date, adults)}', '_blank')" 
			                    style="padding: 15px; background: #4285F4; border: none; border-radius: 5px; color: white; cursor: pointer; font-weight: bold; font-size: 14px;">
			                ğŸ”µ Google Flights
			            </button>
            
			            <button onclick="window.open('${getSkyscannerUrl(origin, destination, date, adults)}', '_blank')" 
			                    style="padding: 15px; background: #00B2D6; border: none; border-radius: 5px; color: white; cursor: pointer; font-weight: bold; font-size: 14px;">
			                âœˆï¸ Skyscanner
			            </button>
            
			            <button onclick="window.open('${getKayakUrl(origin, destination, date, adults)}', '_blank')" 
			                    style="padding: 15px; background: #FF6E1D; border: none; border-radius: 5px; color: white; cursor: pointer; font-weight: bold; font-size: 14px;">
			                ğŸ”¶ Kayak
			            </button>
            
			            <button onclick="window.open('${getAirlineUrl(airline, origin, destination, date)}', '_blank')" 
			                    style="padding: 15px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-weight: bold; font-size: 14px;">
			                ğŸ›« Site de la compagnie (${airline})
			            </button>
            
			            <button onclick="this.parentElement.parentElement.remove(); document.getElementById('booking-overlay').remove();" 
			                    style="padding: 15px; background: #555; border: none; border-radius: 5px; color: white; cursor: pointer; font-weight: bold; font-size: 14px; margin-top: 10px;">
			                âŒ Annuler
			            </button>
			        </div>
			    `;
    
			    const overlay = document.createElement('div');
			    overlay.id = 'booking-overlay';
			    overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1001;';
			    overlay.onclick = () => {
			        modal.remove();
			        overlay.remove();
			    };
    
			    document.body.appendChild(overlay);
			    document.body.appendChild(modal);
			}

			// URLs des diffÃ©rentes plateformes
			function getGoogleFlightsUrl(origin, destination, date, adults) {
			    const formattedDate = date.replace(/-/g, '');
			    return `https://www.google.com/travel/flights?q=flights%20from%20${origin}%20to%20${destination}%20on%20${formattedDate}%20for%20${adults}%20adults`;
			}

			function getSkyscannerUrl(origin, destination, date, adults) {
			    const formattedDate = date.replace(/-/g, '').substring(2); // Format YYMMDD
			    return `https://www.skyscanner.fr/transport/flights/${origin.toLowerCase()}/${destination.toLowerCase()}/${formattedDate}/?adults=${adults}`;
			}

			function getKayakUrl(origin, destination, date, adults) {
			    return `https://www.kayak.fr/flights/${origin}-${destination}/${date}?sort=bestflight_a&fs=stops=0&adults=${adults}`;
			}

			function getAirlineUrl(airlineCode, origin, destination, date) {
			    const airlines = {
			        'AF': `https://www.airfrance.fr/search/offers?connections%5B0%5D.origin=${origin}&connections%5B0%5D.destination=${destination}&connections%5B0%5D.departureDate=${date}`,
			        'BA': `https://www.britishairways.com/travel/book/public/en_gb?from=${origin}&to=${destination}&departureDate=${date}`,
			        'LH': `https://www.lufthansa.com/de/en/flight-search?origin=${origin}&destination=${destination}&outbound-date=${date}`,
			        'IB': `https://www.iberia.com/fr/flights/`,
			        'KL': `https://www.klm.com/search/offers?origin=${origin}&destination=${destination}&departureDate=${date}`,
			        'FR': `https://www.ryanair.com/fr/fr/booking/home/${origin}/${destination}/${date}`,
			        'U2': `https://www.easyjet.com/fr/vols/${origin}/${destination}`,
			        'EK': `https://www.emirates.com/fr/french/book/flights-from-${origin.toLowerCase()}-to-${destination.toLowerCase()}`,
			        'QR': `https://www.qatarairways.com/fr-fr/homepage`,
			        'TK': `https://www.turkishairlines.com/`,
			        'EZY': `https://www.easyjet.com/fr/vols/${origin}/${destination}`,
			        'VY': `https://www.vueling.com/fr`,
			        'TO': `https://www.transavia.com/fr-FR/home/`
			    };
    
			    return airlines[airlineCode] || `https://www.google.com/search?q=${airlineCode}+flights+${origin}+to+${destination}`;
			}

			// Event listeners pour les vols
			document.getElementById('search-flights-btn').addEventListener('click', openFlightsModal);

			let currentQuizQuestion = 0;
			let quizScore = 0;
			let quizCorrect = 0;
			let quizWrong = 0;
			let currentQuizQuestions = [];

			function openGamesModal() {
			    document.getElementById('games-modal').style.display = 'block';
			    document.getElementById('overlay').classList.add('active');
			    showGamesMenu();
			}

			function closeGamesModal() {
			    document.getElementById('games-modal').style.display = 'none';
			    document.getElementById('overlay').classList.remove('active');
			}

			function showGamesMenu() {
			    document.getElementById('games-menu').style.display = 'block';
			    document.getElementById('quiz-levels-menu').style.display = 'none';
			    document.getElementById('quiz-game').style.display = 'none';
			    document.getElementById('quiz-end').style.display = 'none';
			    // Ajoute ces 3 lignes :
			    document.getElementById('higher-lower-menu').style.display = 'none';
			    document.getElementById('higher-lower-game').style.display = 'none';
			    document.getElementById('higher-lower-end').style.display = 'none';
			}
			
			function showQuizLevels() {
			    document.getElementById('games-menu').style.display = 'none';
			    document.getElementById('quiz-levels-menu').style.display = 'block';
			    document.getElementById('quiz-game').style.display = 'none';
			    document.getElementById('quiz-end').style.display = 'none';
			}

			function backToGamesMenu() {
			    // Masquer tous les Ã©crans de jeux
			    document.getElementById('games-menu').style.display = 'block';
			    document.getElementById('quiz-levels-menu').style.display = 'none';
			    document.getElementById('quiz-game').style.display = 'none';
			    document.getElementById('quiz-end').style.display = 'none';
			    document.getElementById('higher-lower-menu').style.display = 'none';
			    document.getElementById('higher-lower-game').style.display = 'none';
			    document.getElementById('higher-lower-end').style.display = 'none';
			    document.getElementById('beer-levels-menu').style.display = 'none';
			    document.getElementById('beer-mixologue-game').style.display = 'none';
			    document.getElementById('beer-tour-game').style.display = 'none';
			    document.getElementById('beer-end').style.display = 'none';
			    document.getElementById('interpol-levels-menu').style.display = 'none';
			    document.getElementById('interpol-game').style.display = 'none';
			    document.getElementById('interpol-end').style.display = 'none';
    
			    // DÃ©truire le planisphÃ¨re Interpol
			    destroyInterpolMap();
			}

			// Event listeners
			document.getElementById('games-btn').addEventListener('click', openGamesModal);
			document.getElementById('close-games-btn').addEventListener('click', closeGamesModal);
			
			// ===== ITINÃ‰RAIRE =====
			let currentItinerarySteps = [];
			let savedItineraries = [];
			let activeItineraryAnimation = null;

			function loadItineraries() {
			    const saved = localStorage.getItem('itineraries');
			    if (saved) {
			        savedItineraries = JSON.parse(saved);
			    }
			}

			function saveItineraries() {
			    localStorage.setItem('itineraries', JSON.stringify(savedItineraries));
			}

			function openItineraryModal() {
			    loadItineraries();
			    renderSavedItineraries();
			    document.getElementById('itinerary-modal').style.display = 'block';
			    document.getElementById('overlay').classList.add('active');
			}

			function closeItineraryModal() {
			    document.getElementById('itinerary-modal').style.display = 'none';
			    document.getElementById('overlay').classList.remove('active');
			    clearItineraryFromGlobe();
			}

			function renderSavedItineraries() {
			    const listEl = document.getElementById('itineraries-list');
    
			    if (savedItineraries.length === 0) {
			        listEl.innerHTML = '<p style="color: #888; padding: 20px; text-align: center; font-style: italic;">Aucun itinÃ©raire enregistrÃ©</p>';
			        return;
			    }
    
			    listEl.innerHTML = '';
    
			    savedItineraries.forEach((itinerary, index) => {
			        const item = document.createElement('div');
			        item.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 15px; margin-bottom: 10px; background: rgba(233, 30, 99, 0.2); border-radius: 8px; border-left: 4px solid #E91E63;';
        
			        item.innerHTML = `
			            <div style="flex: 1;">
			                <div style="font-weight: bold; font-size: 16px; margin-bottom: 5px;">${itinerary.name}</div>
			                <div style="font-size: 13px; color: #ccc;">${itinerary.steps.join(' â†’ ')}</div>
			            </div>
			            <div style="display: flex; gap: 10px;">
<button onclick="visualizeItinerary(${index})" style="padding: 10px 15px; background: #E91E63; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 13px; font-weight: bold;">
    ğŸ‘ï¸ Voir
</button>
<button onclick="editItinerary(${index})" style="padding: 10px 15px; background: #FF9800; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 13px; font-weight: bold;">
    âœï¸ Modifier
</button>
<button onclick="deleteItinerary(${index})" style="padding: 10px 15px; background: #f44336; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 13px;">
    ğŸ—‘ï¸
</button>
			            </div>
			        `;
        
			        listEl.appendChild(item);
			    });
			}

			// Recherche de pays pour l'itinÃ©raire
			document.addEventListener('DOMContentLoaded', () => {
			    const stepInput = document.getElementById('itinerary-step');
			    const resultsDiv = document.getElementById('itinerary-step-results');
    
			    stepInput.addEventListener('input', (e) => {
			        const search = e.target.value.toLowerCase();
        
			        if (search.length < 2) {
			            resultsDiv.innerHTML = '';
			            return;
			        }
        
					// âœ… Rechercher dans TOUS les lieux (pays + villes)
					const allLocations = Object.keys(countryCoordinates);

					const matches = allLocations.filter(loc => loc.toLowerCase().includes(search)).slice(0, 8);
        
			        if (matches.length === 0) {
			            resultsDiv.innerHTML = '<p style="color: #888; padding: 10px;">Aucun pays trouvÃ©</p>';
			            return;
			        }
        
			        resultsDiv.innerHTML = '';
					matches.forEach(location => {
					    const btn = document.createElement('button');
					    const locData = countryCoordinates[location];
    
					    // Afficher l'icÃ´ne selon le type
					    const icon = locData.type === 'city' ? 'ğŸ™ï¸' : 'ğŸŒ';
					    const label = locData.type === 'city' ? ` (${locData.country})` : '';
    
					    btn.textContent = `${icon} ${location}${label}`;
			            btn.style.cssText = 'display: block; width: 100%; padding: 10px; margin: 5px 0; background: rgba(100, 100, 100, 0.3); border: 1px solid #666; border-radius: 5px; color: white; cursor: pointer; text-align: left; transition: all 0.2s;';
			            btn.onmouseenter = () => btn.style.background = 'rgba(233, 30, 99, 0.4)';
			            btn.onmouseleave = () => btn.style.background = 'rgba(100, 100, 100, 0.3)';
			            btn.onclick = () => {
			                addStepToItinerary(location);
			                stepInput.value = '';
			                resultsDiv.innerHTML = '';
			            };
			            resultsDiv.appendChild(btn);
			        });
			    });
			});

			function addStepToItinerary(country) {
			    if (!currentItinerarySteps.includes(country)) {
			        currentItinerarySteps.push(country);
			        renderCurrentSteps();
			    }
			}

			function renderCurrentSteps() {
			    const stepsDiv = document.getElementById('steps-list');
    
			    if (currentItinerarySteps.length === 0) {
			        stepsDiv.innerHTML = '<p style="color: #888; font-style: italic;">Aucune Ã©tape ajoutÃ©e</p>';
			        return;
			    }
    
			    stepsDiv.innerHTML = '';
    
			    currentItinerarySteps.forEach((step, index) => {
			        const stepEl = document.createElement('div');
			        stepEl.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 10px; margin: 5px 0; background: rgba(233, 30, 99, 0.3); border-radius: 5px;';
        
			        stepEl.innerHTML = `
			            <div style="display: flex; align-items: center; gap: 10px;">
			                <span style="background: #E91E63; padding: 5px 10px; border-radius: 50%; font-weight: bold; font-size: 12px;">${index + 1}</span>
			                <span>${step}</span>
			            </div>
			            <button onclick="removeStep(${index})" style="padding: 5px 10px; background: #f44336; border: none; border-radius: 3px; color: white; cursor: pointer; font-size: 12px;">âœ•</button>
			        `;
        
			        stepsDiv.appendChild(stepEl);
			    });
			}

			function removeStep(index) {
			    currentItinerarySteps.splice(index, 1);
			    renderCurrentSteps();
			}

			// Sauvegarder l'itinÃ©raire
			document.getElementById('save-itinerary-btn').addEventListener('click', () => {
			    const name = document.getElementById('itinerary-name').value.trim();
    
			    if (!name) {
			        alert('âš ï¸ Veuillez donner un nom Ã  votre itinÃ©raire');
			        return;
			    }
    
			    if (currentItinerarySteps.length < 2) {
			        alert('âš ï¸ Ajoutez au moins 2 Ã©tapes Ã  votre itinÃ©raire');
			        return;
			    }
    
			    if (editingItineraryIndex !== null) {
			        // Mode Ã©dition : mettre Ã  jour l'itinÃ©raire existant
			        savedItineraries[editingItineraryIndex] = {
			            name: name,
			            steps: [...currentItinerarySteps],
			            createdAt: savedItineraries[editingItineraryIndex].createdAt,
			            updatedAt: new Date().toISOString()
			        };
        
			        saveItineraries();
			        renderSavedItineraries();
        
			        alert('âœ… ItinÃ©raire mis Ã  jour !');
			        cancelEdit();
			    } else {
			        // Mode crÃ©ation : ajouter un nouvel itinÃ©raire
			        savedItineraries.push({
			            name: name,
			            steps: [...currentItinerarySteps],
			            createdAt: new Date().toISOString()
			        });
        
			        saveItineraries();
			        renderSavedItineraries();
        
			        // RÃ©initialiser
			        document.getElementById('itinerary-name').value = '';
			        currentItinerarySteps = [];
			        renderCurrentSteps();
        
			        alert('âœ… ItinÃ©raire enregistrÃ© !');
			    }
			});

			// Effacer l'itinÃ©raire en cours
			document.getElementById('clear-itinerary-btn').addEventListener('click', () => {
			    currentItinerarySteps = [];
			    document.getElementById('itinerary-name').value = '';
			    renderCurrentSteps();
			});

			// Visualiser sur le globe
			document.getElementById('visualize-itinerary-btn').addEventListener('click', () => {
			    if (currentItinerarySteps.length < 2) {
			        alert('âš ï¸ Ajoutez au moins 2 Ã©tapes');
			        return;
			    }
    
			    displayItineraryOnGlobe(currentItinerarySteps);
			});

			function visualizeItinerary(index) {
			    const itinerary = savedItineraries[index];
			    displayItineraryOnGlobe(itinerary.steps);
			}

			function deleteItinerary(index) {
			    if (confirm('Es-tu sÃ»r de vouloir supprimer cet itinÃ©raire ?')) {
			        savedItineraries.splice(index, 1);
			        saveItineraries();
			        renderSavedItineraries();
			        showNotification('ItinÃ©raire supprimÃ©', 'info', 'Suppression effectuÃ©e');
			    }
			}
			
			let editingItineraryIndex = null;

			function editItinerary(index) {
			    const itinerary = savedItineraries[index];
			    editingItineraryIndex = index;
    
			    // PrÃ©-remplir le formulaire
			    document.getElementById('itinerary-name').value = itinerary.name;
			    currentItinerarySteps = [...itinerary.steps];
			    renderCurrentSteps();
    
			    // Changer le bouton de sauvegarde
			    const saveBtn = document.getElementById('save-itinerary-btn');
			    saveBtn.textContent = 'ğŸ’¾ Mettre Ã  jour l\'itinÃ©raire';
			    saveBtn.style.background = '#FF9800';
    
			    // Ajouter un bouton pour annuler l'Ã©dition
			    let cancelEditBtn = document.getElementById('cancel-edit-btn');
			    if (!cancelEditBtn) {
			        cancelEditBtn = document.createElement('button');
			        cancelEditBtn.id = 'cancel-edit-btn';
			        cancelEditBtn.textContent = 'âŒ Annuler les modifications';
			        cancelEditBtn.style.cssText = 'padding: 15px 20px; background: #555; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px;';
			        cancelEditBtn.onclick = cancelEdit;
			        document.getElementById('save-itinerary-btn').parentElement.appendChild(cancelEditBtn);
			    }
    
			    // Scroller vers le formulaire
			    document.getElementById('itinerary-name').scrollIntoView({ behavior: 'smooth', block: 'center' });
			}

			function cancelEdit() {
			    editingItineraryIndex = null;
			    document.getElementById('itinerary-name').value = '';
			    currentItinerarySteps = [];
			    renderCurrentSteps();
    
			    const saveBtn = document.getElementById('save-itinerary-btn');
			    saveBtn.textContent = 'ğŸ’¾ Enregistrer l\'itinÃ©raire';
			    saveBtn.style.background = '#4CAF50';
    
			    const cancelBtn = document.getElementById('cancel-edit-btn');
			    if (cancelBtn) cancelBtn.remove();
			}

			function displayItineraryOnGlobe(steps) {
			    clearItineraryFromGlobe();
    
			    const validSteps = steps.filter(location => countryCoordinates[location]);
    
			    if (validSteps.length < 2) {
			        alert('âš ï¸ Certains lieux n\'ont pas de coordonnÃ©es dÃ©finies.');
			        return;
			    }
    
			    // ğŸ”¥ PHASE 1 : CrÃ©er les arcs avec effet arc-en-ciel
			    const arcsData = [];
			    for (let i = 0; i < validSteps.length - 1; i++) {
			        const from = countryCoordinates[validSteps[i]];
			        const to = countryCoordinates[validSteps[i + 1]];
        
			        arcsData.push({
			            startLat: from.lat,
			            startLng: from.lng,
			            endLat: to.lat,
			            endLng: to.lng,
			            arcIndex: i,
			            progress: i / (validSteps.length - 1)
			        });
			    }
    
			    // ğŸ”¥ PHASE 2 : CrÃ©er des points HTML ultra-stylÃ©s
			    const pointsData = validSteps.map((location, index) => {
			        const coords = countryCoordinates[location];
			        return {
			            lat: coords.lat,
			            lng: coords.lng,
			            location: location,
			            index: index,
			            type: coords.type || 'country',
			            country: coords.country || location
			        };
			    });
    
			    console.log('ğŸ¨ Arcs:', arcsData.length, '| Points:', pointsData.length);
    
			    setTimeout(() => {
			        // ğŸŒˆ Arcs avec gradient arc-en-ciel progressif
			        myGlobe
			            .arcsData([])  // Reset d'abord
			            .htmlElementsData([]);  // Reset les points
        
			        // ğŸ¬ Animation progressive des arcs (un par un)
			        arcsData.forEach((arc, i) => {
			            setTimeout(() => {
			                myGlobe.arcsData([...myGlobe.arcsData(), arc]);
                
			                // Son "whoosh" (optionnel - dÃ©commenter si tu veux)
			                // new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwNUKvm8LlnHwU7k9r0yXkpBSh+zPLaizsKGGS56OihUhMLS6Hn87FaGAQugdH12Ys2CBlpvO/jnU4MjJaegTcAYQVgbF90m6yskGM4OF6h1d+nYBwGP5vb8L9yJQUsgs7y2Ik3CBlou+zkm00QDFCn4/C2YxwGOJHX8stzLgUnd8fw3Y9ACxNes+n0qFYUCkaf4PLAayIFK4HO8tmJNggaa73v5JxODA1Qq+fwuWcfBTqT2vTJeSkFKH7M8tqLOwoYZLno6aJSEwtKoefzsVoYBC6C0fXYizYIGWm87uOdTgyLlp+WMwBjBWBsX3SaqKuQcyQ==').play();
			            }, i * 600);  // DÃ©lai de 600ms entre chaque arc
			        });
        
			        // Configuration des arcs
			        myGlobe
			            .arcColor(d => {
			                // ğŸŒˆ Gradient arc-en-ciel selon la position
			                const hue = (d.progress * 360).toFixed(0);
			                return `hsl(${hue}, 100%, 60%)`;
			            })
			            .arcStroke(1.2)
			            .arcAltitude(d => 0.2 + (d.arcIndex * 0.03))
			            .arcDashLength(0.4)
			            .arcDashGap(0.2)
			            .arcDashAnimateTime(3000)
			            .arcDashInitialGap(() => Math.random());
        
			        // ğŸ¯ PHASE 3 : Points HTML ultra-stylÃ©s avec halos
			        setTimeout(() => {
			            myGlobe
			                .htmlElementsData(pointsData)
			                .htmlElement(d => {
			                    const el = document.createElement('div');
			                    el.style.cssText = 'pointer-events: auto; cursor: pointer;';
                    
			                    const icon = d.type === 'city' ? 'ğŸ™ï¸' : 'ğŸŒ';
			                    const delay = d.index * 0.3;
                    
			                    el.innerHTML = `
			                        <div style="
			                            position: relative;
			                            width: 30px;
			                            height: 30px;
			                            display: flex;
			                            align-items: center;
			                            justify-content: center;
			                            animation: pulse 2s infinite ${delay}s;
			                        ">
			                            <!-- Halo extÃ©rieur -->
			                            <div style="
			                                position: absolute;
			                                width: 50px;
			                                height: 50px;
			                                background: radial-gradient(circle, rgba(255,215,0,0.4) 0%, transparent 70%);
			                                border-radius: 50%;
			                                animation: glow 2s infinite ${delay}s;
			                            "></div>
                            
			                            <!-- Point central dorÃ© -->
			                            <div style="
			                                width: 15px;
			                                height: 15px;
			                                background: linear-gradient(135deg, #FFD700, #FFA500);
			                                border-radius: 50%;
			                                box-shadow: 
			                                    0 0 10px #FFD700,
			                                    0 0 20px #FFD700,
			                                    0 0 30px rgba(255,215,0,0.5),
			                                    inset 0 -2px 5px rgba(0,0,0,0.3);
			                                border: 2px solid rgba(255,255,255,0.8);
			                                z-index: 2;
			                            "></div>
                            
			                            <!-- NumÃ©ro de l'Ã©tape -->
			                            <div style="
			                                position: absolute;
			                                top: -25px;
			                                background: linear-gradient(135deg, #FFD700, #FFA500);
			                                color: #000;
			                                padding: 4px 8px;
			                                border-radius: 12px;
			                                font-weight: bold;
			                                font-size: 11px;
			                                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
			                                border: 1px solid rgba(255,255,255,0.5);
			                            ">${d.index + 1}</div>
			                        </div>
			                    `;
                    
			                    // ğŸ’¡ Tooltip au survol
			                    el.title = `${icon} ${d.location}${d.type === 'city' ? ' (' + d.country + ')' : ''}`;
                    
			                    return el;
			                })
			                .htmlAltitude(0.015);
            
			        }, arcsData.length * 600 + 500);  // Attendre que tous les arcs soient tracÃ©s
        
			    }, 100);
    
			    closeItineraryModal();
			    showExitItineraryButton();
				createItineraryTimeline(validSteps);
    
			    // ğŸ¬ PHASE 4 : Animation cinÃ©matique de camÃ©ra
			    setTimeout(() => {
			        cinematicCameraFlight(validSteps);
			    }, arcsData.length * 600 + 1000);
    
			    // ğŸ‰ Message de confirmation ultra-stylÃ©
			    const confirmDiv = document.createElement('div');
			    confirmDiv.style.cssText = `
			        position: fixed;
			        top: 20px;
			        left: 50%;
			        transform: translateX(-50%);
			        background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2));
			        backdrop-filter: blur(15px);
			        border: 2px solid rgba(255,215,0,0.5);
			        color: #FFD700;
			        padding: 20px 40px;
			        border-radius: 16px;
			        z-index: 2000;
			        font-weight: bold;
			        font-size: 16px;
			        box-shadow: 
			            0 8px 32px rgba(255,215,0,0.3),
			            0 0 60px rgba(255,215,0,0.2),
			            inset 0 1px 0 rgba(255,255,255,0.3);
			        animation: slideInDown 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
			    `;
			    confirmDiv.innerHTML = `
			        <div style="display: flex; align-items: center; gap: 15px;">
			            <div style="font-size: 32px; animation: pulse 1s infinite;">âœ¨</div>
			            <div>
			                <div style="font-size: 18px; margin-bottom: 4px;">ItinÃ©raire Premium</div>
			                <div style="font-size: 14px; opacity: 0.9;">${validSteps.length} Ã©tapes â€¢ Animation Next-Gen</div>
			            </div>
			        </div>
			    `;
			    document.body.appendChild(confirmDiv);
    
			    setTimeout(() => {
			        confirmDiv.style.animation = 'slideOutUp 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
			        setTimeout(() => confirmDiv.remove(), 600);
			    }, 4000);
			}
			
			function cinematicCameraFlight(steps) {
			    if (activeItineraryAnimation) {
			        clearTimeout(activeItineraryAnimation);
			    }
    
			    let currentStep = 0;
    
			    function flyToNext() {
			        if (currentStep >= steps.length) {
			            currentStep = 0;
			        }
        
			        const coords = countryCoordinates[steps[currentStep]];
			        const locData = countryCoordinates[steps[currentStep]];
        
			        // ğŸ¬ Phase 1 : Vue panoramique large
			        myGlobe.pointOfView({ 
			            lat: coords.lat, 
			            lng: coords.lng, 
			            altitude: 2.2 
			        }, 1500);
        
			        setTimeout(() => {
			            // ğŸ¬ Phase 2 : Zoom dramatique avec lÃ©gÃ¨re rotation
			            myGlobe.pointOfView({ 
			                lat: coords.lat + 3, 
			                lng: coords.lng, 
			                altitude: 0.4 
			            }, 2500);
			        }, 1700);
        
			        setTimeout(() => {
			            // ğŸ¬ Phase 3 : Position finale stable
			            myGlobe.pointOfView({ 
			                lat: coords.lat, 
			                lng: coords.lng, 
			                altitude: 0.8 
			            }, 1000);
			        }, 4400);
        
			        currentStep++;
			        activeItineraryAnimation = setTimeout(flyToNext, 6000);
			    }
    
			    flyToNext();
			}
			
			// âœ… NOUVELLE FONCTION : Afficher le bouton pour quitter la visualisation
			function showExitItineraryButton() {
			    // Supprimer l'ancien bouton s'il existe
			    const oldBtn = document.getElementById('exit-itinerary-btn');
			    if (oldBtn) oldBtn.remove();
    
			    const exitBtn = document.createElement('button');
			    exitBtn.id = 'exit-itinerary-btn';
			    exitBtn.innerHTML = 'âœ• Quitter l\'itinÃ©raire';
			    exitBtn.style.cssText = `
			        position: fixed;
			        top: 20px;
			        right: 20px;
			        z-index: 101;
			        padding: 12px 20px;
			        background: linear-gradient(135deg, #f44336, #d32f2f);
			        border: none;
			        border-radius: 8px;
			        color: white;
			        cursor: pointer;
			        font-size: 14px;
			        font-weight: bold;
			        box-shadow: 0 4px 12px rgba(244, 67, 54, 0.4);
			        transition: all 0.3s;
			        animation: slideInRight 0.5s ease-out;
			    `;
    
			    exitBtn.addEventListener('mouseenter', () => {
			        exitBtn.style.transform = 'scale(1.05)';
			        exitBtn.style.boxShadow = '0 6px 16px rgba(244, 67, 54, 0.6)';
			    });
    
			    exitBtn.addEventListener('mouseleave', () => {
			        exitBtn.style.transform = 'scale(1)';
			        exitBtn.style.boxShadow = '0 4px 12px rgba(244, 67, 54, 0.4)';
			    });
    
			    exitBtn.addEventListener('click', () => {
			        clearItineraryFromGlobe();
			        exitBtn.style.animation = 'slideOutRight 0.5s ease-out';
			        setTimeout(() => exitBtn.remove(), 500);
        
			        // Message de confirmation
			        const msg = document.createElement('div');
			        msg.style.cssText = `
			            position: fixed;
			            top: 20px;
			            left: 50%;
			            transform: translateX(-50%);
			            background: rgba(76, 175, 80, 0.15);
			            backdrop-filter: blur(10px);
			            border: 1px solid rgba(76, 175, 80, 0.4);
			            color: #4CAF50;
			            padding: 12px 24px;
			            border-radius: 8px;
			            z-index: 2000;
			            font-weight: bold;
			            animation: slideInDown 0.5s ease-out;
			        `;
			        msg.textContent = 'âœ“ Retour Ã  la vue normale';
			        document.body.appendChild(msg);
        
			        setTimeout(() => {
			            msg.style.animation = 'slideOutUp 0.5s ease-out';
			            setTimeout(() => msg.remove(), 500);
			        }, 2000);
			    });
    
			    document.body.appendChild(exitBtn);
				
			    // NOUVEAU : Bouton Export VidÃ©o
			    const videoBtn = document.createElement('button');
			    videoBtn.id = 'export-video-btn';
			    videoBtn.innerHTML = 'ğŸ¥ Exporter en vidÃ©o';
			    videoBtn.style.cssText = `
			        position: fixed;
			        top: 80px;
			        right: 20px;
			        z-index: 101;
			        padding: 12px 20px;
			        background: linear-gradient(135deg, #9C27B0, #7B1FA2);
			        border: none;
			        border-radius: 8px;
			        color: white;
			        cursor: pointer;
			        font-size: 14px;
			        font-weight: bold;
			        box-shadow: 0 4px 12px rgba(156, 39, 176, 0.4);
			        transition: all 0.3s;
			        animation: slideInRight 0.5s ease-out 0.2s;
			        animation-fill-mode: both;
			    `;
    
			    videoBtn.addEventListener('mouseenter', () => {
			        videoBtn.style.transform = 'scale(1.05)';
			        videoBtn.style.boxShadow = '0 6px 16px rgba(156, 39, 176, 0.6)';
			    });
    
			    videoBtn.addEventListener('mouseleave', () => {
			        videoBtn.style.transform = 'scale(1)';
			        videoBtn.style.boxShadow = '0 4px 12px rgba(156, 39, 176, 0.4)';
			    });
    
			    videoBtn.addEventListener('click', () => {
			        exportItineraryVideo();
			    });
    
			    document.body.appendChild(videoBtn);
			}
			
			async function exportItineraryVideo() {
			    const videoBtn = document.getElementById('export-video-btn');
			    const originalText = videoBtn.innerHTML;
    
			    try {
			        // VÃ©rifier si l'API est disponible
			        if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {
			            alert('âŒ Votre navigateur ne supporte pas l\'enregistrement vidÃ©o.\n\nUtilisez Chrome, Edge ou Firefox rÃ©cent.');
			            return;
			        }
        
			        // Masquer temporairement la sidebar
			        const sidebar = document.getElementById('sidebar');
			        const sidebarWasOpen = sidebar.classList.contains('open');
			        if (sidebarWasOpen) {
			            sidebar.classList.remove('open');
			        }
        
			        // Masquer le bouton toggle sidebar
			        const toggleBtn = document.getElementById('toggle-sidebar');
			        toggleBtn.style.display = 'none';
        
			        // Masquer les contrÃ´les
			        const controls = document.getElementById('controls');
			        controls.style.display = 'none';
        
			        // Message d'instructions
			        videoBtn.innerHTML = 'âºï¸ Enregistrement...';
			        videoBtn.style.background = '#f44336';
			        videoBtn.disabled = true;
        
			        const instructionsDiv = document.createElement('div');
			        instructionsDiv.id = 'video-instructions';
			        instructionsDiv.style.cssText = `
			            position: fixed;
			            top: 50%;
			            left: 50%;
			            transform: translate(-50%, -50%);
			            background: rgba(20, 20, 20, 0.98);
			            backdrop-filter: blur(20px);
			            border: 2px solid #9C27B0;
			            color: white;
			            padding: 30px 40px;
			            border-radius: 16px;
			            z-index: 2001;
			            font-size: 16px;
			            max-width: 500px;
			            text-align: center;
			            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
			            animation: popIn 0.3s ease-out;
			        `;
			        instructionsDiv.innerHTML = `
			            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ¬</div>
			            <h3 style="color: #9C27B0; margin-bottom: 15px;">Enregistrement vidÃ©o</h3>
			            <p style="margin-bottom: 20px; line-height: 1.6;">
			                1ï¸âƒ£ SÃ©lectionnez <strong>"Onglet"</strong> ou <strong>"FenÃªtre"</strong><br>
			                2ï¸âƒ£ Choisissez cet onglet dans la liste<br>
			                3ï¸âƒ£ Cochez <strong>"Partager l'audio de l'onglet"</strong><br>
			                4ï¸âƒ£ Cliquez sur <strong>"Partager"</strong>
			            </p>
			            <p style="font-size: 14px; color: #FF9800; margin-top: 15px;">
			                âš ï¸ L'enregistrement dÃ©marre automatiquement
			            </p>
			        `;
			        document.body.appendChild(instructionsDiv);
        
			        // Attendre 4 secondes pour lire les instructions
			        await new Promise(resolve => setTimeout(resolve, 4000));
			        instructionsDiv.remove();
        
			        // DÃ©marrer l'enregistrement d'Ã©cran
			        const stream = await navigator.mediaDevices.getDisplayMedia({
			            video: {
			                width: 1920,
			                height: 1080,
			                frameRate: 30
			            },
			            audio: false
			        });
        
			        const mediaRecorder = new MediaRecorder(stream, {
			            mimeType: 'video/webm;codecs=vp9',
			            videoBitsPerSecond: 5000000
			        });
        
			        const chunks = [];
        
			        mediaRecorder.ondataavailable = (e) => {
			            if (e.data.size > 0) {
			                chunks.push(e.data);
			            }
			        };
        
			        mediaRecorder.onstop = () => {
			            const blob = new Blob(chunks, { type: 'video/webm' });
			            const url = URL.createObjectURL(blob);
            
			            // TÃ©lÃ©charger automatiquement
			            const a = document.createElement('a');
			            a.href = url;
			            a.download = `itineraire_${Date.now()}.webm`;
			            a.click();
            
			            // Nettoyer
			            stream.getTracks().forEach(track => track.stop());
			            URL.revokeObjectURL(url);
            
			            // Restaurer l'interface
			            if (sidebarWasOpen) {
			                sidebar.classList.add('open');
			            }
			            toggleBtn.style.display = 'block';
			            controls.style.display = 'flex';
			            videoBtn.innerHTML = originalText;
			            videoBtn.style.background = 'linear-gradient(135deg, #9C27B0, #7B1FA2)';
			            videoBtn.disabled = false;
            
			            // Message de succÃ¨s
			            const successDiv = document.createElement('div');
			            successDiv.style.cssText = `
			                position: fixed;
			                top: 20px;
			                left: 50%;
			                transform: translateX(-50%);
			                background: rgba(76, 175, 80, 0.15);
			                backdrop-filter: blur(10px);
			                border: 1px solid rgba(76, 175, 80, 0.4);
			                color: #4CAF50;
			                padding: 15px 30px;
			                border-radius: 8px;
			                z-index: 2000;
			                font-weight: bold;
			                animation: slideInDown 0.5s ease-out;
			            `;
			            successDiv.textContent = 'âœ… VidÃ©o tÃ©lÃ©chargÃ©e avec succÃ¨s !';
			            document.body.appendChild(successDiv);
            
			            setTimeout(() => {
			                successDiv.style.animation = 'slideOutUp 0.5s ease-out';
			                setTimeout(() => successDiv.remove(), 500);
			            }, 3000);
			        };
        
			        // DÃ©tecter quand l'utilisateur arrÃªte le partage
			        stream.getVideoTracks()[0].addEventListener('ended', () => {
			            mediaRecorder.stop();
			        });
        
			        // DÃ©marrer l'enregistrement
			        mediaRecorder.start(100);
        
			        // Message d'enregistrement en cours
			        const recordingDiv = document.createElement('div');
			        recordingDiv.id = 'recording-indicator';
			        recordingDiv.style.cssText = `
			            position: fixed;
			            top: 20px;
			            left: 50%;
			            transform: translateX(-50%);
			            background: rgba(244, 67, 54, 0.15);
			            backdrop-filter: blur(10px);
			            border: 1px solid rgba(244, 67, 54, 0.4);
			            color: #f44336;
			            padding: 15px 30px;
			            border-radius: 8px;
			            z-index: 2000;
			            font-weight: bold;
			            animation: pulse 2s infinite;
			            display: flex;
			            align-items: center;
			            gap: 10px;
			        `;
			        recordingDiv.innerHTML = `
			            <div style="width: 12px; height: 12px; background: #f44336; border-radius: 50%; animation: pulse 1s infinite;"></div>
			            <span>ğŸ¥ Enregistrement en cours...</span>
			        `;
			        document.body.appendChild(recordingDiv);
        
			        // Supprimer l'indicateur quand l'enregistrement s'arrÃªte
			        stream.getVideoTracks()[0].addEventListener('ended', () => {
			            recordingDiv.remove();
			        });
        
			    } catch (error) {
			        console.error('Erreur:', error);
        
			        // Restaurer l'interface en cas d'erreur
			        const sidebar = document.getElementById('sidebar');
			        const toggleBtn = document.getElementById('toggle-sidebar');
			        const controls = document.getElementById('controls');
        
			        sidebar.classList.remove('open');
			        toggleBtn.style.display = 'block';
			        controls.style.display = 'flex';
			        videoBtn.innerHTML = originalText;
			        videoBtn.style.background = 'linear-gradient(135deg, #9C27B0, #7B1FA2)';
			        videoBtn.disabled = false;
        
			        const instructionsDiv = document.getElementById('video-instructions');
			        if (instructionsDiv) instructionsDiv.remove();
        
			        if (error.name === 'NotAllowedError') {
			            alert('âŒ Vous avez refusÃ© l\'autorisation d\'enregistrement.\n\nRelancez l\'export et acceptez le partage d\'Ã©cran.');
			        } else {
			            alert('âŒ Erreur lors de l\'enregistrement:\n' + error.message);
			        }
			    }
			}

			// âœ¨ Fonction pour ajouter un effet de pulsation aux points
			function addPulsingEffect() {
			    let scale = 1;
			    let direction = 1;
    
			    const pulse = setInterval(() => {
			        if (!document.getElementById('globe-container')) {
			            clearInterval(pulse);
			            return;
			        }
        
			        scale += direction * 0.05;
        
			        if (scale >= 1.3) direction = -1;
			        if (scale <= 1) direction = 1;
        
			        // L'effet de pulsation se fait via le pointRadius
			        myGlobe.pointRadius(d => d.size * scale);
			    }, 50);
    
			    // ArrÃªter aprÃ¨s 10 secondes
			    setTimeout(() => clearInterval(pulse), 10000);
			}
			
			function animateCameraAlongItinerary(steps) {
			    if (activeItineraryAnimation) {
			        clearTimeout(activeItineraryAnimation);
			    }
    
			    let currentStep = 0;
    
			    function moveToNextStep() {
			        if (currentStep >= steps.length) {
			            // Recommencer du dÃ©but
			            currentStep = 0;
			        }
        
			        const coords = countryCoordinates[steps[currentStep]];
        
			        // Zoom sur le pays actuel
			        myGlobe.pointOfView({ 
			            lat: coords.lat, 
			            lng: coords.lng, 
			            altitude: 1.2 
			        }, 2500);
        
			        currentStep++;
        
			        // Attendre 3 secondes avant de passer au suivant
			        activeItineraryAnimation = setTimeout(moveToNextStep, 3500);
			    }
    
			    moveToNextStep();
			}

			function clearItineraryFromGlobe() {
			    if (activeItineraryAnimation) {
			        clearTimeout(activeItineraryAnimation);
			        activeItineraryAnimation = null;
			    }
    
			    // âœ… RÃ©initialiser correctement TOUTES les donnÃ©es
			    if (myGlobe) {
			        myGlobe
			            .arcsData([])
			            .arcAltitude(0)
			            .pointsData([])
			            .pointAltitude(0)
			            .htmlElementsData([]);
			    }
    
			    // âœ… Supprimer les boutons s'ils existent
			    const exitBtn = document.getElementById('exit-itinerary-btn');
			    if (exitBtn) exitBtn.remove();
    
			    const videoBtn = document.getElementById('export-video-btn');
			    if (videoBtn) videoBtn.remove();
    
			    // Supprimer l'indicateur d'enregistrement si prÃ©sent
			    const recordingIndicator = document.getElementById('recording-indicator');
			    if (recordingIndicator) recordingIndicator.remove();
				const timeline = document.getElementById('itinerary-timeline');
				if (timeline) timeline.remove();
			}

			// Event listener
			document.getElementById('itinerary-btn').addEventListener('click', openItineraryModal);

			// Rendre accessibles globalement
			window.closeItineraryModal = closeItineraryModal;
			window.removeStep = removeStep;
			window.visualizeItinerary = visualizeItinerary;
			window.deleteItinerary = deleteItinerary;
			window.editItinerary = editItinerary;
			window.cancelEdit = cancelEdit;

			// Charger les itinÃ©raires au dÃ©marrage
			loadItineraries();
			
			function calculateDistance(lat1, lng1, lat2, lng2) {
			    const R = 6371; // Rayon de la Terre en km
			    const dLat = (lat2 - lat1) * Math.PI / 180;
			    const dLng = (lng2 - lng1) * Math.PI / 180;
			    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
			              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
			              Math.sin(dLng/2) * Math.sin(dLng/2);
			    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
			    return Math.round(R * c);
			}

			function calculateFlightDuration(distance) {
			    // Vitesse moyenne d'un avion commercial : ~800 km/h
			    // + 30 min de dÃ©collage/atterrissage
			    const flightTime = (distance / 800) + 0.5;
			    const hours = Math.floor(flightTime);
			    const minutes = Math.round((flightTime - hours) * 60);
			    return { hours, minutes, total: flightTime };
			}
			
			function createItineraryTimeline(steps) {
			    // Supprimer l'ancienne timeline si elle existe
			    const oldTimeline = document.getElementById('itinerary-timeline');
			    if (oldTimeline) oldTimeline.remove();
    
			    const timeline = document.createElement('div');
			    timeline.id = 'itinerary-timeline';
			    timeline.style.cssText = `
			        position: fixed;
			        bottom: 0;
			        left: 0;
			        right: 0;
			        height: 120px;
			        background: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.95) 20%);
			        backdrop-filter: blur(15px);
			        z-index: 100;
			        display: flex;
			        align-items: center;
			        padding: 20px 40px;
			        overflow-x: auto;
			        overflow-y: hidden;
			        animation: slideInUp 0.6s ease-out;
			        border-top: 2px solid rgba(255, 215, 0, 0.3);
			        box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.5);
			    `;
    
			    const timelineContent = document.createElement('div');
			    timelineContent.style.cssText = `
			        display: flex;
			        align-items: center;
			        gap: 0;
			        min-width: max-content;
			        margin: 0 auto;
			    `;
    
			    steps.forEach((location, index) => {
			        const coords = countryCoordinates[location];
			        const locData = countryCoordinates[location];
			        const icon = locData.type === 'city' ? 'ğŸ™ï¸' : 'ğŸŒ';
        
			        // Point de la destination
			        const point = document.createElement('div');
			        point.style.cssText = `
			            position: relative;
			            display: flex;
			            flex-direction: column;
			            align-items: center;
			            gap: 8px;
			            cursor: pointer;
			            transition: transform 0.3s;
			        `;
        
			        point.addEventListener('mouseenter', () => {
			            point.style.transform = 'scale(1.15)';
			        });
        
			        point.addEventListener('mouseleave', () => {
			            point.style.transform = 'scale(1)';
			        });
        
			        point.addEventListener('click', () => {
			            myGlobe.pointOfView({ 
			                lat: coords.lat, 
			                lng: coords.lng, 
			                altitude: 0.8 
			            }, 1500);
			        });
        
			        point.innerHTML = `
			            <div style="
			                width: 40px;
			                height: 40px;
			                background: linear-gradient(135deg, #FFD700, #FFA500);
			                border-radius: 50%;
			                display: flex;
			                align-items: center;
			                justify-content: center;
			                box-shadow: 
			                    0 0 20px rgba(255, 215, 0, 0.6),
			                    0 0 40px rgba(255, 215, 0, 0.3);
			                border: 3px solid rgba(255, 255, 255, 0.8);
			                position: relative;
			            ">
			                <span style="font-size: 10px; font-weight: bold; color: #000;">${index + 1}</span>
			                <div style="
			                    position: absolute;
			                    top: -8px;
			                    right: -8px;
			                    font-size: 18px;
			                ">${icon}</div>
			            </div>
			            <div style="
			                font-size: 13px;
			                font-weight: bold;
			                color: #FFD700;
			                text-align: center;
			                max-width: 120px;
			                white-space: nowrap;
			                overflow: hidden;
			                text-overflow: ellipsis;
			            ">${location}</div>
			        `;
        
			        timelineContent.appendChild(point);
        
			        // Ligne de connexion avec infos (sauf aprÃ¨s le dernier point)
			        if (index < steps.length - 1) {
			            const nextLocation = steps[index + 1];
			            const nextCoords = countryCoordinates[nextLocation];
            
			            const distance = calculateDistance(
			                coords.lat, coords.lng,
			                nextCoords.lat, nextCoords.lng
			            );
            
			            const flight = calculateFlightDuration(distance);
            
			            const connector = document.createElement('div');
			            connector.style.cssText = `
			                position: relative;
			                display: flex;
			                flex-direction: column;
			                align-items: center;
			                justify-content: center;
			                padding: 0 30px;
			                gap: 8px;
			            `;
            
			            connector.innerHTML = `
			                <!-- Ligne de connexion -->
			                <div style="
			                    width: 100%;
			                    height: 3px;
			                    background: linear-gradient(90deg, 
			                        #FFD700 0%, 
			                        rgba(255, 215, 0, 0.5) 50%, 
			                        #FFD700 100%);
			                    position: relative;
			                    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
			                ">
			                    <!-- Avion animÃ© -->
			                    <div style="
			                        position: absolute;
			                        top: 50%;
			                        left: 50%;
			                        transform: translate(-50%, -50%);
			                        font-size: 20px;
			                        animation: fly 3s infinite linear;
			                    ">âœˆï¸</div>
			                </div>
                
			                <!-- Infos distance et durÃ©e -->
			                <div style="
			                    background: rgba(0, 0, 0, 0.8);
			                    border: 1px solid rgba(255, 215, 0, 0.4);
			                    border-radius: 8px;
			                    padding: 8px 12px;
			                    display: flex;
			                    flex-direction: column;
			                    gap: 4px;
			                    min-width: 150px;
			                ">
			                    <div style="
			                        font-size: 12px;
			                        font-weight: bold;
			                        color: #FFD700;
			                        display: flex;
			                        align-items: center;
			                        gap: 6px;
			                    ">
			                        ğŸ“ ${distance.toLocaleString()} km
			                    </div>
			                    <div style="
			                        font-size: 11px;
			                        color: #4CAF50;
			                        display: flex;
			                        align-items: center;
			                        gap: 6px;
			                    ">
			                        â±ï¸ ${flight.hours}h${flight.minutes.toString().padStart(2, '0')} de vol
			                    </div>
			                </div>
			            `;
            
			            timelineContent.appendChild(connector);
			        }
			    });
    
			    // Calculer le total
			    let totalDistance = 0;
			    let totalFlightTime = 0;
    
			    for (let i = 0; i < steps.length - 1; i++) {
			        const coords1 = countryCoordinates[steps[i]];
			        const coords2 = countryCoordinates[steps[i + 1]];
			        const distance = calculateDistance(coords1.lat, coords1.lng, coords2.lat, coords2.lng);
			        const flight = calculateFlightDuration(distance);
			        totalDistance += distance;
			        totalFlightTime += flight.total;
			    }
    
			    const totalHours = Math.floor(totalFlightTime);
			    const totalMinutes = Math.round((totalFlightTime - totalHours) * 60);
    
			    // Ajouter un rÃ©sumÃ© total Ã  droite
			    const summary = document.createElement('div');
			    summary.style.cssText = `
			        position: absolute;
			        right: 40px;
			        top: 50%;
			        transform: translateY(-50%);
			        background: linear-gradient(135deg, rgba(156, 39, 176, 0.3), rgba(123, 31, 162, 0.3));
			        backdrop-filter: blur(10px);
			        border: 2px solid rgba(156, 39, 176, 0.5);
			        border-radius: 12px;
			        padding: 15px 20px;
			        box-shadow: 0 4px 20px rgba(156, 39, 176, 0.4);
			    `;
    
			    summary.innerHTML = `
			        <div style="font-size: 11px; color: #9C27B0; font-weight: bold; margin-bottom: 6px;">
			            ğŸ“Š RÃ‰SUMÃ‰ TOTAL
			        </div>
			        <div style="font-size: 13px; font-weight: bold; color: #FFD700; margin-bottom: 4px;">
			            ğŸŒ ${totalDistance.toLocaleString()} km
			        </div>
			        <div style="font-size: 12px; color: #4CAF50;">
			            âœˆï¸ ${totalHours}h${totalMinutes.toString().padStart(2, '0')} de vol
			        </div>
			    `;
    
			    timeline.appendChild(timelineContent);
			    timeline.appendChild(summary);
    
			    document.body.appendChild(timeline);
			}

			// Animation pour l'avion
			const style = document.createElement('style');
			style.textContent = `
			    @keyframes fly {
			        0% { left: 0%; }
			        100% { left: 100%; }
			    }
    
			    @keyframes slideInUp {
			        from {
			            transform: translateY(100%);
			            opacity: 0;
			        }
			        to {
			            transform: translateY(0);
			            opacity: 1;
			        }
			    }
    
			    #itinerary-timeline::-webkit-scrollbar {
			        height: 8px;
			    }
    
			    #itinerary-timeline::-webkit-scrollbar-track {
			        background: rgba(0, 0, 0, 0.3);
			    }
    
			    #itinerary-timeline::-webkit-scrollbar-thumb {
			        background: rgba(255, 215, 0, 0.5);
			        border-radius: 4px;
			    }
    
			    #itinerary-timeline::-webkit-scrollbar-thumb:hover {
			        background: rgba(255, 215, 0, 0.8);
			    }
			`;
			document.head.appendChild(style);	
			
			function showAuthModal(mode) {
			    document.getElementById('auth-modal').style.display = 'block';
			    document.getElementById('overlay').classList.add('active');
    
			    const usernameInput = document.getElementById('auth-username');
			    const titleEl = document.getElementById('auth-title');
			    const submitBtn = document.getElementById('auth-submit');
    
			    if (mode === 'signup') {
			        // Mode inscription
			        usernameInput.style.display = 'block';
			        titleEl.textContent = 'âœ¨ CrÃ©er un compte';
			        submitBtn.textContent = "S'inscrire";
			        submitBtn.onclick = () => {
			            const username = document.getElementById('auth-username').value;
			            const email = document.getElementById('auth-email').value;
			            const password = document.getElementById('auth-password').value;
            
						if (!username || !email || !password) {
						    showNotification('Remplis tous les champs', 'warning', 'Champs manquants');
						    return;
						}
            
			            signUp(email, password, username);
			            closeAuthModal();
			        };
			    } else {
			        // Mode connexion
			        usernameInput.style.display = 'none';
			        titleEl.textContent = 'ğŸ”’ Connexion';
			        submitBtn.textContent = 'Se connecter';
			        submitBtn.onclick = () => {
			            const email = document.getElementById('auth-email').value;
			            const password = document.getElementById('auth-password').value;
            
						if (!email || !password) {
						    showNotification('Remplis tous les champs', 'warning', 'Champs manquants');
						    return;
						}
            
			            signIn(email, password); // âœ… CORRECTION ICI
			            closeAuthModal();
			        };
			    }
			}
			
			window.showAuthModal = showAuthModal;
			window.closeAuthModal = closeAuthModal;	

			function closeAuthModal() {
			    document.getElementById('auth-modal').style.display = 'none';
			    document.getElementById('overlay').classList.remove('active');
    
			    // RÃ©initialiser les champs
			    document.getElementById('auth-username').value = '';
			    document.getElementById('auth-email').value = '';
			    document.getElementById('auth-password').value = '';
			}
			
			function showNotification(message, type = 'success', title = '') {
			    const notification = document.createElement('div');
			    notification.style.cssText = `
			        position: fixed;
			        top: 20px;
			        right: 20px;
			        min-width: 300px;
			        max-width: 400px;
			        background: ${type === 'success' ? 'linear-gradient(135deg, #4CAF50, #45a049)' : 
			                     type === 'warning' ? 'linear-gradient(135deg, #FF9800, #F57C00)' : 
			                     'linear-gradient(135deg, #2196F3, #1976D2)'};
			        color: white;
			        padding: 20px 25px;
			        border-radius: 12px;
			        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
			        z-index: 9999;
			        animation: slideInRight 0.5s ease-out;
			        border-left: 5px solid rgba(255, 255, 255, 0.5);
			    `;
    
			    notification.innerHTML = `
			        <div style="display: flex; align-items: center; gap: 15px;">
			            <div style="font-size: 32px;">${type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</div>
			            <div style="flex: 1;">
			                ${title ? `<div style="font-weight: bold; font-size: 16px; margin-bottom: 5px;">${title}</div>` : ''}
			                <div style="font-size: 14px; opacity: 0.95;">${message}</div>
			            </div>
			        </div>
			    `;
    
			    document.body.appendChild(notification);
    
			    setTimeout(() => {
			        notification.style.animation = 'slideOutRight 0.5s ease-out';
			        setTimeout(() => notification.remove(), 500);
			    }, 3000);
			}
						
</script>
			
	</body>
	</html>
