<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voyage avec Martin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #000;
            color: #fff;
            overflow: hidden;
        }

        #container {
            display: flex;
            width: 100vw;
            height: 100vh;
        }

		#sidebar {
		    position: fixed;
		    left: -380px;
		    top: 0;
		    width: 380px;
		    height: 100vh;
		    background: rgba(20, 20, 20, 0.95);
		    border-right: 2px solid #333;
		    overflow-y: auto;
		    padding: 20px;
		    z-index: 100;
		    transition: left 0.3s ease;
		}

		#sidebar.open {
		    left: 0;
		}

        #header {
            text-align: center;
            margin-bottom: 20px;
        }

		#logo {
		    width: 300px;
		    height: 300px;
		    margin: 0 auto 10px;
		    display: block;
		    object-fit: contain;
		}
        #title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        #search-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #444;
            border-radius: 5px;
            background: #1a1a1a;
            color: #fff;
            font-size: 14px;
        }

        #stats {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        #stats h3 {
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .continent-section {
            margin-bottom: 15px;
        }

        .continent-header {
            background: rgba(50, 50, 50, 0.8);
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
        }

        .continent-header:hover {
            background: rgba(70, 70, 70, 0.9);
        }

        .continent-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .continent-stats {
            font-size: 12px;
            color: #4CAF50;
        }

        .continent-countries {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .continent-countries.open {
            max-height: 2000px;
        }

        .country-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            margin-left: 15px;
            background: rgba(40, 40, 40, 0.5);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .country-item:hover {
            background: rgba(60, 60, 60, 0.8);
        }

        .country-item.visited {
            background: rgba(76, 175, 80, 0.3);
            border-left: 4px solid #4CAF50;
        }

        .country-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .country-name {
            flex: 1;
            font-size: 14px;
        }

        .country-rating {
            font-size: 12px;
            color: #FFD700;
        }

        #globe-container {
            flex: 1;
            position: relative;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .control-btn {
            padding: 10px 15px;
            background: #4CAF50;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .control-btn:hover {
            background: #45a049;
        }

        #modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 20, 0.98);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #4CAF50;
            min-width: 450px;
            max-width: 600px;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
			max-height: 90vh;
			    overflow-y: auto;
        }

        #modal.active {
            display: block;
        }

        #modal h2 {
            margin-bottom: 20px;
            color: #4CAF50;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #ccc;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #4a4a4a;
            background: #1a1a1a;
            color: #fff;
            font-family: 'Segoe UI', Arial;
            resize: vertical;
            min-height: 100px;
            font-size: 14px;
        }

        .rating {
            display: flex;
            gap: 8px;
            font-size: 35px;
        }

        .star {
            cursor: pointer;
            color: #4a4a4a;
            transition: color 0.2s;
        }

        .star:hover,
        .star.active {
            color: #FFD700;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-neutral {
            background: #555;
            color: white;
        }

        .btn-neutral:hover {
            background: #666;
        }
		
		#close-stats-btn,
		#close-bucket-btn {
		    position: absolute;
		    top: 15px;
		    right: 15px;
		    width: 35px;
		    height: 35px;
		    min-width: 35px;
		    min-height: 35px;
		    background: #f44336;
		    border: none;
		    border-radius: 50%;
		    color: white;
		    cursor: pointer;
		    font-size: 20px;
		    font-weight: bold;
		    line-height: 35px;
		    text-align: center;
		    padding: 0;
		    transition: background 0.3s, transform 0.3s;
		}

		#close-stats-btn:hover,
		#close-bucket-btn:hover {
		    background: #d32f2f;
		    transform: scale(1.1);
		}

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        #overlay.active {
            display: block;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #45a049;
        }

        .arrow {
            transition: transform 0.3s;
        }

        .arrow.open {
            transform: rotate(90deg);
        }
    </style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="container">
		<button id="toggle-sidebar" style="position: fixed; top: 20px; left: 20px; z-index: 101; padding: 10px 15px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 20px;">‚ò∞</button>
        <div id="sidebar">
            <div id="header">
<img id="logo" src="images/logo_vam.png" alt="Logo">
                <div id="title">üåç Voyage avec Martin</div>
            </div>

<div id="stats">
    <h3>Statistiques</h3>
    <p><span id="visited-count">0</span> / <span id="total-count">0</span> pays visit√©s</p>
    <p>Note moyenne : <span id="avg-rating">-</span> ‚≠ê</p>
    <p>Dernier voyage : <span id="last-country">-</span></p>
</div>

<button id="personal-stats-btn" style="width: 100%; padding: 12px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; margin-bottom: 20px; font-weight: bold;">
    üìä Mes Statistiques D√©taill√©es
</button>
<button id="bucket-list-btn" style="width: 100%; padding: 12px; background: #FF9800; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; margin-bottom: 20px; font-weight: bold;">
    üéØ Ma Bucket List
</button>

            <input type="text" id="search-box" placeholder="üîç Rechercher un pays...">
			<select id="rating-filter" style="width: 100%; padding: 10px; margin-bottom: 20px; background: #1a1a1a; color: #fff; border: 1px solid #444; border-radius: 5px; font-size: 14px;">
			    <option value="all">Toutes les notes</option>
			    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê uniquement</option>
			    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê et plus</option>
			    <option value="3">‚≠ê‚≠ê‚≠ê et plus</option>
			    <option value="2">‚≠ê‚≠ê et plus</option>
			    <option value="1">‚≠ê et plus</option>
			    <option value="0">Pays visit√©s sans note</option>
			</select>

            <div id="continents-list"></div>
        </div>

        <div id="globe-container"></div>
        
<div id="controls">
    <button class="control-btn" onclick="resetView()">üîÑ R√©initialiser</button>
    <button class="control-btn" onclick="toggleRotation()">üîÑ Rotation</button>	
</div>

        <div id="overlay"></div>
        
        <div id="modal">
            <h2 id="modal-title">Pays</h2>
            <div class="form-group">
                <label>üìù Notes sur votre voyage :</label>
                <textarea id="notes-input" placeholder="Ce que vous avez aim√©, vos souvenirs, conseils..."></textarea>
            </div>
            <div class="form-group">
                <label>‚≠ê Votre note :</label>
                <div class="rating" id="rating-stars">
                    <span class="star" data-rating="1">‚òÖ</span>
                    <span class="star" data-rating="2">‚òÖ</span>
                    <span class="star" data-rating="3">‚òÖ</span>
                    <span class="star" data-rating="4">‚òÖ</span>
                    <span class="star" data-rating="5">‚òÖ</span>
                </div>
    
				    <!-- Photos -->
				    <div class="form-group">
				        <label>üì∏ Photos de voyage (max 5) :</label>
				        <input type="file" id="photos-input" accept="image/*" multiple style="width: 100%; padding: 10px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff;">
				        <div id="photos-preview" style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;"></div>
				    </div>

				    <!-- Budget -->
				    <div class="form-group">
				        <label>üí∞ Budget d√©pens√© (‚Ç¨) :</label>
				        <input type="number" id="budget-input" placeholder="Ex: 1500" style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 5px; color: #fff; font-size: 14px;">
				    </div>

				    <!-- Activit√©s -->
				    <div class="form-group">
				        <label>üéØ Activit√©s favorites :</label>
				        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="plage"> üèñÔ∏è Plage
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="montagne"> üèîÔ∏è Montagne
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="musees"> üèõÔ∏è Mus√©es
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="gastronomie"> üçΩÔ∏è Gastronomie
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="nightlife"> üéâ Vie nocturne
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="shopping"> üõçÔ∏è Shopping
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="nature"> üåø Nature
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="activity-checkbox" data-activity="aventure"> üßó Aventure
				            </label>
				        </div>
				    </div>

				    <!-- Compagnons -->
				    <div class="form-group">
				        <label>üë• Avec qui avez-vous voyag√© ?</label>
				        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="companion-checkbox" data-companion="Solo"> üß≥ Solo
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="companion-checkbox" data-companion="Couple"> üíë Couple
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="companion-checkbox" data-companion="Famille"> üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Famille
				            </label>
				            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
				                <input type="checkbox" class="companion-checkbox" data-companion="Amis"> üëØ Amis
				            </label>
				        </div>
				    </div>

				    <div class="button-group">
				        <button class="btn-primary" id="save-btn">üíæ Sauvegarder</button>
				        <button class="btn-primary" id="export-pdf-btn" style="background: #2196F3;">üìÑ Export PDF</button>
				        <button class="btn-bucket" id="add-bucket-btn" style="background: #FF9800; color: white; flex: 1;">üéØ Ajouter √† ma Bucket List</button>
				        <button class="btn-neutral" id="cancel-btn">‚ùå Annuler</button>
				    </div>
				</div>
            </div>
        </div>
		</div>
<div id="stats-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #4CAF50; width: 80%; max-width: 800px; max-height: 80vh; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);">
    <button id="close-stats-btn" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 20px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: background 0.3s;">‚úï</button>
    
    <h2 style="color: #4CAF50; margin-bottom: 30px; text-align: center;">üìä Mes Statistiques de Voyage</h2>
    
    <div id="world-completion" style="margin-bottom: 30px; padding: 20px; background: rgba(76, 175, 80, 0.2); border-radius: 8px;">
        <h3 style="color: #4CAF50; margin-bottom: 15px;">üåç Monde</h3>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="flex: 1; background: #1a1a1a; height: 30px; border-radius: 15px; overflow: hidden;">
                <div id="world-progress-bar" style="height: 100%; background: linear-gradient(90deg, #4CAF50, #45a049); transition: width 0.3s; width: 0%;"></div>
            </div>
            <span id="world-percentage" style="font-size: 24px; font-weight: bold; color: #4CAF50; min-width: 70px;">0%</span>
        </div>
    </div>
    
    <div id="continents-completion"></div>
</div>
        
		
<div id="bucket-list-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 20, 0.98); padding: 30px; border-radius: 12px; border: 2px solid #FF9800; width: 85%; max-width: 900px; max-height: 85vh; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);">
    <button id="close-bucket-btn" style="position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; background: #f44336; border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 20px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: background 0.3s;">‚úï</button>
    
    <h2 style="color: #FF9800; margin-bottom: 30px; text-align: center;">üéØ Ma Bucket List</h2>
    
    <div style="display: flex; gap: 20px; margin-bottom: 30px;">
        <input type="text" id="bucket-search" placeholder="üîç Rechercher un pays √† ajouter..." style="flex: 1; padding: 12px; background: #1a1a1a; color: #fff; border: 1px solid #444; border-radius: 5px; font-size: 14px;">
        <button id="suggestions-btn" style="padding: 12px 20px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; white-space: nowrap;">
            ‚ú® Suggestions
        </button>
    </div>
    
    <div id="bucket-search-results" style="margin-bottom: 20px;"></div>
    
    <div id="bucket-suggestions" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(76, 175, 80, 0.2); border-radius: 8px; border-left: 4px solid #4CAF50;">
        <h3 style="color: #4CAF50; margin-bottom: 15px;">üí° Suggestions bas√©es sur vos voyages</h3>
        <div id="suggestions-content"></div>
    </div>
    
    <div id="bucket-list-content">
        <h3 style="color: #FF9800; margin-bottom: 20px;">üìã Vos destinations de r√™ve (<span id="bucket-count">0</span>)</h3>
        <div id="bucket-items"></div>
        <div id="bucket-empty" style="text-align: center; padding: 40px; color: #888;">
            <p style="font-size: 48px; margin-bottom: 10px;">üó∫Ô∏è</p>
            <p>Votre bucket list est vide</p>
            <p style="font-size: 14px; margin-top: 10px;">Recherchez des pays ci-dessus ou cliquez sur "Suggestions"</p>
        </div>
    </div>
    
    <div id="itinerary-section" style="display: none; margin-top: 30px; padding: 20px; background: rgba(255, 152, 0, 0.2); border-radius: 8px; border-left: 4px solid #FF9800;">
        <h3 style="color: #FF9800; margin-bottom: 15px;">üó∫Ô∏è Itin√©raires sugg√©r√©s</h3>
        <div id="itinerary-content"></div>
    </div>
</div>
    
		</div>
    </div>

    <!-- Three.js et Globe.GL -->
    <script src="https://unpkg.com/three"></script>
    <script src="https://unpkg.com/globe.gl"></script>

    <script>
        let visitedCountries = {};
        let currentRating = 0;
        let selectedCountry = null;
        let myGlobe;
        let countriesGeoJson;

        // Correspondance des noms de pays (format interface -> format GeoJSON)
        const countryNameMapping = {
            '√âtats-Unis': 'United States of America',
            'Royaume-Uni': 'United Kingdom',
            'Russie': 'Russia',
            'Chine': 'China',
            'Inde': 'India',
            'Br√©sil': 'Brazil',
            'France': 'France',
            'Allemagne': 'Germany',
            'Italie': 'Italy',
            'Espagne': 'Spain',
            'Canada': 'Canada',
            'Australie': 'Australia',
            'Japon': 'Japan',
            'Cor√©e du Sud': 'South Korea',
            'Mexique': 'Mexico',
            'Argentine': 'Argentina',
            'Afrique du Sud': 'South Africa',
            '√âgypte': 'Egypt',
            'Turquie': 'Turkey',
            'Tha√Ølande': 'Thailand',
            'Vietnam': 'Vietnam',
            'Indon√©sie': 'Indonesia',
            'Philippines': 'Philippines',
            'Pakistan': 'Pakistan',
            'Bangladesh': 'Bangladesh',
            'Alg√©rie': 'Algeria',
            'Maroc': 'Morocco',
            'Tunisie': 'Tunisia',
            'Kenya': 'Kenya',
            'Nigeria': 'Nigeria',
            '√âthiopie': 'Ethiopia',
            'Tanzanie': 'Tanzania',
            'Ghana': 'Ghana',
            'Soudan': 'Sudan',
            'Arabie Saoudite': 'Saudi Arabia',
            'Iran': 'Iran',
            'Irak': 'Iraq',
            'Syrie': 'Syria',
            'Isra√´l': 'Israel',
            'Jordanie': 'Jordan',
            'Liban': 'Lebanon',
            '√âmirats Arabes Unis': 'United Arab Emirates',
            'Afghanistan': 'Afghanistan',
            'Kazakhstan': 'Kazakhstan',
            'Ouzb√©kistan': 'Uzbekistan',
            'Pologne': 'Poland',
            'Roumanie': 'Romania',
            'Pays-Bas': 'Netherlands',
            'Belgique': 'Belgium',
            'Gr√®ce': 'Greece',
            'Portugal': 'Portugal',
            'Tch√©quie': 'Czechia',
            'Hongrie': 'Hungary',
            'Su√®de': 'Sweden',
            'Autriche': 'Austria',
            'Suisse': 'Switzerland',
            'Bulgarie': 'Bulgaria',
            'Serbie': 'Serbia',
            'Danemark': 'Denmark',
            'Finlande': 'Finland',
            'Slovaquie': 'Slovakia',
            'Norv√®ge': 'Norway',
            'Irlande': 'Ireland',
            'Croatie': 'Croatia',
            'Bosnie-Herz√©govine': 'Bosnia and Herzegovina',
            'Albanie': 'Albania',
            'Lituanie': 'Lithuania',
            'Slov√©nie': 'Slovenia',
            'Lettonie': 'Latvia',
            'Estonie': 'Estonia',
            'Bi√©lorussie': 'Belarus',
            'Ukraine': 'Ukraine',
            'Moldavie': 'Moldova',
            'Arm√©nie': 'Armenia',
            'G√©orgie': 'Georgia',
            'Azerba√Ødjan': 'Azerbaijan',
            'Chili': 'Chile',
            'Colombie': 'Colombia',
            'Venezuela': 'Venezuela',
            'P√©rou': 'Peru',
            '√âquateur': 'Ecuador',
            'Bolivie': 'Bolivia',
            'Paraguay': 'Paraguay',
            'Uruguay': 'Uruguay',
            'Cuba': 'Cuba',
            'Ha√Øti': 'Haiti',
            'R√©publique Dominicaine': 'Dominican Republic',
            'Guatemala': 'Guatemala',
            'Honduras': 'Honduras',
            'Nicaragua': 'Nicaragua',
            'Costa Rica': 'Costa Rica',
            'Panama': 'Panama',
            'Jama√Øque': 'Jamaica',
            'Nouvelle-Z√©lande': 'New Zealand',
            'Malaisie': 'Malaysia',
            'Singapour': 'Singapore',
            'Myanmar': 'Myanmar',
            'Cambodge': 'Cambodia',
            'Laos': 'Laos',
            'N√©pal': 'Nepal',
            'Sri Lanka': 'Sri Lanka',
            'Mongolie': 'Mongolia',
            'Cor√©e du Nord': 'North Korea',
            'Ta√Øwan': 'Taiwan',
            'Y√©men': 'Yemen',
            'Oman': 'Oman',
            'Kowe√Øt': 'Kuwait',
            'Qatar': 'Qatar',
            'Bahre√Øn': 'Bahrain',
            'Libye': 'Libya',
            'Mali': 'Mali',
            'Niger': 'Niger',
            'Tchad': 'Chad',
            'Mauritanie': 'Mauritania',
            'S√©n√©gal': 'Senegal',
            'Guin√©e': 'Guinea',
            'C√¥te d\'Ivoire': 'Ivory Coast',
            'Burkina Faso': 'Burkina Faso',
            'B√©nin': 'Benin',
            'Togo': 'Togo',
            'Cameroun': 'Cameroon',
            'Gabon': 'Gabon',
            'Congo': 'Republic of the Congo',
            'R√©publique D√©mocratique du Congo': 'Democratic Republic of the Congo',
            'Angola': 'Angola',
            'Zambie': 'Zambia',
            'Zimbabwe': 'Zimbabwe',
            'Mozambique': 'Mozambique',
            'Madagascar': 'Madagascar',
            'Botswana': 'Botswana',
            'Namibie': 'Namibia',
            'Rwanda': 'Rwanda',
            'Burundi': 'Burundi',
            'Somalie': 'Somalia',
            '√ârythr√©e': 'Eritrea',
            'Djibouti': 'Djibouti',
            'Gambie': 'Gambia',
            'Bhoutan': 'Bhutan',
            'Maldives': 'Maldives',
            'Brunei': 'Brunei',
            'Fidji': 'Fiji',
            'Turkm√©nistan': 'Turkmenistan',
            'Kirghizistan': 'Kyrgyzstan',
            'Tadjikistan': 'Tajikistan',
            'Andorre': 'Andorra',
            'Monaco': 'Monaco',
            'Mont√©n√©gro': 'Montenegro',
            'Cap-Vert': 'Cape Verde'
        };

        const continents = {
            'Europe': {
                emoji: 'üá™üá∫',
                countries: [
                    'Albanie', 'Allemagne', 'Andorre', 'Autriche', 'Belgique', 'Bi√©lorussie',
                    'Bosnie-Herz√©govine', 'Bulgarie', 'Chypre', 'Croatie', 'Danemark', 'Espagne',
                    'Estonie', 'Finlande', 'France', 'Gr√®ce', 'Hongrie', 'Irlande', 'Islande',
                    'Italie', 'Lettonie', 'Lituanie', 'Luxembourg', 'Malte', 'Moldavie',
                    'Monaco', 'Mont√©n√©gro', 'Norv√®ge', 'Pays-Bas', 'Pologne', 'Portugal',
                    'Roumanie', 'Royaume-Uni', 'Russie', 'Serbie', 'Slovaquie', 'Slov√©nie',
                    'Su√®de', 'Suisse', 'Tch√©quie', 'Ukraine'
                ]
            },
            'Asie': {
                emoji: 'üåè',
                countries: [
                    'Afghanistan', 'Arabie Saoudite', 'Arm√©nie', 'Azerba√Ødjan', 'Bahre√Øn',
                    'Bangladesh', 'Bhoutan', 'Brunei', 'Cambodge', 'Chine', 'Cor√©e du Nord',
                    'Cor√©e du Sud', '√âmirats Arabes Unis', 'G√©orgie', 'Inde', 'Indon√©sie',
                    'Irak', 'Iran', 'Isra√´l', 'Japon', 'Jordanie', 'Kazakhstan', 'Kowe√Øt',
                    'Laos', 'Liban', 'Malaisie', 'Maldives', 'Mongolie', 'Myanmar', 'N√©pal',
                    'Oman', 'Pakistan', 'Philippines', 'Qatar', 'Singapour', 'Sri Lanka',
                    'Syrie', 'Ta√Øwan', 'Tha√Ølande', 'Turkm√©nistan', 'Turquie', 'Vietnam', 'Y√©men'
                ]
            },
            'Afrique': {
                emoji: 'üåç',
                countries: [
                    'Afrique du Sud', 'Alg√©rie', 'Angola', 'B√©nin', 'Botswana', 'Burkina Faso',
                    'Burundi', 'Cameroun', 'Cap-Vert', 'Congo', 'C√¥te d\'Ivoire', 'Djibouti',
                    '√âgypte', '√ârythr√©e', '√âthiopie', 'Gabon', 'Gambie', 'Ghana', 'Guin√©e',
                    'Kenya', 'Libye', 'Madagascar', 'Mali', 'Maroc', 'Mozambique', 'Namibie',
                    'Niger', 'Nigeria', 'Rwanda', 'S√©n√©gal', 'Somalie', 'Soudan', 'Tanzanie',
                    'Tchad', 'Tunisie', 'Zambie', 'Zimbabwe'
                ]
            },
            'Am√©rique du Nord': {
                emoji: 'üåé',
                countries: [
                    'Canada', 'Costa Rica', 'Cuba', '√âtats-Unis', 'Guatemala', 'Ha√Øti',
                    'Honduras', 'Jama√Øque', 'Mexique', 'Nicaragua', 'Panama'
                ]
            },
            'Am√©rique du Sud': {
                emoji: 'üåé',
                countries: [
                    'Argentine', 'Bolivie', 'Br√©sil', 'Chili', 'Colombie', '√âquateur',
                    'Paraguay', 'P√©rou', 'Uruguay', 'Venezuela'
                ]
            },
            'Oc√©anie': {
                emoji: 'üåè',
                countries: [
                    'Australie', 'Fidji', 'Nouvelle-Z√©lande'
                ]
            }
        };

        function loadData() {
            const saved = localStorage.getItem('travelData');
            if (saved) {
                visitedCountries = JSON.parse(saved);
            }
        }

        function saveData() {
            localStorage.setItem('travelData', JSON.stringify(visitedCountries));
        }

        function initContinentsList() {
            const container = document.getElementById('continents-list');
            
            Object.keys(continents).forEach(continentName => {
                const continent = continents[continentName];
                const section = document.createElement('div');
                section.className = 'continent-section';
                
                const header = document.createElement('div');
                header.className = 'continent-header';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'continent-name';
                nameDiv.innerHTML = `<span class="arrow">‚ñ∂</span> ${continent.emoji} ${continentName}`;
                
                const stats = document.createElement('div');
                stats.className = 'continent-stats';
                const visited = continent.countries.filter(c => visitedCountries[c]).length;
                const total = continent.countries.length;
                stats.textContent = `${visited}/${total}`;
                
                header.appendChild(nameDiv);
                header.appendChild(stats);
                
                const countriesDiv = document.createElement('div');
                countriesDiv.className = 'continent-countries';
                
                const sortedCountries = continent.countries.sort();
                sortedCountries.forEach(countryName => {
                    const item = createCountryItem(countryName);
                    countriesDiv.appendChild(item);
                });
                
                header.addEventListener('click', () => {
                    countriesDiv.classList.toggle('open');
                    header.querySelector('.arrow').classList.toggle('open');
                });
                
                section.appendChild(header);
                section.appendChild(countriesDiv);
                container.appendChild(section);
            });
            
            updateStats();
        }

        function createCountryItem(countryName) {
            const item = document.createElement('div');
            item.className = 'country-item';
            if (visitedCountries[countryName]) {
                item.classList.add('visited');
            }
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'country-checkbox';
            checkbox.checked = !!visitedCountries[countryName];
            checkbox.addEventListener('change', (e) => {
                e.stopPropagation();
                toggleCountry(countryName, e.target.checked);
            });
            
            const name = document.createElement('span');
            name.className = 'country-name';
            name.textContent = countryName;
            
            const rating = document.createElement('span');
            rating.className = 'country-rating';
            if (visitedCountries[countryName] && visitedCountries[countryName].rating) {
                rating.textContent = '‚≠ê'.repeat(visitedCountries[countryName].rating);
            }
            
            item.appendChild(checkbox);
            item.appendChild(name);
            item.appendChild(rating);
            
            item.addEventListener('click', (e) => {
                if (e.target !== checkbox) {
                    openModal(countryName);
                }
            });
            
            return item;
        }

		document.addEventListener('DOMContentLoaded', () => {
		    const searchBox = document.getElementById('search-box');
		    searchBox.addEventListener('input', (e) => {
		        const search = e.target.value.toLowerCase();
		        const items = document.querySelectorAll('.country-item');
		        const sections = document.querySelectorAll('.continent-section');
        
		        if (search === '') {
		            items.forEach(item => item.style.display = 'flex');
		            sections.forEach(section => section.style.display = 'block');
		            return;
		        }
        
		        items.forEach(item => {
		            const countryName = item.querySelector('.country-name').textContent.toLowerCase();
		            if (countryName.includes(search)) {
		                item.style.display = 'flex';
		                item.parentElement.classList.add('open');
		                item.closest('.continent-section').style.display = 'block';
		            } else {
		                item.style.display = 'none';
		            }
		        });
        
		        sections.forEach(section => {
		            const visibleItems = section.querySelectorAll('.country-item[style="display: flex;"]');
		            if (visibleItems.length === 0) {
		                section.style.display = 'none';
		            }
		        });
		    });

		    const ratingFilter = document.getElementById('rating-filter');
		    ratingFilter.addEventListener('change', (e) => {
		        const filterValue = e.target.value;
		        const items = document.querySelectorAll('.country-item');
		        const sections = document.querySelectorAll('.continent-section');
        
		        items.forEach(item => {
		            const countryName = item.querySelector('.country-name').textContent;
		            const countryData = visitedCountries[countryName];
            
		            if (filterValue === 'all') {
		                item.style.display = 'flex';
		            } else if (filterValue === '0') {
		                if (countryData && countryData.rating === 0) {
		                    item.style.display = 'flex';
		                } else {
		                    item.style.display = 'none';
		                }
		            } else {
		                const minRating = parseInt(filterValue);
		                if (countryData && countryData.rating >= minRating) {
		                    item.style.display = 'flex';
		                    item.parentElement.classList.add('open');
		                } else {
		                    item.style.display = 'none';
		                }
		            }
		        });
        
		        sections.forEach(section => {
		            const visibleItems = section.querySelectorAll('.country-item[style="display: flex;"]');
		            if (visibleItems.length === 0) {
		                section.style.display = 'none';
		            } else {
		                section.style.display = 'block';
		            }
		        });
		    });
		});

        function toggleCountry(countryName, isVisited) {
            if (isVisited) {
                if (!visitedCountries[countryName]) {
                    visitedCountries[countryName] = {
                        visited: true,
                        notes: '',
                        rating: 0,
                        date: new Date().toISOString(),
					    photos: [], // URLs des photos (max 5)
					    budget: 0,
					    activities: {
					        plage: false,
					        montagne: false,
					        musees: false,
					        gastronomie: false,
					        nightlife: false,
					        shopping: false,
					        nature: false,
					        aventure: false
					    },
					    companions: [] // ["Solo", "Famille", "Amis", "Couple"]
					};
                }
            } else {
                delete visitedCountries[countryName];
            }
            
            saveData();
            updateGlobeColors();
            updateCountryItem(countryName);
            updateAllContinentStats();
            updateStats();
        }

        function updateCountryItem(countryName) {
            const items = document.querySelectorAll('.country-item');
            items.forEach(item => {
                const name = item.querySelector('.country-name').textContent;
                if (name === countryName) {
                    const checkbox = item.querySelector('.country-checkbox');
                    const rating = item.querySelector('.country-rating');
                    
                    if (visitedCountries[countryName]) {
                        item.classList.add('visited');
                        checkbox.checked = true;
                        if (visitedCountries[countryName].rating) {
                            rating.textContent = '‚≠ê'.repeat(visitedCountries[countryName].rating);
                        } else {
                            rating.textContent = '';
                        }
                    } else {
                        item.classList.remove('visited');
                        checkbox.checked = false;
                        rating.textContent = '';
                    }
                }
            });
        }

        function updateAllContinentStats() {
            const headers = document.querySelectorAll('.continent-header');
            headers.forEach((header, index) => {
                const continentName = Object.keys(continents)[index];
                const continent = continents[continentName];
                const visited = continent.countries.filter(c => visitedCountries[c]).length;
                const total = continent.countries.length;
                header.querySelector('.continent-stats').textContent = `${visited}/${total}`;
            });
        }

		function updateStats() {
		    let visitedCount = 0;
		    let totalCount = 0;
		    let totalRating = 0;
		    let ratedCount = 0;
		    let lastVisit = null;
		    let lastCountry = null;
    
		    Object.values(continents).forEach(continent => {
		        totalCount += continent.countries.length;
		        continent.countries.forEach(country => {
		            if (visitedCountries[country]) {
		                visitedCount++;
		                if (visitedCountries[country].rating > 0) {
		                    totalRating += visitedCountries[country].rating;
		                    ratedCount++;
		                }
		                const visitDate = new Date(visitedCountries[country].date);
		                if (!lastVisit || visitDate > lastVisit) {
		                    lastVisit = visitDate;
		                    lastCountry = country;
		                }
		            }
		        });
		    });
    
		    document.getElementById('visited-count').textContent = visitedCount;
		    document.getElementById('total-count').textContent = totalCount;
    
		    if (ratedCount > 0) {
		        const avgRating = (totalRating / ratedCount).toFixed(1);
		        document.getElementById('avg-rating').textContent = avgRating;
		    } else {
		        document.getElementById('avg-rating').textContent = '-';
		    }
    
		    if (lastCountry) {
		        document.getElementById('last-country').textContent = lastCountry;
		    } else {
		        document.getElementById('last-country').textContent = '-';
		    }
		}
		
		function openStatsModal() {
		    calculateDetailedStats();
		    document.getElementById('stats-modal').style.display = 'block';
		    document.getElementById('overlay').classList.add('active');
		}

		function closeStatsModal() {
		    document.getElementById('stats-modal').style.display = 'none';
		    document.getElementById('overlay').classList.remove('active');
		}

		function calculateDetailedStats() {
		    let totalCountries = 0;
		    let totalVisited = 0;
    
		    // Stats mondiales
		    Object.values(continents).forEach(continent => {
		        totalCountries += continent.countries.length;
		        continent.countries.forEach(country => {
		            if (visitedCountries[country]) {
		                totalVisited++;
		            }
		        });
		    });
    
		    const worldPercentage = ((totalVisited / totalCountries) * 100).toFixed(1);
		    document.getElementById('world-percentage').textContent = worldPercentage + '%';
		    document.getElementById('world-progress-bar').style.width = worldPercentage + '%';
    
		    // Stats par continent
		    const continentsContainer = document.getElementById('continents-completion');
		    continentsContainer.innerHTML = '';
    
		    Object.keys(continents).forEach(continentName => {
		        const continent = continents[continentName];
		        const visited = continent.countries.filter(c => visitedCountries[c]).length;
		        const total = continent.countries.length;
		        const percentage = ((visited / total) * 100).toFixed(1);
        
		        const continentDiv = document.createElement('div');
		        continentDiv.style.cssText = 'margin-bottom: 25px; padding: 20px; background: rgba(40, 40, 40, 0.5); border-radius: 8px;';
        
		        continentDiv.innerHTML = `
		            <h3 style="color: #fff; margin-bottom: 15px;">${continent.emoji} ${continentName}</h3>
		            <div style="margin-bottom: 10px;">
		                <span style="color: #ccc;">${visited} / ${total} pays visit√©s</span>
		            </div>
		            <div style="display: flex; align-items: center; gap: 15px;">
		                <div style="flex: 1; background: #1a1a1a; height: 25px; border-radius: 12px; overflow: hidden;">
		                    <div style="width: ${percentage}%; height: 100%; background: linear-gradient(90deg, #4CAF50, #45a049); transition: width 0.3s;"></div>
		                </div>
		                <span style="font-size: 20px; font-weight: bold; color: #4CAF50; min-width: 60px;">${percentage}%</span>
		            </div>
		        `;
        
		        continentsContainer.appendChild(continentDiv);
		    });
		}

        // Initialiser le globe
        async function initGlobe() {
            // Charger les donn√©es GeoJSON des pays
            const response = await fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson');
            countriesGeoJson = await response.json();

            myGlobe = Globe()
                (document.getElementById('globe-container'))
                .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
                .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
                .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
                .polygonsData(countriesGeoJson.features)
                .polygonAltitude(0.01)
				.polygonCapColor(feat => {
				    const countryName = getCountryNameFromGeoJson(feat.properties.NAME);
				    if (visitedCountries[countryName]) {
				        return '#00ff00'; // Vert pour visit√©s
				    } else if (bucketList[countryName]) {
				        return '#FF9800'; // Orange pour bucket list
				    }
				    return 'rgba(100, 100, 100, 0.3)'; // Gris par d√©faut
				})
                .polygonSideColor(() => 'rgba(0, 0, 0, 0.1)')
                .polygonStrokeColor(() => '#111')
                .polygonLabel(feat => {
                    const countryName = getCountryNameFromGeoJson(feat.properties.NAME);
                    return `<b>${countryName}</b>`;
                })
                .onPolygonClick((polygon) => {
                    const countryName = getCountryNameFromGeoJson(polygon.properties.NAME);
                    if (countryName) {
                        openModal(countryName);
                    }
                });

	// Auto-rotation
	            myGlobe.controls().autoRotate = false;
	            myGlobe.controls().autoRotateSpeed = 0.3;
	        }

	        function getCountryNameFromGeoJson(geoJsonName) {
	            // Trouver le nom fran√ßais correspondant
	            for (const [frenchName, englishName] of Object.entries(countryNameMapping)) {
	                if (englishName === geoJsonName) {
	                    return frenchName;
	                }
	            }
	            return geoJsonName;
	        }

	        function updateGlobeColors() {
	            if (myGlobe && countriesGeoJson) {
	                myGlobe.polygonsData(countriesGeoJson.features);
	            }
	        }

	        function resetView() {
	            if (myGlobe) {
	                myGlobe.pointOfView({ lat: 0, lng: 0, altitude: 2.5 }, 1000);
	            }
	        }
			function toggleRotation() {
			    myGlobe.controls().autoRotate = !myGlobe.controls().autoRotate;
			}

			function openModal(countryName) {
			    selectedCountry = countryName;
			    document.getElementById('modal-title').textContent = countryName;
    
			    const addBucketBtn = document.getElementById('add-bucket-btn');
			    const saveBtn = document.getElementById('save-btn');
			    const exportPdfBtn = document.getElementById('export-pdf-btn');
    
			    if (visitedCountries[countryName]) {
			        // Charger les donn√©es existantes
			        const data = visitedCountries[countryName];
        
			        document.getElementById('notes-input').value = data.notes || '';
			        document.getElementById('budget-input').value = data.budget || '';
			        currentRating = data.rating || 0;
        
			        // Charger les activit√©s
			        document.querySelectorAll('.activity-checkbox').forEach(checkbox => {
			            const activity = checkbox.dataset.activity;
			            checkbox.checked = data.activities && data.activities[activity];
			        });
        
			        // Charger les compagnons
			        document.querySelectorAll('.companion-checkbox').forEach(checkbox => {
			            const companion = checkbox.dataset.companion;
			            checkbox.checked = data.companions && data.companions.includes(companion);
			        });
        
			        // Afficher les photos
			        displayPhotos(data.photos || []);
        
			        addBucketBtn.style.display = 'none';
			        saveBtn.style.display = 'block';
			        exportPdfBtn.style.display = 'block';
			    } else if (bucketList[countryName]) {
			        // R√©initialiser le formulaire
			        resetModalForm();
			        addBucketBtn.textContent = '‚úÖ D√©j√† dans la Bucket List';
			        addBucketBtn.style.background = '#888';
			        addBucketBtn.disabled = true;
			        saveBtn.style.display = 'block';
			        exportPdfBtn.style.display = 'none';
			    } else {
			        // R√©initialiser le formulaire
			        resetModalForm();
			        addBucketBtn.style.display = 'block';
			        addBucketBtn.textContent = 'üéØ Ajouter √† ma Bucket List';
			        addBucketBtn.style.background = '#FF9800';
			        addBucketBtn.disabled = false;
			        saveBtn.style.display = 'block';
			        exportPdfBtn.style.display = 'none';
			    }
    
			    updateStars();
			    document.getElementById('modal').classList.add('active');
			    document.getElementById('overlay').classList.add('active');
			}

			function resetModalForm() {
			    document.getElementById('notes-input').value = '';
			    document.getElementById('budget-input').value = '';
			    currentRating = 0;
			    document.querySelectorAll('.activity-checkbox').forEach(cb => cb.checked = false);
			    document.querySelectorAll('.companion-checkbox').forEach(cb => cb.checked = false);
			    document.getElementById('photos-preview').innerHTML = '';
			}

	        function closeModal() {
	            document.getElementById('modal').classList.remove('active');
	            document.getElementById('overlay').classList.remove('active');
	            selectedCountry = null;
	        }

			function saveCountryDetails() {
			    const notes = document.getElementById('notes-input').value;
			    const budget = parseFloat(document.getElementById('budget-input').value) || 0;
    
			    // R√©cup√©rer les activit√©s
			    const activities = {};
			    document.querySelectorAll('.activity-checkbox').forEach(checkbox => {
			        activities[checkbox.dataset.activity] = checkbox.checked;
			    });
    
			    // R√©cup√©rer les compagnons
			    const companions = [];
			    document.querySelectorAll('.companion-checkbox').forEach(checkbox => {
			        if (checkbox.checked) {
			            companions.push(checkbox.dataset.companion);
			        }
			    });
    
			    // R√©cup√©rer les photos (en base64 depuis le preview)
			    const photos = [];
			    document.querySelectorAll('#photos-preview img').forEach(img => {
			        photos.push(img.src);
			    });
    
			    visitedCountries[selectedCountry] = {
			        visited: true,
			        notes: notes,
			        rating: currentRating,
			        date: new Date().toISOString(),
			        budget: budget,
			        activities: activities,
			        companions: companions,
			        photos: photos
			    };
    
			    saveData();
			    updateGlobeColors();
			    updateCountryItem(selectedCountry);
			    updateAllContinentStats();
			    updateStats();
			    closeModal();
			}

	        function updateStars() {
	            document.querySelectorAll('.star').forEach(star => {
	                const rating = parseInt(star.dataset.rating);
	                if (rating <= currentRating) {
	                    star.classList.add('active');
	                } else {
	                    star.classList.remove('active');
	                }
	            });
	        }
			
			let bucketList = {};

			function loadBucketList() {
			    const saved = localStorage.getItem('bucketList');
			    if (saved) {
			        bucketList = JSON.parse(saved);
			    }
			}

			function saveBucketList() {
			    localStorage.setItem('bucketList', JSON.stringify(bucketList));
			}

			function openBucketListModal() {
			    renderBucketList();
			    document.getElementById('bucket-list-modal').style.display = 'block';
			    document.getElementById('overlay').classList.add('active');
			}

			function closeBucketListModal() {
			    document.getElementById('bucket-list-modal').style.display = 'none';
			    document.getElementById('overlay').classList.remove('active');
			    document.getElementById('bucket-search').value = '';
			    document.getElementById('bucket-search-results').innerHTML = '';
			    document.getElementById('bucket-suggestions').style.display = 'none';
			}

			function addToBucketList(countryName, reason = '') {
			    if (!visitedCountries[countryName] && !bucketList[countryName]) {
			        bucketList[countryName] = {
			            addedDate: new Date().toISOString(),
			            reason: reason,
			            priority: 'medium'
			        };
			        saveBucketList();
			        renderBucketList();
			        updateGlobeColorsForBucket();
			    }
			}

			function removeFromBucketList(countryName) {
			    delete bucketList[countryName];
			    saveBucketList();
			    renderBucketList();
			    updateGlobeColorsForBucket();
			}

			function renderBucketList() {
			    const container = document.getElementById('bucket-items');
			    const emptyState = document.getElementById('bucket-empty');
			    const countSpan = document.getElementById('bucket-count');
    
			    const bucketCountries = Object.keys(bucketList);
			    countSpan.textContent = bucketCountries.length;
    
			    if (bucketCountries.length === 0) {
			        container.innerHTML = '';
			        emptyState.style.display = 'block';
			        document.getElementById('itinerary-section').style.display = 'none';
			        return;
			    }
    
			    emptyState.style.display = 'none';
			    container.innerHTML = '';
    
			    // Grouper par continent
			    const byContinent = {};
			    Object.keys(continents).forEach(continentName => {
			        byContinent[continentName] = [];
			    });
    
			    bucketCountries.forEach(country => {
			        for (const [continentName, continent] of Object.entries(continents)) {
			            if (continent.countries.includes(country)) {
			                byContinent[continentName].push(country);
			                break;
			            }
			        }
			    });
    
			    // Afficher par continent
			    Object.keys(byContinent).forEach(continentName => {
			        if (byContinent[continentName].length === 0) return;
        
			        const continentSection = document.createElement('div');
			        continentSection.style.cssText = 'margin-bottom: 20px;';
        
			        const continentHeader = document.createElement('h4');
			        continentHeader.style.cssText = 'color: #FF9800; margin-bottom: 10px; font-size: 16px;';
			        continentHeader.textContent = `${continents[continentName].emoji} ${continentName} (${byContinent[continentName].length})`;
			        continentSection.appendChild(continentHeader);
        
			        byContinent[continentName].forEach(country => {
			            const item = document.createElement('div');
			            item.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 12px; margin: 5px 0; background: rgba(255, 152, 0, 0.2); border-radius: 5px; border-left: 4px solid #FF9800;';
            
			            const leftPart = document.createElement('div');
			            leftPart.style.cssText = 'flex: 1;';
            
			            const countryNameEl = document.createElement('div');
			            countryNameEl.style.cssText = 'font-weight: bold; margin-bottom: 5px;';
			            countryNameEl.textContent = country;
            
			            const reasonEl = document.createElement('div');
			            reasonEl.style.cssText = 'font-size: 12px; color: #ccc;';
			            reasonEl.textContent = bucketList[country].reason || 'Destination de r√™ve';
            
			            leftPart.appendChild(countryNameEl);
			            leftPart.appendChild(reasonEl);
            
			            const removeBtn = document.createElement('button');
			            removeBtn.textContent = '‚úì Visit√©';
			            removeBtn.style.cssText = 'padding: 8px 15px; background: #4CAF50; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px; margin-right: 10px;';
			            removeBtn.onclick = () => {
			                removeFromBucketList(country);
			                openModal(country);
			            };
            
			            const deleteBtn = document.createElement('button');
			            deleteBtn.textContent = 'üóëÔ∏è';
			            deleteBtn.style.cssText = 'padding: 8px 12px; background: #f44336; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 14px;';
			            deleteBtn.onclick = () => removeFromBucketList(country);
            
			            item.appendChild(leftPart);
			            item.appendChild(removeBtn);
			            item.appendChild(deleteBtn);
			            continentSection.appendChild(item);
			        });
        
			        container.appendChild(continentSection);
			    });
    
			    // G√©n√©rer les itin√©raires
			    generateItineraries();
			}

			function generateItineraries() {
			    const bucketCountries = Object.keys(bucketList);
    
			    if (bucketCountries.length < 2) {
			        document.getElementById('itinerary-section').style.display = 'none';
			        return;
			    }
    
			    document.getElementById('itinerary-section').style.display = 'block';
			    const container = document.getElementById('itinerary-content');
			    container.innerHTML = '';
    
			    // Grouper par continent
			    const byContinent = {};
			    bucketCountries.forEach(country => {
			        for (const [continentName, continent] of Object.entries(continents)) {
			            if (continent.countries.includes(country)) {
			                if (!byContinent[continentName]) byContinent[continentName] = [];
			                byContinent[continentName].push(country);
			                break;
			            }
			        }
			    });
    
			    // Cr√©er des itin√©raires par continent
			    let hasItinerary = false;
			    Object.keys(byContinent).forEach(continentName => {
			        if (byContinent[continentName].length >= 2) {
			            hasItinerary = true;
			            const itinerary = document.createElement('div');
			            itinerary.style.cssText = 'margin-bottom: 15px; padding: 15px; background: rgba(40, 40, 40, 0.5); border-radius: 8px;';
            
			            itinerary.innerHTML = `
			                <div style="font-weight: bold; margin-bottom: 10px; color: #FF9800;">
			                    ${continents[continentName].emoji} Tour ${continentName}
			                </div>
			                <div style="font-size: 14px; color: #ccc; margin-bottom: 10px;">
			                    ${byContinent[continentName].join(' ‚Üí ')}
			                </div>
			                <div style="font-size: 12px; color: #888;">
			                    ${byContinent[continentName].length} pays √† visiter dans la m√™me r√©gion
			                </div>
			            `;
            
			            container.appendChild(itinerary);
			        }
			    });
    
			    if (!hasItinerary) {
			        container.innerHTML = '<p style="color: #888; font-size: 14px;">Ajoutez au moins 2 pays d\'une m√™me r√©gion pour voir des suggestions d\'itin√©raires.</p>';
			    }
			}

			function generateSuggestions() {
			    const suggestionsDiv = document.getElementById('bucket-suggestions');
			    const contentDiv = document.getElementById('suggestions-content');
    
			    suggestionsDiv.style.display = 'block';
			    contentDiv.innerHTML = '';
    
			    // Analyser les pays visit√©s
			    const visitedByContinent = {};
			    const ratingsByContinent = {};
    
			    Object.keys(visitedCountries).forEach(country => {
			        for (const [continentName, continent] of Object.entries(continents)) {
			            if (continent.countries.includes(country)) {
			                if (!visitedByContinent[continentName]) {
			                    visitedByContinent[continentName] = [];
			                    ratingsByContinent[continentName] = [];
			                }
			                visitedByContinent[continentName].push(country);
			                if (visitedCountries[country].rating) {
			                    ratingsByContinent[continentName].push(visitedCountries[country].rating);
			                }
			                break;
			            }
			        }
			    });
    
			    const suggestions = [];
    
			    // Suggestion 1: Pays voisins de ceux bien not√©s
			    Object.keys(visitedCountries).forEach(country => {
			        if (visitedCountries[country].rating >= 4) {
			            for (const [continentName, continent] of Object.entries(continents)) {
			                if (continent.countries.includes(country)) {
			                    // Sugg√©rer d'autres pays du m√™me continent
			                    const neighbors = continent.countries.filter(c => 
			                        !visitedCountries[c] && 
			                        !bucketList[c] && 
			                        c !== country
			                    );
                    
			                    neighbors.slice(0, 2).forEach(neighbor => {
			                        suggestions.push({
			                            country: neighbor,
			                            reason: `Proche de ${country} que vous avez ador√© ${'‚≠ê'.repeat(visitedCountries[country].rating)}`
			                        });
			                    });
			                    break;
			                }
			            }
			        }
			    });
    
			    // Suggestion 2: Continents pr√©f√©r√©s
			    let favContinent = null;
			    let maxAvg = 0;
    
			    Object.keys(ratingsByContinent).forEach(continentName => {
			        const ratings = ratingsByContinent[continentName];
			        if (ratings.length >= 2) {
			            const avg = ratings.reduce((a, b) => a + b, 0) / ratings.length;
			            if (avg > maxAvg) {
			                maxAvg = avg;
			                favContinent = continentName;
			            }
			        }
			    });
    
			    if (favContinent) {
			        const unvisited = continents[favContinent].countries.filter(c => 
			            !visitedCountries[c] && !bucketList[c]
			        );
        
			        unvisited.slice(0, 3).forEach(country => {
			            suggestions.push({
			                country: country,
			                reason: `${favContinent} semble √™tre votre continent pr√©f√©r√© (note moyenne: ${maxAvg.toFixed(1)}‚≠ê)`
			            });
			        });
			    }
    
			    // Suggestion 3: Compl√©ter un continent
			    Object.keys(continents).forEach(continentName => {
			        const continent = continents[continentName];
			        const visited = continent.countries.filter(c => visitedCountries[c]).length;
			        const percentage = (visited / continent.countries.length) * 100;
        
			        if (percentage >= 50 && percentage < 100) {
			            const remaining = continent.countries.filter(c => 
			                !visitedCountries[c] && !bucketList[c]
			            );
            
			            remaining.slice(0, 2).forEach(country => {
			                suggestions.push({
			                    country: country,
			                    reason: `Compl√©tez ${continentName} ! Vous avez d√©j√† visit√© ${percentage.toFixed(0)}% du continent`
			                });
			            });
			        }
			    });
    
			    // Limiter et d√©dupliquer
			    const uniqueSuggestions = [];
			    const seenCountries = new Set();
    
			    suggestions.forEach(sug => {
			        if (!seenCountries.has(sug.country) && uniqueSuggestions.length < 6) {
			            seenCountries.add(sug.country);
			            uniqueSuggestions.push(sug);
			        }
			    });
    
			    if (uniqueSuggestions.length === 0) {
			        contentDiv.innerHTML = '<p style="color: #ccc; font-size: 14px;">Visitez plus de pays et ajoutez des notes pour recevoir des suggestions personnalis√©es !</p>';
			        return;
			    }
    
			    uniqueSuggestions.forEach(sug => {
			        const item = document.createElement('div');
			        item.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 12px; margin: 8px 0; background: rgba(76, 175, 80, 0.3); border-radius: 5px;';
        
			        const leftPart = document.createElement('div');
			        leftPart.style.flex = '1';
        
			        const countryName = document.createElement('div');
			        countryName.style.cssText = 'font-weight: bold; margin-bottom: 5px;';
			        countryName.textContent = sug.country;
        
			        const reason = document.createElement('div');
			        reason.style.cssText = 'font-size: 12px; color: #ddd;';
			        reason.textContent = sug.reason;
        
			        leftPart.appendChild(countryName);
			        leftPart.appendChild(reason);
        
			        const addBtn = document.createElement('button');
			        addBtn.textContent = '+ Ajouter';
			        addBtn.style.cssText = 'padding: 8px 15px; background: #FF9800; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px; font-weight: bold;';
			        addBtn.onclick = () => {
			            addToBucketList(sug.country, sug.reason);
			            item.remove();
			        };
        
			        item.appendChild(leftPart);
			        item.appendChild(addBtn);
			        contentDiv.appendChild(item);
			    });
			}

			function updateGlobeColorsForBucket() {
			    if (myGlobe && countriesGeoJson) {
			        myGlobe.polygonsData(countriesGeoJson.features);
			    }
			}
			// Initialiser la recherche de la bucket list
			function initBucketSearch() {
			    const bucketSearch = document.getElementById('bucket-search');
    
			    bucketSearch.addEventListener('input', (e) => {
			        const search = e.target.value.toLowerCase();
			        const resultsDiv = document.getElementById('bucket-search-results');
        
			        if (search.length < 1) {
			            resultsDiv.innerHTML = '';
			            return;
			        }
        
			        const allCountries = [];
			        Object.values(continents).forEach(continent => {
			            continent.countries.forEach(country => {
			                if (!visitedCountries[country] && !bucketList[country]) {
			                    allCountries.push(country);
			                }
			            });
			        });
        
			        const matches = allCountries.filter(c => c.toLowerCase().includes(search)).slice(0, 8);
        
			        if (matches.length === 0) {
			            resultsDiv.innerHTML = '<p style="color: #888; padding: 10px; font-size: 14px;">Aucun pays trouv√©</p>';
			            return;
			        }
        
			        resultsDiv.innerHTML = '';
			        matches.forEach(country => {
			            const item = document.createElement('div');
			            item.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 12px; margin: 5px 0; background: rgba(40, 40, 40, 0.5); border-radius: 5px; cursor: pointer; transition: background 0.2s;';
			            item.onmouseenter = () => item.style.background = 'rgba(60, 60, 60, 0.7)';
			            item.onmouseleave = () => item.style.background = 'rgba(40, 40, 40, 0.5)';
            
			            const countryNameSpan = document.createElement('span');
			            countryNameSpan.textContent = country;
			            countryNameSpan.style.flex = '1';
            
			            const addBtn = document.createElement('button');
			            addBtn.textContent = '+ Ajouter';
			            addBtn.style.cssText = 'padding: 8px 16px; background: #FF9800; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 13px; font-weight: bold;';
			            addBtn.onclick = (e) => {
			                e.stopPropagation();
			                addToBucketList(country);
			                bucketSearch.value = '';
			                resultsDiv.innerHTML = '';
			            };
            
			            item.appendChild(countryNameSpan);
			            item.appendChild(addBtn);
            
			            item.onclick = () => {
			                addToBucketList(country);
			                bucketSearch.value = '';
			                resultsDiv.innerHTML = '';
			            };
            
			            resultsDiv.appendChild(item);
			        });
			    });
			}
			// Ajouter apr√®s initBucketSearch()
			function handlePhotoUpload() {
			    const photosInput = document.getElementById('photos-input');
    
			    photosInput.addEventListener('change', (e) => {
			        const files = Array.from(e.target.files).slice(0, 5); // Max 5 photos
			        const preview = document.getElementById('photos-preview');
			        preview.innerHTML = '';
        
			        files.forEach((file, index) => {
			            const reader = new FileReader();
			            reader.onload = (e) => {
			                const img = document.createElement('div');
			                img.style.cssText = 'position: relative; width: 100px; height: 100px; border-radius: 8px; overflow: hidden; border: 2px solid #4CAF50;';
			                img.innerHTML = `
			                    <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">
			                    <button onclick="removePhoto(${index})" style="position: absolute; top: 5px; right: 5px; background: #f44336; border: none; border-radius: 50%; width: 25px; height: 25px; color: white; cursor: pointer; font-size: 14px;">√ó</button>
			                `;
			                preview.appendChild(img);
			            };
			            reader.readAsDataURL(file);
			        });
			    });
			}

			function displayPhotos(photos) {
			    const preview = document.getElementById('photos-preview');
			    preview.innerHTML = '';
    
			    photos.forEach((photoUrl, index) => {
			        const img = document.createElement('div');
			        img.style.cssText = 'position: relative; width: 100px; height: 100px; border-radius: 8px; overflow: hidden; border: 2px solid #4CAF50;';
			        img.innerHTML = `
			            <img src="${photoUrl}" style="width: 100%; height: 100%; object-fit: cover;">
			            <button onclick="removePhoto(${index})" style="position: absolute; top: 5px; right: 5px; background: #f44336; border: none; border-radius: 50%; width: 25px; height: 25px; color: white; cursor: pointer; font-size: 14px;">√ó</button>
			        `;
			        preview.appendChild(img);
			    });
			}

			let currentPhotos = [];
			function removePhoto(index) {
			    currentPhotos.splice(index, 1);
			    displayPhotos(currentPhotos);
			}

	        // Event listeners
	        document.getElementById('save-btn').addEventListener('click', saveCountryDetails);
	        document.getElementById('cancel-btn').addEventListener('click', closeModal);
	        document.getElementById('overlay').addEventListener('click', closeModal);
        
	        document.querySelectorAll('.star').forEach(star => {
	            star.addEventListener('click', function() {
	                currentRating = parseInt(this.dataset.rating);
	                updateStars();
	            });
	        });
			document.getElementById('toggle-sidebar').addEventListener('click', () => {
			    document.getElementById('sidebar').classList.toggle('open');
			});
			document.getElementById('personal-stats-btn').addEventListener('click', openStatsModal);
			document.getElementById('close-stats-btn').addEventListener('click', closeStatsModal);
			document.getElementById('bucket-list-btn').addEventListener('click', openBucketListModal);
			document.getElementById('close-bucket-btn').addEventListener('click', closeBucketListModal);
			document.getElementById('suggestions-btn').addEventListener('click', generateSuggestions);
			document.getElementById('add-bucket-btn').addEventListener('click', () => {
			    if (!bucketList[selectedCountry]) {
			        addToBucketList(selectedCountry, 'Ajout√© depuis le globe');
			        alert(`${selectedCountry} a √©t√© ajout√© √† votre Bucket List ! üéØ`);
			        closeModal();
			    }
			});
			function exportToPDF() {
			    if (!visitedCountries[selectedCountry]) return;
    
			    const { jsPDF } = window.jspdf;
			    const doc = new jsPDF();
			    const data = visitedCountries[selectedCountry];
    
			    // Titre
			    doc.setFontSize(20);
			    doc.setTextColor(76, 175, 80);
			    doc.text(selectedCountry, 20, 20);
    
			    // Date
			    doc.setFontSize(12);
			    doc.setTextColor(100, 100, 100);
			    doc.text(`Visite le: ${new Date(data.date).toLocaleDateString('fr-FR')}`, 20, 30);
    
			    // Note
			    doc.setTextColor(0, 0, 0);
			    doc.text(`Note: ${'‚òÖ'.repeat(data.rating)}${'‚òÜ'.repeat(5 - data.rating)}`, 20, 40);
    
			    // Budget
			    if (data.budget) {
			        doc.text(`Budget: ${data.budget}‚Ç¨`, 20, 50);
			    }
    
			    // Activit√©s
			    let y = 60;
			    doc.text('Activites:', 20, y);
			    y += 7;
			    Object.keys(data.activities).forEach(activity => {
			        if (data.activities[activity]) {
			            doc.text(`- ${activity}`, 25, y);
			            y += 7;
			        }
			    });
    
			    // Compagnons
			    if (data.companions.length > 0) {
			        y += 5;
			        doc.text(`Voyage avec: ${data.companions.join(', ')}`, 20, y);
			        y += 10;
			    }
    
			    // Notes
			    if (data.notes) {
			        y += 5;
			        doc.text('Notes:', 20, y);
			        y += 7;
			        const splitNotes = doc.splitTextToSize(data.notes, 170);
			        doc.text(splitNotes, 20, y);
			    }
    
			    // Sauvegarder
			    doc.save(`${selectedCountry}_carnet.pdf`);
			}

			// Event listener pour le bouton export
			document.getElementById('export-pdf-btn').addEventListener('click', exportToPDF);

	        // Initialisation
	        loadData();
			loadBucketList();
	        initContinentsList();
	        initGlobe();
			initBucketSearch();
			handlePhotoUpload();
			
	    </script>
	</body>
	</html>
